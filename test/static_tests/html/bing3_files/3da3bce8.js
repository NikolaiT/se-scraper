var BootstrapMapsAnswerForOverlayControl=function(){function n(n,t){this._attrName=n;this._featureName=t}return n.prototype.getBestMapView=function(){return null},n.prototype.getSearchQueryCategories=function(){if(this._overlayObject&&this._overlayObject.getV8Map){var n=this._overlayObject.getV8Map().getMapOptions();if(n&&n.searchQueryCategory)return n.searchQueryCategory}return null},n.prototype.getPermalinkState=function(n){var t=[],i=this._getFeatureState(n);return i&&t.push({featureType:this._featureName,data:i}),t},n.prototype._subscribeForClickEventsOnDataElements=function(n){var t=this,i;this._overlayObject=n;i=Microsoft.Maps.Internal._Gimme;this._bindClickEventsOnDataElements(_d);sj_evt.bind("LargeMapHidden",function(){t._showOrHideDataElements(!1)});sj_evt.bind("LargeMapShown",function(){t._showOrHideDataElements(!0)});sj_evt.bind("carItemsAdded",function(n){n&&n.length>1&&n[1]&&n[1].length>0&&n[1].forEach(function(n){t._bindClickEventsOnDataElements(n)})});sj_evt.bind("Cap.ExpOn",function(){var n=i(".sa_cp");n.for_each(function(n){t._bindClickEventsOnDataElements(n)})})},n.prototype._processClickEvent=function(n){n.preventDefault();for(var i=n.currentTarget,r=i&&i.getAttribute(this._attrName),t=i;!r&&t;)t=t.parentElement,r=t&&t.getAttribute(this._attrName);this._processAttribute(i,r)},n.prototype._processAttribute=function(n,t,i){var r;if(i===void 0&&(i=!0),t&&this._overlayObject&&this._overlayObject._showOrHideLargeMap){this._attrVal=t;try{this._subscribeForLargeMapShown();this._overlayObject._showOrHideLargeMap(!0,this,i)}catch(o){}if(r=n&&this._getAnchorElement(n,"data-h"),r){var f=r.getAttribute("data-h"),e=this._getFormCode(r),u=this._overlayObject.getV8Map().getMapOptions();Microsoft.Maps.logger.logObject({feature:"OverlayControl",action:"Click",data:{h:f,attribute:this._attrName,feature:this._featureName,form:e},service:u.service,scenario:u.scenario,searchQueryCategory:u.searchQueryCategory},Microsoft.Maps.GlobalConfig.dynamicProperties.mapsIG)}}else r=this._getAnchorElement(n,"data-h"),r&&(window.location.href=r.getAttribute("href"))},n.prototype._getFeatureState=function(){return this._attrVal},n.prototype._showOrHideDataElements=function(n){var u=Microsoft.Maps.Internal._Gimme,i=u("["+this._attrName+"]"),t,r;if(i)for(t=0,r=i.length;t<r;t++)i[t].style.display=n?"none":""},n.prototype._subscribeForLargeMapShown=function(){},n.prototype._bindClickEventsOnDataElements=function(n){var u=this,t=n.querySelectorAll("["+this._attrName+"]"),i,r;if(t!=null&&t.length>0)for(i=0,r=t.length;i<r;i++)sj_be(t[i],"click",function(n){return u._processClickEvent(n)}),this._updateInstrumentation(t[i])},n.prototype._updateInstrumentation=function(n){var t=this._getAnchorElement(n,"h"),i;t&&(i=t.getAttribute("h"));i&&(Microsoft.Maps.GlobalConfig.features.localSearch.sendMoreInstrumentationForOverlay||t.removeAttribute("h"),t.setAttribute("data-h",i))},n.prototype._getAnchorElement=function(n,t){var i=n.querySelector("a");if(i)return i;for(i=n;i!==document.body&&!i.getAttribute(t);)i=i.parentElement;return i!=document.body?i:null},n.prototype._getFormCode=function(n){if(n){var t=n.getAttribute("href");if(t)return Microsoft.Maps.Internal._Helper._getUrlParam({search:t},"form")}return null},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForResultsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2]);i._subscribeForClickEventsOnChildrenBoundaries(n[2])}}))},t.prototype.getBestMapView=function(n,t,i,r){var c=Microsoft.Maps.Internal._Gimme,f=c.Internals.parseJSON(this._attrVal),e,u=r||f&&f.mapBounds,o,s;if(u&&u.length==4&&(o=new Microsoft.Maps.Location(u[0],u[1]),s=new Microsoft.Maps.Location(u[2],u[3]),e={mapBounds:[o,s]}),f.minZoomForBestMapView>0&&e&&e.mapBounds){var l=this._overlayObject.getV8Map().getMode(),h=l.getMapViewForLocationsInView(e.mapBounds),a=Microsoft.Maps.ZoomLevel.fromLocation(h.cameraLocation,!0);if(a<f.minZoomForBestMapView)return{mapCenter:h.cameraLocation,mapZoom:f.minZoomForBestMapView}}return e},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("ShowResultsMapOverlay",function(n){var i,h,e;if(n){var u=n[1],o=n[2],s=typeof n[3]=="undefined"?!0:!1,f=Microsoft.Maps.Internal._Gimme;u&&u.query&&o?r._processAttribute(o,f.Internals.stringify(u),s):(i=f("["+t._attrName+"]"),i&&i[0]&&(h=i[0].getAttribute(t._attrName),e=f.Internals.parseJSON(h),e.mapBounds&&r._processAttribute(i[0],f.Internals.stringify(t.getPermalinkStateFromFeatureState(u,e)),s)))}})},t.prototype._subscribeForClickEventsOnChildrenBoundaries=function(n){var i=this,r=n.getV8Map(),t=r.getLayers().find(function(t){return t.getId()===n.childrenBoundariesLayerId});t&&t.primitiveTapped.add(function(t){var r=t.primitive.metadata&&t.primitive.metadata.title,u=_d.createElement("div");u.setAttribute("data-h","PrimitiveClick:"+r);i._processAttribute(u,'{"query":"'+r+'","disableComputingMapViewForLoadingOnly":'+!n.hasUserChangedMapView()+"}")})},t.prototype._getFeatureState=function(n){var t=Microsoft.Maps.Internal._Gimme,i=t.Internals.parseJSON(this._attrVal);return i.originIG=n,t.Internals.stringify(i)},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t.getPermalinkStateFromFeatureState=function(n,t){var i=t;return i.poiCount=n&&n.poiCount?n.poiCount.toString():t.poiCount?t.poiCount.toString():"",i.disableComputingMapViewForLoadingOnly=n&&n.filter?!1:i.disableComputingMapViewForLoadingOnly,i.localFilters=n&&n.filter?n.filter:i.localFilters,i.cacheId=n&&n.filter?null:i.cacheId,i},t._attrName="data-resultsoverlay",t._featureName="localListing",t}(BootstrapMapsAnswerForOverlayControl),BootstrapMapsAnswerForResultsWithDetailsOverlay,BootstrapMapsAnswerForDetailsOverlay;BootstrapMapsAnswerForResultsOverlay.Init();__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();BootstrapMapsAnswerForResultsWithDetailsOverlay=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._listingsDomClassSelector=".listings-item",r._openDetailsCardWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._openDetailsCard.apply(r,t)},r._detailsCardPrefetchCompleteWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._onDetailsCardPrefetchComplete.apply(r,t)},r}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype.getBestMapView=function(n,t,i,r){var p=Microsoft.Maps.Internal._Gimme,s=p.Internals.parseJSON(this._attrVal),e=s.localListingsState,u,f,h=new Microsoft.Maps.Location(s.center[0],s.center[1]),o=r||e&&e.mapBounds,a,v,c,l,y;if(o&&o.length==4)if(a=new Microsoft.Maps.Location(o[0],o[1]),v=new Microsoft.Maps.Location(o[2],o[3]),u={mapBounds:[a,v]},c=this._overlayObject.getV8Map().getMode(),l=c.getMapViewForLocationsInView(u.mapBounds,t,n),e.pivotEntity)f=Microsoft.Maps.Internal.MapHelper.getZoomLevelForLocationsToBecomeVisible(this._overlayObject.getV8Map(),u.mapBounds,h);else if(e.minZoomForBestMapView>0&&u&&u.mapBounds){var c=this._overlayObject.getV8Map().getMode(),l=c.getMapViewForLocationsInView(u.mapBounds),f=Microsoft.Maps.ZoomLevel.fromLocation(l.cameraLocation,!0);f<e.minZoomForBestMapView&&(f=e.minZoomForBestMapView)}else f=Microsoft.Maps.ZoomLevel.fromLocation(l.cameraLocation,!0);else u={mapCenter:h,mapZoom:16};return y={left:t.left+i,right:t.right,top:t.top,bottom:t.bottom},(!f||isNaN(f))&&(f=u.mapZoom),{mapCenter:h,mapZoom:f,customPadding:y}},t.prototype.getPermalinkState=function(n){return this._getFeatureStateForResults(n)},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;sj_evt.bind("LargeMapShown",function(){r._saveOrRestoreCarouselPos(!0)});n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("LargeMapHidden",function(){r._saveOrRestoreCarouselPos(!1)});sj_evt.bind("ShowResultsWithDetailsMapOverlay",function(n){var o,l,s,a,h,c,u;if(n&&n[1]){var i=n[1],v=typeof n[3]=="undefined"?!0:!1,e=Microsoft.Maps.Internal._Gimme,f=e("["+t._attrName+"]");if(!i.location&&f&&f.length>0){for(o=0,l=f.length;o<l;o++)if(s=f[o].getAttribute(t._attrName),u=e.Internals.parseJSON(s),i.title&&u.query===i.title||i.id.indexOf(u.id)>=0){sj_evt.bind("MapSearchTaskActivated",r._openDetailsCardWrapper);r._processAttribute(f[o],s);return}}else if(f&&f.length>0)s=f[0].getAttribute(t._attrName),u=e.Internals.parseJSON(s),u.originIG=r._overlayObject.getOriginIG(),u.disableComputingMapViewForLoadingOnly=!0,i.filter&&(u.localListingsState.filterUrlParam=i.filter),i.poiCount&&(u.localListingsState.poiCount=i.poiCount),u.localListingsState.originIG=r._overlayObject.getOriginIG(),sj_evt.bind("MapSearchTaskActivated",r._openDetailsCardWrapper),a=t._getPermalinkStateFromFeatureState(i,u),r._processAttribute(f[0],e.Internals.stringify(a));else if(h=r._overlayObject.getLargeMapLinkPermalinkState(),h)c=e.Internals.parseJSON(h),c.originIG=r._overlayObject.getOriginIG(),u={query:i.title,id:i.id,center:i.location,localListingsState:c,disableComputingMapViewForLoadingOnly:!0,entryPoint:"Permalink",type:i.type,originIG:r._overlayObject.getOriginIG()},sj_evt.bind("MapSearchTaskActivated",r._openDetailsCardWrapper),r._processAttribute(f[0],e.Internals.stringify(u));else throw"Unable to show results with details overlay";}})},t.prototype._processAttribute=function(t,i){n.prototype._processAttribute.call(this,t,i);this._prefetchDetailsCardContent()},t.prototype._processClickEvent=function(t){sj_evt.bind("MapSearchTaskActivated",this._openDetailsCardWrapper);n.prototype._processClickEvent.call(this,t)},t.prototype._saveOrRestoreCarouselPos=function(n){var u=".carousel_scroll",i="data-scrollbookmark",r=Microsoft.Maps.Internal._Gimme;n?r(u).for_each(function(n){!n.hasAttribute(i)&&r(n).select("["+t._attrName+"]").length>0&&n.setAttribute(i,n.scrollLeft.toString())}):r(u).for_each(function(n){if(n.hasAttribute(i)){var t=parseInt(n.getAttribute(i));n.removeAttribute(i);n.scrollLeft=t}})},t.prototype._getFeatureStateForResults=function(n){var r=Microsoft.Maps.Internal._Gimme,i=r.Internals.parseJSON(this._attrVal);return i.localListingsState.disableComputingMapViewForLoadingOnly=!this._overlayObject.hasUserChangedMapView(),i.localListingsState.originIG=n,this._buildPermalinkState(t._featureName,i.localListingsState)},t.prototype._buildPermalinkState=function(n,t){var r=Microsoft.Maps.Internal._Gimme,i=[];return i.push({featureType:n,data:r.Internals.stringify(t)}),i},t.prototype._prefetchDetailsCardContent=function(){var u=this,i,n,t,r;this._prefetchedDetailsCardData=null;i=Microsoft.Maps.Internal._Gimme;n=i.Internals.parseJSON(this._attrVal);switch(n.type){case"Satori":t="sid:";break;case"Business":t="ypid:"}r=Microsoft.Maps.Internal._Helper._overrideTasktypeBasedOnCategory("LocalDetailsTask",n&&n.localListingsState);this._overlayObject._map.getV8Map().getContainer().instanceAsync(r,function(i){var r=n;r.id=t?t+r.id:null;r.disableTaskActivate=!0;r.disableWideCard=!0;Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingDetailsOnSerp=!0;i.process({requestState:r},function(n){u._prefetchedDetailsCardData=n&&n.data&&n.data.content;Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingDetailsOnSerp=!1;sj_evt.fire("OnDetailsCardPrefetch")})})},t.prototype._onDetailsCardPrefetchComplete=function(n){this._openDetailsCardInternal(n)},t.prototype._openDetailsCard=function(n){Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingDetailsOnSerp?sj_evt.bind("OnDetailsCardPrefetch",this._detailsCardPrefetchCompleteWrapper):this._openDetailsCardInternal(n)},t.prototype._openDetailsCardInternal=function(n){var c=Microsoft.Maps.Internal._Gimme,t=c.Internals.parseJSON(this._attrVal),i,f=n&&n[1],e,r,o,a,h,v,u,y,p;if(t&&(t.id?i=this._getDetailCardFromResponseOrDom(t.id,null,f):t.query&&(i=this._getDetailCardFromResponseOrDom(null,t.query,f))),!i&&t&&(t.id||this._prefetchDetailsCardContent)&&(r=c(document).select(this._listingsDomClassSelector),f&&(!r||r.length===0)&&(r=f.select(this._listingsDomClassSelector)),r&&r.length>0))if(o="data-entity",t.id){i=r[0];var w=i.getAttribute(o),l=JSON.parse(w),s=l&&l.entity&&l.entity.id,b=s&&s.indexOf(":");e=s.replace(s.substr(b+1),t.id)}else this._prefetchedDetailsCardData&&this._prefetchedDetailsCardData.select(".overlay-taskpane").length>0&&(i=r[0],a=this._prefetchedDetailsCardData.select("["+o+"]").get_attr(o),h=a&&JSON.parse(a),e=h&&h.entity&&h.entity.id);i&&(this._overlayObject.replaceNextHistoryPoint(),v=c.Internals.parseJSON(i.getAttribute("data-task")),u=v.state,u.disableComputingMapViewForLoadingOnly=t.disableComputingMapViewForLoadingOnly,u.content=this._prefetchedDetailsCardData,this._prefetchedDetailsCardData&&(u.suppressAnimationWhileSlideOut=!0),e&&(u.id=e,u.query=t.query,u.taskTitle=t.query),Microsoft.Maps.GlobalDataEventHandler.invokeHandler("data-task",v),y=Microsoft.Maps.logger,p=this._overlayObject.getOriginIG(),y&&y.logObject({T:"CI.OverlayEntClick",feature:"OverlayControl",action:"CI.OverlayEntClick",data:{}},p,!1));sj_evt.unbind("MapSearchTaskActivated",this._openDetailsCardWrapper);sj_evt.unbind("OnDetailsCardPrefetch",this._detailsCardPrefetchCompleteWrapper)},t.prototype._getDetailCardFromResponseOrDom=function(n,t,i){var u=Microsoft.Maps.Internal._Gimme,r=this._getDetailCardFromListings(u(document).select(this._listingsDomClassSelector),n,t);return!r&&i&&(r=this._getDetailCardFromListings(i.select(this._listingsDomClassSelector),n,t)),r},t.prototype._getDetailCardFromListings=function(n,t,i){var u,h,f,e,r,o,s;if(n&&n.length)for(u=0,h=n.length;u<h;u++)if(f=n[u],e=f.getAttribute("data-entity"),e)if(r=JSON.parse(e),t){if(o=r&&r.entity&&r.entity.id,o&&o.indexOf(t)>0)return f}else if(i&&(s=r&&r.entity&&r.entity.title,s&&s===i))return f;return null},t._getPermalinkStateFromFeatureState=function(n,t){return{query:n.title,id:n.id,center:n.location,localListingsState:t.localListingsState,disableComputingMapViewForLoadingOnly:t.disableComputingMapViewForLoadingOnly,entryPoint:"Permalink",type:n.type,originIG:t.originIG}},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-resultswithdetailsoverlay",t._featureName="localListing",t}(BootstrapMapsAnswerForOverlayControl);BootstrapMapsAnswerForResultsWithDetailsOverlay.Init();__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();BootstrapMapsAnswerForDetailsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype.getBestMapView=function(){var u=Microsoft.Maps.Internal._Gimme,n=u.Internals.parseJSON(this._attrVal),t,i,r;return n&&(n&&n.centerLongitude&&n.zoom!=-1?t={mapCenter:new Microsoft.Maps.Location(n.centerLatitude,n.centerLongitude),mapZoom:n.zoom}:n.mapBounds&&n.mapBounds.length===4&&(i=new Microsoft.Maps.Location(n.mapBounds[0],n.mapBounds[1]),r=new Microsoft.Maps.Location(n.mapBounds[2],n.mapBounds[3]),t={mapBounds:[i,r]})),t},t.prototype._getFeatureState=function(n){var i=Microsoft.Maps.Internal._Gimme,r=i.Internals.parseJSON(this._attrVal),t=r.localDetailsState;return t.disableComputingMapViewForLoadingOnly=!(r.forceComputingMapViewForLoading||this._overlayObject.hasUserChangedMapView()),t.originIG=n,i.Internals.stringify(t)},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-detailsoverlay",t._featureName="localDetails",t}(BootstrapMapsAnswerForOverlayControl);BootstrapMapsAnswerForDetailsOverlay.Init();var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForBasicMapOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype.getBestMapView=function(){var i=Microsoft.Maps.Internal._Gimme,n=i.Internals.parseJSON(this._attrVal),t;return n&&(t={mapCenter:new Microsoft.Maps.Location(n.centerLatitude,n.centerLongitude),mapZoom:n.mapZoom,customPadding:{left:0,top:70,bottom:0,right:0}}),t},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("ShowBasicMapOverlay",function(n){var u,o;if(n){var f=n[1],i=n[2],e=Microsoft.Maps.Internal._Gimme;f&&i?r._processAttribute(i,e.Internals.stringify(f)):i&&(u=e("["+t._attrName+"]"),u&&u[0]&&(o=u[0].getAttribute(t._attrName),r._processAttribute(i,o)))}})},t.prototype._getFeatureState=function(){return null},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-basicmapoverlay",t._featureName="compositemapMode",t}(BootstrapMapsAnswerForOverlayControl),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForStreetsideOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}),sj_evt.bind("StreetsideImageLoaded",function(n){n&&n[1]&&(t._streetsideModeState=t._parseStreetsideUrl(n[1]))}))},t.prototype._showOrHideDataElements=function(t){n.prototype._showOrHideDataElements.call(this,t);t||sj_evt.unbind("LargeMapShown",this._showStreetside)},t.prototype._subscribeForLargeMapShown=function(){t._attrValForEventProcessing=this._attrVal;sj_evt.bind("LargeMapShown",this._showStreetside)},t.prototype._showStreetside=function(){var u=Microsoft.Maps.Internal._Gimme,f=t._getObject(),r=f._overlayObject,n,i;r&&r.setDirectStreetsideLaunch();n=t._streetsideModeState||u.Internals.parseJSON(t._attrValForEventProcessing);i={action:"showBubble",location:new Microsoft.Maps.Location(n.centerPoint.latitude,n.centerPoint.longitude),localDetailsStartupOptions:{}};n.direction&&(i.directionsStartupOptions={heading:n.direction},i.localDetailsStartupOptions.heading=n.direction);Microsoft.Maps.GlobalDataEventHandler.invokeHandler("data-streetside",i)},t._parseStreetsideUrl=function(n){if(!n)return null;var u=n.substr(n.indexOf("?")),i={search:u},r=Microsoft.Maps.Internal._Helper,f=parseFloat(r._getUrlParam(i,"dir")),t=r._getUrlParam(i,"cp").split("~");return t.length==2?{centerPoint:new Microsoft.Maps.Location(t[0],t[1]),mode:2,direction:f}:null},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-streetsideoverlay",t._featureName="streetside",t}(BootstrapMapsAnswerForOverlayControl),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForDirectionsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2]);sj_evt.bind("DirectionButtonClicked",function(n){i._processClickEvent(n&&n[1])})}}))},t.prototype.getBestMapView=function(){var r=Microsoft.Maps.Internal._Gimme,n=r.Internals.parseJSON(this._attrVal),i,t;if(n&&n.waypoints&&n.waypoints.length==2)for(i=[],t=0;t<n.waypoints.length;t++)n.waypoints[t].point&&i.push(new Microsoft.Maps.Location(n.waypoints[t].point.latitude,n.waypoints[t].point.longitude));return{mapBounds:i}},t.prototype._subscribeForClickEventsOnDataElements=function(i){var l=this,f,r,u,h,c,e,o,s;if(n.prototype._subscribeForClickEventsOnDataElements.call(this,i),sj_evt.bind("ShowDirectionsMapOverlay",function(n){if(n&&n[1]){var t=n[1],i={mode:1,waypoints:t,entryPoint:"4"};l._processAttribute(n[2],f.Internals.stringify(i))}}),f=Microsoft.Maps.Internal._Gimme,r=f("["+t._attrName+"]"),r)for(t._dict||(t._dict={}),u=0,h=r.length;u<h;u++)if(c=r[u].getAttribute(t._attrName),e=r[u].querySelector("img"),e){o=e.getAttribute("data-imgsrc");o&&(s=DirectionsImageLoader.getHeader(o),s&&(t._dict[c]=s));return}},t.prototype._getFeatureState=function(){return this._attrVal},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-directionoverlay",t._featureName="directions",t}(BootstrapMapsAnswerForOverlayControl),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForSaveOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapRendered",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2]);i._hookUpSaveDropdown();i._preventGLinkPingForSaveButton()}}))},t.prototype._subscribeForClickEventsOnDataElements=function(t){var r=this,i;n.prototype._subscribeForClickEventsOnDataElements.call(this,t);this._bindHoverEventsOnDataElements(_d);i=Microsoft.Maps.Internal._Gimme;sj_evt.bind("ShowSaveMapOverlay",function(n){if(n){var t=_qs(".bm_save_overlay");r._processAttribute(t,i.Internals.stringify({entryPoint:13}))}})},t.prototype._bindHoverEventsOnDataElements=function(n){var u=this,i=n.querySelectorAll("["+t._attrName+"]"),r,f;if(i&&i.length>0)for(r=0,f=i.length;r<f;r++)sj_be(i[r],"mouseenter",function(n){return u._processMouseEnterEvent(n)}),sj_be(i[r],"mouseleave",function(n){return u._processMouseLeaveEvent(n)})},t.prototype._processClickEvent=function(n){var i=this;n.preventDefault();t._saveDropdown&&t._saveDropdown.saveOnSerpClicked(function(n){return i._changeSaveButtonToSaved(n)})},t.prototype._processMouseEnterEvent=function(n){n.preventDefault();t._saveDropdown&&t._saveDropdown.saveOnSerpMouseEnter()},t.prototype._processMouseLeaveEvent=function(n){n.preventDefault();t._saveDropdown&&t._saveDropdown.saveOnSerpMouseLeave()},t.prototype._getFeatureState=function(){return this._attrVal},t.prototype._hookUpSaveDropdown=function(){var n=this;Microsoft.Maps.Module.container.instanceAsync("SaveDropdownControl",function(i){var o=Microsoft.Maps.Internal._Gimme,r=_qs(".bm_save_overlay"),s,h,f,e,u,c;r&&(r.style.setProperty("pointer-events","all"),s=o.Internals.parseJSON(r.getAttribute(t._attrName)),i.setEntityInformation(s),i.setShowSaveButton(!1),h=r.getAttribute("data-signinurl"),i.signInUrl=h,t._saveDropdown=i,f=_qs("#b_content"),e=o(r).select("a"),e.length&&(u=e[0],i.setLeftPosition(u.offsetLeft+u.offsetWidth/2),i.setTopPosition(u.offsetTop+u.offsetHeight+4)),c=i.getControl(),f&&f.appendChild(c[0]),i.checkSignInSave(function(t){return n._changeSaveButtonToSaved(t)}))})},t.prototype._preventGLinkPingForSaveButton=function(){var t=_qs(".bm_save_overlay"),n,i;t&&(n=t.querySelector("a"),n&&(i=n.getAttribute("data-h"),n.removeAttribute("data-h"),n.removeAttribute("h"),n.setAttribute("data-h1",i)))},t.prototype._changeSaveButtonToSaved=function(n){var u=_qs(".bm_save_overlay"),f,t,i,r;u&&(f=Microsoft.Maps.Internal._Gimme,t=f(u).select("a"),t.add_class("saved"),t.length&&t[0].children.length?(i=t.select("span"),i.set_text(n),t.select("img").removeFromParent(),r=_d.createElement("div"),r.className="savedIcon",t.insertBefore(r,i)):t.set_text(n))},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-saveoverlay",t._featureName="collections",t}(BootstrapMapsAnswerForOverlayControl)