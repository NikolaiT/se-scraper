(function(){var tt;try{(function(n){var i=-85.05112878,r=85.05112878,e=-180,o=180,t=256,s=48,h=128,c="en-US",l=180/Math.PI,u=Math.PI/180,f=6378137,a=2*Math.PI*f,v=function(){function n(n,i,r,u,f,e,o,s,h,l,a,v,y,p,w,b,k,d,g){var ft,tt,it;s=this._getPrimerPrimitivesFromServerRenderedCard()||s;o=this._getMapBoundsFromCardPrimerResponse()||o;this._downloadedQueuedImage={};this._parentDiv=typeof n=="string"?document.getElementById(n):n;a==="r"&&window.matchMedia("(-ms-high-contrast:active)").matches?(this._tileFormat=p,this._labelFormat=w):(this._tileFormat=v,this._labelFormat=y);this._width=this._parentDiv.offsetWidth;this._sessionId=g;var nt=document.getElementById("b_header"),rt=document.getElementById("b_footer"),ut=0;if(nt&&(ut=rt?nt.clientHeight-rt.clientHeight:nt.clientHeight-20),this._height=this._parentDiv.offsetHeight+ut,this._tilesLoaded=0,this.locationInfo=this._getTilePrimerLocationInfo(u,f,e,o,this._getPoiPrimerPoiLocations(s),h,l,b,k),this._findBestMapViewFromLocationInfo(this.locationInfo),ft=Math.floor(this.locationInfo.zoom),this._zoom=Math.max(3,ft),a==="be2"&&(this._zoom=Math.min(this._zoom,19)),this._maxTileCoordinate=Math.pow(2,this._zoom)-1,this._tileSize=t,this._centerTile=this._latlongToPixelXY(this.locationInfo.centerPointLocation.latitude,this.locationInfo.centerPointLocation.longitude,this._zoom),this._centerTileX=this._centerTile.x/this._tileSize,this._centerTileY=this._centerTile.y/this._tileSize,this._centerOffset={x:-(this._centerTile.x%this._tileSize),y:-(this._centerTile.y%this._tileSize)},this._perf=window.$bsperf,this._centerOffset.x+=this._width/2,this._centerOffset.y+=this._height/2,this._mkt=i||c,this._geopolUserRegion=r,this._tileFormat&&d)tt=new RegExp("amp;","g"),this._tileFormat=this._tileFormat.replace(tt,""),this._labelFormat=this._labelFormat&&this._labelFormat.replace(tt,"");else return;it=/&cstl=(?=&|$)/;this._tileFormat=this._tileFormat.replace(it,"");this._labelFormat=this._labelFormat&&this._labelFormat.replace(it,"");this._tileContainer=document.createElement("div");this._tileContainer.style.cssText="position:relative;overflow:hidden;z-index:1000;width:"+this._width+"px;height:"+this._height+"px";this._parentDiv.appendChild(this._tileContainer);this._addTiles()}return n.prototype.unWrap=function(){this._tileContainer&&this._parentDiv&&this._parentDiv.removeChild(this._tileContainer)},n.prototype._getPrimerPrimitivesFromServerRenderedCard=function(){var n=null,t=document.getElementsByClassName("nonajaxCardPrimer")[0];return t&&window.cardPrimerViewModel&&window.cardPrimerViewModel.PrimerParseSelector&&(n=this._getPrimitivesFromCardPrimerResponse(t.innerHTML,window.cardPrimerViewModel.PrimerParseSelector)),n},n.prototype._getMapBoundsFromCardPrimerResponse=function(){var s,h=document.getElementsByClassName("nonajaxCardPrimer")[0],r,u,f,t,c,e,i,l,o,n;if(h&&window.cardPrimerViewModel&&window.cardPrimerViewModel.PrimerParseSelector&&(r=h.innerHTML,u=window.cardPrimerViewModel.PrimerParseSelector,r))for(f=document.createElement("div"),f.innerHTML=r,t=0,c=u.length;t<c;t++)for(e=f.querySelectorAll(u[t]),i=0,l=e.length;i<l;i++)o=e[i].getAttribute("data-boundingbox"),n=o&&JSON.parse(o),n&&n.boundingBox&&n.boundingBox.length>1&&(s=[n.boundingBox[0].latitude,n.boundingBox[0].longitude,n.boundingBox[1].latitude,n.boundingBox[1].longitude]);return s},n.prototype._getPrimitivesFromCardPrimerResponse=function(n,t){var s=[],f,r,h,e,u,c,o,i;if(n)for(f=document.createElement("div"),f.innerHTML=n,r=0,h=t.length;r<h;r++)for(e=f.querySelectorAll(t[r]),u=0,c=e.length;u<c;u++)o=e[u].getAttribute("data-entity"),o&&(i=JSON.parse(o),i&&s.push({geometry:{x:i.geometry.x,y:i.geometry.y,bounds:[i.geometry.y,i.geometry.x,i.geometry.y,i.geometry.x]}}));return s},n.prototype._getPoiPrimerPoiLocations=function(n){var t;return n&&n.length>0&&(t=[],n.forEach(function(n){t.push({latitude:n.geometry.y,longitude:n.geometry.x})})),t},n.prototype._getTilePrimerLocationInfo=function(n,t,i,r,u,f,e,o,s){var h,l,c;return n&&t?h={centerPointLocation:{latitude:parseFloat(n),longitude:parseFloat(t)},zoom:i}:(l=this._getBootstrapLocation(i,f,e),c=l.split(","),c&&c.length>=3&&(h={centerPointLocation:{latitude:parseFloat(c[0]),longitude:parseFloat(c[1])},zoom:parseFloat(c[2])})),u&&!o&&(u.length>1?h.locations=u:(h.centerPointLocation=u[0],h.zoom=16)),h.bounds=r,!s||window.history&&window.history.state||(h.viewportPadding={left:384,right:70,top:70,bottom:30}),h},n.prototype._getBootstrapLocation=function(n,t,i){var r=t,o;if(!r||r==="0,0"){var u=MapsLocalStorage&&MapsLocalStorage.LocalStorageCache,f=parseFloat(u.getItem("centerLatitude")),e=parseFloat(u.getItem("centerLongitude"));if(isFinite(f)&&isFinite(e))return o=parseFloat(u.getItem("zoom")),isFinite(o)?f+","+e+","+o:f+","+e+","+n;r=i}return r+","+n},n.prototype._findBestMapViewFromLocationInfo=function(t){var i=null,r=null,u=null,f=this._width,e=this._height,o,s,h;if(t.viewportPadding){var c=t.viewportPadding.left,l=t.viewportPadding.top,y=this._width-t.viewportPadding.right,p=this._height-t.viewportPadding.bottom;f=y-c;e=p-l;r=c+f/2;u=l+e/2}if(t.locations&&t.locations.length>1?i=n.accumulate(t.locations):t.bounds&&t.bounds.length==4&&(o={latitude:t.bounds[0],longitude:t.bounds[1]},s={latitude:t.bounds[2],longitude:t.bounds[3]},i=n.accumulate([o,s])),i){var o={latitude:i[0],longitude:i[1]},w={latitude:i[0],longitude:i[3]},b={latitude:i[2],longitude:i[1]},s={latitude:i[2],longitude:i[3]},k={latitude:i[0],longitude:0},d={latitude:i[2],longitude:0},a={latitude:(i[2]+i[0])/2,longitude:(i[1]+i[3])/2},g=n._greatCircleDistance(o,w),nt=n._greatCircleDistance(b,s),tt=Math.max(g,nt),it=n._greatCircleDistance(k,d),rt=tt/f,ut=it/e,v=Math.max(rt,ut),ft=v!==0?n._getZoomFromMetersPerPixel(a.latitude,v):16;t.zoom=ft;t.centerPointLocation=a}h=null;r&&u&&(h=this._getAdjustedLocationAligningToGivenViewportCenter(t.zoom,t.centerPointLocation,r,u));t.centerPointLocation=h||t.centerPointLocation},n.prototype._addTile=function(n,t,i,r,u){var f=this,e=document.createElement("img"),s=Microsoft.Maps.setTimeout(function(){return o()},5e3),o=function(){e.onload=e.onerror=e.onabort=null;window.clearTimeout(s);f._downloadedQueuedImage[t]!==undefined&&u?r?f._downloadedQueuedImage[t]=e:(f._tileContainer.appendChild(e),f._downloadedQueuedImage[t]=null):(f._tileContainer.appendChild(e),f._downloadedQueuedImage[t]&&f._tileContainer.appendChild(f._downloadedQueuedImage[t]),delete f._downloadedQueuedImage[t],++f._tilesLoaded===f._tileCount&&f._perf&&(f._perf.PPLT=Date.now()-f._perf.PPLT,typeof performance!="undefined"&&performance.now&&(f._perf.TPPLT=performance.now())))};e.onload=function(){return o()};e.onerror=e.onabort=function(){return o()};e.src=n;e.style.cssText="position:absolute;z-Index:"+(r?1:0)+";top:"+i.y+"px;left:"+i.x+"px"},n.prototype._getImageUrl=function(n,t){var r=t.charAt(t.length-1),i=n.replace("{quadkey}",t).replace("{x}",Math.floor(this._tileX).toString()).replace("{y}",Math.floor(this._tileY).toString()).replace("{zoom}",this._zoom.toString()).replace("{bbox}","").replace("{subdomain}",(parseInt(r)%2).toString()).replace("{mkt}",this._mkt);return this._geopolUserRegion?i.replace(/{ur}/,this._geopolUserRegion):i.replace(/&ur={ur}/,"")},n.prototype.isTileLoadingCompleted=function(){return this._tilesLoaded===this._tileCount},n.prototype._addTiles=function(){var i,n,t;for(this._tileX=this._centerTileX,this._tileY=this._centerTileY,this._offset=this._centerOffset,this._direction=0,this._movesLeft=1,this._step=1,i=0,this._tileCount=0;i<h&&this._tileCount<s;i++)this._isVisible(this._offset)&&(n=this._getQuadKey(),n&&(t=!!this._labelFormat&&this._isLabelVisible(this._offset),this._addTile(this._getImageUrl(this._tileFormat,n),n,this._offset,!1,t),t&&this._addTile(this._getImageUrl(this._labelFormat,n),n,this._offset,!0,t),this._tileCount++)),this._incrementSpiral()},n.prototype._getQuadKey=function(){var i,n,t,r;if(this._tileY<0||this._tileY>this._maxTileCoordinate)return null;for(i="",n=this._zoom;n>0;n--)t=0,r=1<<n-1,(this._tileX&r)!=0&&t++,(this._tileY&r)!=0&&(t+=2),i+=t;return i},n.prototype._isVisible=function(n){return n.y>-this._tileSize&&n.y<this._height&&n.x>-this._tileSize&&n.x<this._width},n.prototype._isLabelVisible=function(n){var t=this._tileSize*.4;return n.y>-this._tileSize+t&&n.y<this._height-t&&n.x>-this._tileSize+t&&n.x<this._width-t},n.prototype._incrementSpiral=function(){switch(this._direction){case 0:this._tileX++;this._offset.x+=this._tileSize;break;case 1:this._tileY--;this._offset.y-=this._tileSize;break;case 2:this._tileX--;this._offset.x-=this._tileSize;break;case 3:this._tileY++;this._offset.y+=this._tileSize}this._tileX>this._maxTileCoordinate?this._tileX=0:this._tileX<0&&(this._tileX=this._maxTileCoordinate);this._movesLeft--;this._movesLeft<=0&&(this._movesLeft=Math.floor(this._step+=.5),++this._direction>3&&(this._direction=0))},n.prototype._latlongToPixelXY=function(n,t,u){var h=this._median(n,i,r),c=this._median(t,e,o),l=(c+180)/360,s=Math.sin(h*Math.PI/180),a=.5-Math.log((1+s)/(1-s))/(4*Math.PI),f=this._tileSize<<u;return{x:this._median(l*f+.5,0,f-1),y:this._median(a*f+.5,0,f-1)}},n.prototype._median=function(n,t,i){return Math.min(Math.max(n,t),i)},n._greatCircleDistance=function(t,i){var r=n._degreesToRadians(i.latitude),u=n._degreesToRadians(t.latitude),s=n._degreesToRadians(i.longitude),h=n._degreesToRadians(t.longitude),c=Math.abs(r-u),l=Math.abs(s-h),e=Math.sin(c/2),o=Math.sin(l/2),a=2*Math.asin(Math.sqrt(e*e+Math.cos(u)*Math.cos(r)*o*o));return f*a},n._degreesToRadians=function(n){return n*u},n.accumulate=function(t){for(var i,r=0;r<t.length;r++)i?(i[0]=Math.max(i[0],t[r].latitude),i[1]=Math.min(i[1],t[r].longitude),i[2]=Math.min(i[2],t[r].latitude),i[3]=Math.max(i[3],t[r].longitude)):i=[t[r].latitude,t[r].longitude,t[r].latitude,t[r].longitude];var e=i[0],f=i[1],o=i[2],u=i[3];return Math.abs(u-f)>360&&(f=-180,u=180),f=n._normalizeLongitude(f),u=n._normalizeLongitude(u),f>u&&(u+=360),i[1]=f,i[3]=u,i},n._normalizeLongitude=function(n){return n<-180||n>180?n-Math.floor((n+180)/360)*360:n},n._getZoomFromMetersPerPixel=function(i,r){return Math.log(Math.cos(n._degreesToRadians(i))*a/(t*r))/Math.log(2)},n.prototype._getAdjustedLocationAligningToGivenViewportCenter=function(i,r,u,f){var e=Math.pow(2,i),o=e*t,s=e*t,h=n._projectToMercatorX(r.latitude,r.longitude),c=n._projectToMercatorY(r.latitude,r.longitude),l=u-this._width/2,a=f-this._height/2,v=h-l/o,y=c-a/s;return{latitude:n._projectMercatorYToLatitude(y),longitude:n._projectMercatorXToLongitude(v)}},n._projectToMercatorX=function(n,t){return t/360+.5},n._projectToMercatorY=function(n){if(n>=r)return 0;if(n<=i)return 1;var t=Math.sin(n*u);return.5-Math.log((1+t)/(1-t))*1/(4*Math.PI)},n._projectMercatorXToLongitude=function(n){return(n-.5)*360},n._projectMercatorYToLatitude=function(n){return 90-2*Math.atan(Math.exp((n*2-1)*Math.PI))*l},n}();n.Primer=v})(tt||(tt={}));var n=window.$MicrosoftMaps8,u=n.Internal,w=n.Anchor,ot=u._Color,ti=u._ComponentNames,or=n.CompositeMapMode,sr=u.CanvasDrawingContext,hr=n.DefaultTemplateSelector,s=u._BaseMapTemplateSelector,yt=n.BasicTemplate,st=n.BirdseyeV2Manager,ii=n.BirdseyeV2Metadata,it=n.BitmapImageTemplate,cr=u._BoundsAccumulator,c=u._Gimme,ri=n.GlobalConfig,i=u._Helper,r=u._JSEvent,lr=u._LatLonCrs,ar=u._LayerRendererManager,ui=u._AnimationRenderer,ht=n.LocationRect,y=u.MapHelper,fi=n.MapLayer,v=n.Location,ei=n.MapView,oi=n.MapViewAnimator,si=n.MercatorCubeCrs,ct=u._MercatorTileUtility,hi=u._ObservableCollection,ci=n.VectorMapLayer,li=u._Overlay,ai=u.ControlTemplate,lt=u._Observable,vr=u._ObservableObject,l=u._ObservableObjectChangedArgs,yr=u._OverlayEntity,vi=n.ImageryMapLayer,f=n.Point,yi=n.RasterImageryScene,pi=n.SimpleAreaPrimitive,wi=n.SimpleLinePrimitive,bi=n.SimplePointPrimitive,pt=n.LabelVisibility;n.LabelOverlay=pt;var pr=n.Size,wt=n.VectorImageTemplate,rt=n.ZoomLevel,t=n.MapTypeId,at=u._MapAuthentication,ki=u._LoggingWrapper,di='<div style:display="{Binding visible Converter=boolToDisplay}" style:z-index="{Binding zIndex}">    <div class="{Binding options Converter=optionsToClass}" style:display="{Binding isDefault Converter=boolToDisplay}" data-tag="SDK.Infobox">        <a class="infobox-close" href="javascript:void(0)" event:click="_onCloseClicked" event:touchstart="_onCloseClicked" style:display="{Binding showCloseButton Converter=boolToDisplay}" data-tag="SDK.Infobox.CloseBtn">            <img class="infobox-close-img" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE0cHgiIHdpZHRoPSIxNHB4IiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiPjxwYXRoIGQ9Ik03LDBDMy4xMzQsMCwwLDMuMTM0LDAsN2MwLDMuODY3LDMuMTM0LDcsNyw3YzMuODY3LDAsNy0zLjEzMyw3LTdDMTQsMy4xMzQsMTAuODY3LDAsNywweiBNMTAuNSw5LjVsLTEsMUw3LDhsLTIuNSwyLjVsLTEtMUw2LDdMMy41LDQuNWwxLTFMNyw2bDIuNS0yLjVsMSwxTDgsN0wxMC41LDkuNXoiLz48L3N2Zz4=" alt="close infobox" />        <\/a>        <div class="infobox-body">            <div class="infobox-title" data-tag="SDK.Infobox.Title">                <TextBlock Text="{Binding title}" />            <\/div>            <div class="infobox-info" data-tag="SDK.Infobox.Description" style:display="{Binding showDescription Converter=boolToDisplay}">            <\/div>            <div class="infobox-actions" style:display="{Binding actions Converter=boolToDisplay}" data-tag="SDK.Infobox.Actions">                <ul class="infobox-actions-list">                    <ItemsControl ItemsSource="{Binding actions}">                        <ItemsControl.ItemTemplate>                            <DataTemplate>                                <li>                                    <a href="javascript:void(0)" title="{Binding label}" event:click="eventHandler"  event:touchstart="eventHandler">                                        <TextBlock Text="{Binding label}" />                                    <\/a>                                <\/li>                            <\/DataTemplate>                        <\/ItemsControl.ItemTemplate>                    <\/ItemsControl>                <\/ul>            <\/div>        <\/div>        <div class="infobox-stalk" style:display="{Binding showPointer Converter=boolToDisplay}" data-tag="SDK.Infobox.Pointer">        <\/div>    <\/div>    <div class="InfoboxCustom" style:display="{Binding isCustom Converter=boolToDisplay}">    <\/div><\/div>',a=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ut=function(){function n(t){if(this._registeredJsEvents={},this._options={beneathLabels:n._defaultOptions.beneathLabels,showInBirdseye:n._defaultOptions.showInBirdseye,drawOrder:n._defaultOptions.drawOrder},t&&(typeof t.beneathLabels=="boolean"&&(this._options.beneathLabels=t.beneathLabels),typeof t.showInBirdseye=="boolean"&&(this._options.showInBirdseye=t.showInBirdseye),typeof t.drawOrder=="number")){this._useDrawOrder=!0;var i=Math.round(t.drawOrder);this._options.drawOrder=i?i>0?Math.min(i,n._maxDrawOrder):Math.max(i,-1*n._maxDrawOrder):n._defaultOptions.drawOrder}}return n.prototype.getHtmlElement=function(){return this._htmlElement&&this._htmlElement[0]},n.prototype.setHtmlElement=function(n){var t=c(n);this._map&&(this._insertHtmlElement(t),this._htmlElement&&this._htmlElement.removeFromParent());this._htmlElement=t},n.prototype.getOptions=function(){return this._options},n.prototype.onAdd=function(){},n.prototype.onRemove=function(){},n.prototype.onLoad=function(){},n.prototype.attachMap=function(n){var t=this,i;if(this._map)throw"This custom overlay is already attached to an existing map";n&&(this.onAdd(),this._map=n,i=this._map.getV8Map(),ui.containsCustomOverlay(),this._onMapTypeChanged=i.mapTypeChanged.add(function(){t._map&&i.getFrameManager().frameRendered.addOne(function(){t._insertHtmlElement(t._htmlElement)})}),i.getLabelController()?(this._insertHtmlElement(this._htmlElement),this.onLoad()):i.labelControllerLoaded.addOne(function(){t._insertHtmlElement(t._htmlElement);t.onLoad()}))},n.prototype.detachMap=function(n){if(this._map&&this._map!==n)throw"Cannot remove custom overlay from this map since it's attached to another map instance";this._internalCleanup()},n.prototype.getMap=function(){return this._map},n.prototype.dispose=function(){for(var n in this._registeredJsEvents)i._undefineJSEventForDomEvent(this._htmlElement,n,this._registeredJsEvents[n].id),this._registeredJsEvents[n].dispose();this._internalCleanup();i._nullifyClass(this)},n.prototype._internalCleanup=function(){this._htmlElement&&this._htmlElement.removeFromParent();this._onMapTypeChanged&&this._onMapTypeChanged.dispose();this._map=null;this.onRemove()},n.prototype._insertHtmlElement=function(n){var r=this._useDrawOrder?this._options.drawOrder:this._options.beneathLabels?-1:1,u=this._map.getMode(),t,i;this._map&&this._map.getImageryId()!=="Streetside"&&(t=2e4,i=u.getRootElement(),n.set_style({zIndex:t+r}),i.append(n),this._stopEventsPropagation())},n.prototype._stopEventsPropagation=function(){var r,t,n;if(this._htmlElement)for(r={stopPropagation:!0},t=["mousemove","mousedown","mouseup","click","dblclick","contextmenu","touchmove","touchstart","touchend","keydown","keyup"],n=0;n<t.length;n++)this._registeredJsEvents[t[n]]=i._defineJSEventForDomEvent(this._htmlElement,t[n],r)},n._maxDrawOrder=100,n._drawOrderAttribute="data-draworder",n._defaultOptions={beneathLabels:!0,showInBirdseye:!1,drawOrder:-1},n}(),gi=function(n){function t(i){var r=n.call(this,null,new ei(rt.toLocation(new v(0,0),0,!0)),si.instance,"CustomTileSource_"+t._tileSourceId++,i&&i.uriConstructor?i.uriConstructor:undefined,"",null,null,null,null,null,i&&i.width?i.width:ct.tileSize)||this;return r._options=i,r}return a(t,n),t.prototype.getHeight=function(){return this._options&&this._options.height?this._options.height:ct.tileSize},t.prototype.getUriConstructor=function(){return this._tileUrlTemplate},t.prototype.getWidth=function(){return this._options&&this._options.width?this._options.width:ct.tileSize},t.prototype.toString=function(){throw"Not supported";},t.prototype.getBounds=function(){return this._options&&this._options.bounds},t.prototype.getMinZoom=function(){return this._options&&this._options.minZoom},t.prototype.getMaxZoom=function(){return this._options&&this._options.maxZoom},t._tileSourceId=0,t}(yi),nr=function(n){function t(i){var u=n.call(this)||this;return u._layerOptions={visible:t._defaultLayerOptions.visible,frameRate:t._defaultLayerOptions.frameRate,mercator:t._defaultLayerOptions.mercator,maxTotalLoadTime:t._defaultLayerOptions.maxTotalLoadTime,loadingScreen:t._defaultLayerOptions.loadingScreen,autoPlay:t._defaultLayerOptions.autoPlay},u._disposables=[],u._primers=[],u._currentFrameIndex=0,u._animationState=0,u.preLoadStarted=new r,u.preLoadEnded=new r,u.onFrameLoaded=new r,u.setOptions(i),u}return a(t,n),t.prototype.onAdd=function(){var n=document.createElement("div");n.style.position="absolute";this.setHtmlElement(n)},t.prototype.onRemove=function(){var n=this._layerOptions&&this._layerOptions.loadingScreen;n&&n.getMap()&&n.detachMap(n.getMap());this._animationState===1&&this.stop();i._clearDisposables(this._disposables)},t.prototype.onLoad=function(){var n=this,t=this._map.getV8Map(),r=t.getActualSize(),u,i;this._htmlElement.set_style({height:r.height,width:r.width});u=t.actualSizeChanged.add(function(){n._removeAllTiles();var i=t.getActualSize();n._htmlElement.set_style({height:i.height,width:i.width});n._preLoadAllTiles()});this._disposables.push(u);i=this._map.getMode();i.onPaint.isPreviouslyInvoked?this._preLoadTilesAfterPaint():i.onPaint.addOne(function(){n._preLoadTilesAfterPaint()})},t.prototype.setOptions=function(n){if(n){if(typeof n.frameRate=="number"&&(this._layerOptions.frameRate=n.frameRate,this._animationState===1&&(this.pause(),this.play())),this._layerOptions.maxTotalLoadTime=typeof n.maxTotalLoadTime=="number"?n.maxTotalLoadTime:this._layerOptions.maxTotalLoadTime,this._layerOptions.visible=typeof n.visible=="boolean"?n.visible:this._layerOptions.visible,this._map&&(this._layerOptions.visible?(this._toggleFrameVisibility(this._currentFrameIndex,this._animationState!==3),this._animationState===1&&this.play()):(this._clearAnimation(),this._toggleFrameVisibility(this._currentFrameIndex,!1))),n.mercator&&(this._layerOptions.mercator=n.mercator,this._map&&(this._removeAllTiles(),this._preLoadAllTiles())),n.loadingScreen){var t=this._layerOptions.loadingScreen.getMap();t&&this._layerOptions.loadingScreen.detachMap(t);this._layerOptions.loadingScreen=n.loadingScreen}this._layerOptions.autoPlay=typeof n.autoPlay=="boolean"?n.autoPlay:this._layerOptions.autoPlay;typeof n.autoPlay=="boolean"&&(this._animationState=this._layerOptions.autoPlay?0:2)}},t.prototype.getTileSources=function(){return this._layerOptions.mercator},t.prototype.getFrameRate=function(){return this._layerOptions.frameRate},t.prototype.getMaxTotalLoadTime=function(){return this._layerOptions.maxTotalLoadTime},t.prototype.getVisible=function(){return this._layerOptions.visible},t.prototype.getLoadingScreen=function(){return this._layerOptions.loadingScreen},t.prototype.getAnimationState=function(){return this._animationState},t.prototype.stop=function(){this._animationState=3;this._clearAnimation();this._map&&this._toggleFrameVisibility(this._currentFrameIndex,!1);this._currentFrameIndex=0},t.prototype.pause=function(){this._animationState=2;this._clearAnimation()},t.prototype.play=function(){var n=this;this._clearAnimation();this._animationState=1;this._map&&(this._toggleFrameVisibility(this._currentFrameIndex,!0),this._animation=Microsoft.Maps.setInterval(function(){if(n._map&&n._map.getImageryId()!=="Streetside"){var t=n._currentFrameIndex;n._currentFrameIndex=n._currentFrameIndex+1===n._primers.length?0:n._currentFrameIndex+1;n._toggleFrameVisibility(n._currentFrameIndex,!0);n._toggleFrameVisibility(t,!1)}},this._layerOptions.frameRate))},t.prototype.dispose=function(){this.onRemove();n.prototype.dispose.call(this)},t.prototype._removeAllTiles=function(){this._clearAnimation();this._htmlElement.clear()},t.prototype._preLoadAllTiles=function(){var r,n;this.preLoadStarted.invoke();this._layerOptions.loadingScreen.getMap()||this._layerOptions.loadingScreen.attachMap(this._map);this._primers=[];var e=this._map.getCenter().latitude,o=this._map.getCenter().longitude,f=this._map.getZoom(),i=this._layerOptions.mercator;for(r=0;r<i.length;r++)if(n=document.createElement("div"),n.className=t._layerFrameClassName,n.style.visibility="hidden",n.style.position="absolute",n.style.height="100%",n.style.width="100%",this._htmlElement.append(n),(typeof i[r].getMaxZoom()!="number"||!(f>i[r].getMaxZoom()))&&(typeof i[r].getMinZoom()!="number"||!(f<i[r].getMinZoom()))){var s=i[0].getBounds()&&i[0].getBounds().bounds,u=Microsoft.Maps.GlobalConfig.dynamicProperties,h=new tt.Primer(n,u.market,u.isGeopolUserRegion&&u.userRegion?u.userRegion:null,e.toString(),o.toString(),f,s,null,null,null,null,i[r].getUriConstructor(),null,null,null,null,null,!0,null);this._primers.push(h);n.firstElementChild.style.zIndex="auto"}this._checkPreLoadTilesComplete()},t.prototype._checkPreLoadTilesComplete=function(){var n=this,t=function(){clearInterval(i);clearTimeout(r);n._layerOptions.visible&&n._animationState!==3&&n._map&&n._toggleFrameVisibility(n._currentFrameIndex,!0);var t=n._layerOptions.loadingScreen;t.getMap()&&t.detachMap(t.getMap());n.preLoadEnded.invoke();n._layerOptions.visible&&n._animationState<2&&n._map&&n.play()},i=Microsoft.Maps.setInterval(function(){for(var r=!0,i=0;i<n._primers.length;i++)if(!n._primers[i].isTileLoadingCompleted()){r=!1;break}r&&t()},500),r=Microsoft.Maps.setTimeout(function(){t()},this._layerOptions.maxTotalLoadTime)},t.prototype._clearAnimation=function(){this._animation&&(clearInterval(this._animation),this._animation=null)},t.prototype._toggleFrameVisibility=function(n,i){if(this._htmlElement){var r=this._htmlElement.select("."+t._layerFrameClassName);r[n]&&(r[n].style.visibility=i?"visible":"hidden",i&&this.onFrameLoaded.invoke({index:this._currentFrameIndex,animatedTileLayer:this}))}},t._createDefaultLoadingScreen=function(){var n=new ut({beneathLabels:!1}),t;return n.onAdd=function(){if(!n.getHtmlElement()){var t=document.createElement("div");t.innerText="Loading tile animation...";t.style.position="absolute";t.style.backgroundColor="rgba(235, 233, 226, 0.75)";t.style.textAlign="center";t.style.verticalAlign="middle";n.setHtmlElement(t)}},n.onLoad=function(){var i=n.getMap().getV8Map().getActualSize();n.getHtmlElement().style.height=i.height+"px";n.getHtmlElement().style.width=i.width+"px";n.getHtmlElement().style.lineHeight=i.height+"px";t=n.getMap().getV8Map().actualSizeChanged.add(function(){var t=n.getMap().getV8Map().getActualSize();n.getHtmlElement().style.height=t.height+"px";n.getHtmlElement().style.width=t.width+"px";n.getHtmlElement().style.lineHeight=i.height+"px"})},n.onRemove=function(){t.dispose&&t.dispose()},n},t.prototype._preLoadTilesAfterPaint=function(){var n=this;this._disposables.push(this._map.viewchangestart.add(function(){n._removeAllTiles()}));this._disposables.push(this._map.viewchangeend.add(function(){n._preLoadAllTiles()}));this._preLoadAllTiles()},t._defaultLayerOptions={visible:!0,frameRate:1e3,mercator:null,maxTotalLoadTime:15e3,loadingScreen:t._createDefaultLoadingScreen(),autoPlay:!0},t._layerFrameClassName="layerFrame",t}(ut),tr=function(){function n(){}return n}(),d=function(n){function t(i,u){var f=this;return typeof u!="number"&&(u=t._zIndex++),f=n.call(this,i,null,null,u)||this,f._changedEventHandlers=[],f._disposables.push(f.primitiveMoveStarted.add(function(n){return f._onPrimitiveMoved(n,!0)}),f.primitiveMoveContinued.add(function(n){return f._onPrimitiveMoved(n,!0)}),f.primitiveMoveStopped.add(function(n){return f._onPrimitiveMoved(n,!1)}),f.invalidated=new r),f._primitives=[],f.setDataSource(f),f.setRenderTarget(2),f.overlayEvent=0,f}return a(t,n),t.prototype.clear=function(){this._lastClearedPrimitives=this._primitives;i._clearDisposables(this._changedEventHandlers);this._primitives=[];this._primitiveChanged(this._lastClearedPrimitives)},t.prototype.add=function(n,t){var i,r,u,f,e;for(i=typeof n.length=="number"?n:[n],typeof t=="number"?(r=[t,0],r=r.concat(i),Array.prototype.splice.apply(this._primitives,r)):Array.prototype.push.apply(this._primitives,i),u=0,f=i.length;u<f;u++)e=i[u],e.layer=this;this._observePrimitiveChanges(i);this._primitiveChanged(i)},t.prototype.remove=function(n){var t=this._primitives.indexOf(n);return this.removeAt(t)},t.prototype.removeAt=function(n){var t,i;return n>=0&&n<this._primitives.length&&(t=this._primitives.splice(n,1)[0],i=this._changedEventHandlers[n],i&&i.dispose(),this._changedEventHandlers.splice(n,1),this._primitiveChanged([t])),t},t.prototype.bringToTop=function(n){var t=this._primitives.indexOf(n),i;t!==this._primitives.length-1&&t>=0&&(this._primitives.splice(t,1),i=this._changedEventHandlers.splice(t,1),Array.prototype.push.apply(this._changedEventHandlers,i),Array.prototype.push.apply(this._primitives,[n]),this._primitiveChanged([n]))},t.prototype.getPrimitives=function(n,t){var i,r,f,u;if(!n&&!t)return this._primitives;if(i=[],this._primitives&&this.getVisible())for(r=0,f=this._primitives.length;r<f;r++)u=this._primitives[r],(!u.getVisible||u.getVisible())&&i.push(u);return t&&t({primitives:i}),i},t.prototype.setPrimitives=function(n){this.clear();this.add(n,null)},t.prototype.raiseInvalidatedEvent=function(n){var t=this,i;this._invalidatedQueued||(i=n?n:{layerId:this.getId()},this._invalidatedQueued=!0,Microsoft.Maps.setTimeout(function(){t._invalidatedQueued=!1;t.invalidated&&t.invalidated.invoke(i)},0))},t.prototype.dispose=function(t){t&&(i._clearDisposables(this._primitives),i._clearDisposables(this._lastClearedPrimitives));i._clearDisposables(this._changedEventHandlers);this._primitives=[];this._lastClearedPrimitives=[];n.prototype.dispose.call(this)},t.prototype.addToDisposables=function(n){this._disposables&&this._disposables.push(n)},t.prototype._observePrimitiveChanges=function(n,t){var h=this,f,i,r,s,e,o,u;for(f=typeof n.length=="number"?n:[n],i=[],r=0,s=f.length;r<s;r++)e=null,o=f[r],o.changed&&(e=o.changed.add(function(n){h._primitiveChanged(n)})),i.push(e);t?(u=[t,0],u=u.concat(i),Array.prototype.splice.apply(this._changedEventHandlers,u)):Array.prototype.push.apply(this._changedEventHandlers,i)},t.prototype._primitiveChanged=function(n){var t={layerId:this.getId(),entityIds:null},r;n&&(r=n&&n.sender?[n.sender]:n,t.entityIds=i._getPrimitiveIds(r));this.raiseInvalidatedEvent(t)},t.prototype._onPrimitiveMoved=function(n,t){var i=n.primitive,r;i instanceof o&&i.isMoveEnabled()&&(r=i,r.setLocation(n.location,t))},t._zIndex=1e4,t}(ci),g=function(){function n(n,t){this.collection=n;this.data=t}return n}(),bt=function(n){function t(i,u){var f=n.call(this,"EntityCollectionLayer_"+t._layerId++,i&&i.zIndex)||this;return f._infoboxCollection=[],f._options={},f._options.zIndex=f.getZIndex(),f._options.visible=i&&typeof i.visible=="boolean"?i.visible:t._defaultOptions.visible,f.setVisible(f._options.visible),f._disposables.push(f.entityadded=new r,f.entitychanged=new r,f.entityremoved=new r),f._childCollectionElementAddedHandlers={},f._childCollectionElementRemovedHandlers={},f._childCollections={},f._v8map=u,f}return a(t,n),t.prototype.get=function(n){return n>=0&&n<this._primitives.length?this._primitives[n]:null},t.prototype.getLength=function(){return this._primitives.length},t.prototype.indexOf=function(n){return this._primitives.indexOf(n)},t.prototype.insert=function(n,t){this._addInternal(n,t)},t.prototype.pop=function(){return this.removeAt(this._primitives.length-1)},t.prototype.push=function(n){this._addInternal(n)},t.prototype.remove=function(i){var u=[],r=[],e,o;if(i instanceof t){i.getPrimitives(null,function(n){u=n.primitives});var f=i.getId(),s=this._childCollectionElementAddedHandlers[f],h=this._childCollectionElementRemovedHandlers[f];i.entityadded.remove(s);i.entityremoved.remove(h);delete this._childCollectionElementAddedHandlers[f];delete this._childCollectionElementRemovedHandlers[f];delete this._childCollections[f]}else i instanceof Array?u=i:u.push(i);for(e=0;e<u.length;e++)o=n.prototype.remove.call(this,u[e]),o&&r.push(o);return r.length===0?null:r.length===1?(this.entityremoved.invoke(new g(this,r[0])),r[0]):(this.entityremoved.invoke(new g(this,r)),r)},t.prototype.removeAt=function(t){var i=n.prototype.removeAt.call(this,t);return i&&this.entityremoved.invoke(new g(this,i)),i},t.prototype.clear=function(){var t,i;for(t in this._childCollections)this._childCollections[t].entityadded.remove(this._childCollectionElementAddedHandlers[t]),this._childCollections[t].entityremoved.remove(this._childCollectionElementRemovedHandlers[t]);this._childCollectionElementAddedHandlers={};this._childCollectionElementRemovedHandlers={};this._childCollections={};i=this._primitives;n.prototype.clear.call(this);this.entityremoved.invoke(new g(this,i))},t.prototype.setOptions=function(n){this._options=n},t.prototype.toString=function(){throw"not implemented";},t.prototype.dispose=function(t){this._options=null;this._childCollectionElementAddedHandlers=null;this._childCollectionElementRemovedHandlers=null;this._childCollections=null;i._clearDisposables(this._disposables);n.prototype.dispose.call(this,t)},t.prototype._addInfoboxHelper=function(n){if(n)for(var t=0;t<n.length;t++)this.push(n[t])},t.prototype._addInternal=function(i,r){var s=this,f,u,e,o;i instanceof vt?(this._v8map&&(console.warn("This API is deprecated. Please use Infobox.setMap. For more information please see https://www.bing.com/api/maps/sdkrelease/mapcontrol/isdk#addDefaultInfobox+JS"),i.setMap(this._v8map)),this._infoboxCollection.push(i)):i instanceof t?(this._addInfoboxHelper(i._infoboxCollection),i.getPrimitives(null,function(n){f=n.primitives}),u=i.getId(),e=this._childCollectionElementAddedHandlers[u],e||(e=function(n){n.data&&s.push(n.data);n.collection&&s._addInfoboxHelper(n.collection._infoboxCollection)},this._childCollectionElementAddedHandlers[u]=e,this._disposables.push(i.entityadded.add(e))),o=this._childCollectionElementRemovedHandlers[u],o||(o=function(n){n.data&&s.remove(n.data)},this._childCollectionElementRemovedHandlers[u]=o,this._disposables.push(i.entityremoved.add(o))),this._childCollections[u]||(this._childCollections[u]=i)):f=i;f=f||[];n.prototype.add.call(this,f,r);this.entityadded.invoke(new g(this,f))},t._layerId=1,t._defaultOptions={visible:!0},t}(d),p=function(){function n(){}return n.addHandler=function(t,i,r){var u=n._getWrappedEventArgs(t,i,r);return u.target[u.eventName].add(u.callback)},n.addThrottledHandler=function(t,i,r,u){var f=n._getWrappedEventArgs(t,i,r);return f.target[f.eventName].addThrottled(f.callback,u)},n.hasHandler=function(t,i){var r=n._getWrappedEventArgs(t,i);return r.target[r.eventName].hasHandlersRegistered()},n.invoke=function(t,i,r){var u=n._getWrappedEventArgs(t,i);u.target[u.eventName].invoke(r)},n.removeHandler=function(n){n&&n.dispose()},n.addOne=function(t,i,r){var u=n._getWrappedEventArgs(t,i,r);u.target[u.eventName].addOne(u.callback)},n._getWrappedEventArgs=function(n,t,i){var u={target:n,eventName:t,callback:i},e,s,h,c,f;return n instanceof et?(u.callback=function(t){t&&(t.target=n,t.targetType="map");i&&i(t)},e={click:"mapTapped",rightclick:"contextMenuInvoked",maptypechanged:"mapTypeChanged",mousedown:"pointerPressed",mouseup:"pointerReleased",mousemove:"pointerMoved",mouseover:"pointerEntered",mouseout:"pointerExited",mousewheel:"pointerWheelChanged",dblclick:"mapDoubleTapped",mapresize:"mapResized",mapsetview:"setViewInvoked"},f=e[t],f&&(u.eventName=f,u.target=n.getV8Map())):n instanceof o||n instanceof b||n instanceof nt?(s={click:"click",dblclick:"dblclick",drag:"drag",dragend:"dragend",dragstart:"dragstart",mousedown:"mousedown",mouseup:"mouseup",mouseout:"mouseout",mouseover:"mouseover",changed:"changed"},u.eventName=s[t],u.eventName&&!u.target[u.eventName]&&(u.target[u.eventName]=new r)):n instanceof vt?(h={click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",infoboxChanged:"infoboxChanged"},u.eventName=h[t],u.eventName&&!u.target[u.eventName]&&(u.target[u.eventName]=new r)):n instanceof d&&(u.callback=function(n){n&&(n.targetType="layer",n.eventName=t);i&&i(n)},c={click:"primitiveTapped",dblclick:"primitiveDoubleTapped",rightclick:"contextMenuInvoked",mouseup:"primitivePointerReleased",mouseover:"primitiveHoverStarted",mousedown:"primitivePointerPressed",mouseout:"primitiveHoverStopped"},f=c[t],f&&(u.eventName=f)),u},n}(),kt=function(){function n(n,t,i,r){this.a=n>1?n/255:n;this.r=t;this.g=i;this.b=r}return n.clone=function(t){var i;return t&&(i=new n(t.a,t.r,t.g,t.b)),i},n.fromHex=function(t){var r,i;return t&&(i=parseInt(t.slice(1),16),r=new n(255,i>>16&255,i>>8&255,i&255)),r},n.fromRGBA=function(t){var u=t.indexOf("("),f=t.indexOf(")"),i,r;if(u===-1||f===-1)return null;if(i=t.slice(u+1,f).split(","),r=null,i&&(i.length===4||i.length===3)){var e=parseInt(i[0]),o=parseInt(i[1]),s=parseInt(i[2]),h=i.length===4?parseFloat(i[3]):1;r=new n(h,e,o,s)}return r},n.prototype.clone=function(){return n.clone(this)},n.prototype.getOpacity=function(){return this.a},n.prototype.toHex=function(n){var t="#",i;if(n)for(i=0;i<n.length;i++)switch(n.charAt(i)){case"a":t+=this._toHexInternal(Math.floor(this.a*255));break;case"r":t+=this._toHexInternal(this.r);break;case"g":t+=this._toHexInternal(this.g);break;case"b":t+=this._toHexInternal(this.b)}else t+=this._toHexInternal(this.r)+this._toHexInternal(this.g)+this._toHexInternal(this.b);return t},n.prototype.toRgba=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},n.prototype._toHexInternal=function(n){var t=n.toString(16);return t.length==1?"0"+t:t},n}(),ir=function(n){function t(t){var i=n.call(this,{beneathLabels:typeof t.beneathLabels=="boolean"?t.beneathLabels:!0})||this;return i._groundOverlayOptions={beneathLabels:!0,backgroundColor:"transparent",bounds:null,imageUrl:null,opacity:1,rotation:0,visible:!0},i.setOptions(t),i}return a(t,n),t.prototype.clear=function(){this._groundOverlayOptions={beneathLabels:!0,backgroundColor:"transparent",bounds:null,imageUrl:null,opacity:1,rotation:0,visible:!0};this.setHtmlElement(null)},t.prototype.getBackgroundColor=function(){return this._groundOverlayOptions.backgroundColor},t.prototype.getBounds=function(){return this._groundOverlayOptions.bounds},t.prototype.getImageUrl=function(){return this._groundOverlayOptions.imageUrl},t.prototype.getOpacity=function(){return this._groundOverlayOptions.opacity},t.prototype.getRotation=function(){return this._groundOverlayOptions.rotation},t.prototype.getVisible=function(){return this._groundOverlayOptions.visible},t.prototype.setOptions=function(n){n&&typeof n.beneathLabels=="boolean"&&(this._groundOverlayOptions.beneathLabels=n.beneathLabels);typeof n.backgroundColor!="undefined"&&(this._groundOverlayOptions.backgroundColor=n.backgroundColor,this._img&&(this._img.style.backgroundColor=typeof this._groundOverlayOptions.backgroundColor=="string"?this._groundOverlayOptions.backgroundColor:this._groundOverlayOptions.backgroundColor.toRgba()));typeof n.opacity=="number"&&(this._groundOverlayOptions.opacity=n.opacity,this._img&&(this._img.style.opacity=this._groundOverlayOptions.opacity.toString()));typeof n.rotation=="number"&&(this._groundOverlayOptions.rotation=n.rotation,this._rotateGroundOverlay());n.bounds instanceof ht&&(this._groundOverlayOptions.bounds=n.bounds);typeof n.imageUrl!="undefined"&&(this._groundOverlayOptions.imageUrl=n.imageUrl,this._loadGroundOverlayImage());this.setVisible(n.visible);this._repositionGroundOverlay()},t.prototype.setVisible=function(n){typeof n=="boolean"&&(this._groundOverlayOptions.visible=n,this._img&&(n?(this._img.style.display="",this._repositionGroundOverlay()):this._img.style.display="none"))},t.prototype.onLoad=function(){var n=this;this._repositionGroundOverlay();p.addHandler(this.getMap(),"viewchange",function(){n._repositionGroundOverlay()});p.addHandler(this.getMap(),"mapresize",function(){n._repositionGroundOverlay()});p.addHandler(this.getMap(),"mapsetview",function(){n._repositionGroundOverlay()})},t.prototype.onRemove=function(){},t.prototype.dispose=function(){this.clear();n.prototype.dispose.call(this)},t.prototype._loadGroundOverlayImage=function(){this._groundOverlayOptions.imageUrl?(this._img=document.createElement("img"),this._img.src=this._groundOverlayOptions.imageUrl,this._img.style.width="100%",this._img.style.height="100%",this._img.style.position="absolute",this._img.style.display=this._groundOverlayOptions.visible?"":"none",this._groundOverlayOptions.backgroundColor&&(this._img.style.backgroundColor=typeof this._groundOverlayOptions.backgroundColor=="string"?this._groundOverlayOptions.backgroundColor:this._groundOverlayOptions.backgroundColor.toRgba()),typeof this._groundOverlayOptions.opacity=="number"&&(this._img.style.opacity=this._groundOverlayOptions.opacity.toString()),this._rotateGroundOverlay(),this.setHtmlElement(this._img)):this.setHtmlElement(null)},t.prototype._rotateGroundOverlay=function(){var t,n;this._img&&(t=this._groundOverlayOptions.rotation,t||(t=0),n="rotate("+t+"deg)",this._img.style["-webkit-transform"]=n,this._img.style["-moz-transform"]=n,this._img.style["-ms-transform"]=n,this._img.style["-o-transform"]=n,this._img.style.transform=n)},t.prototype._repositionGroundOverlay=function(){var i=this.getMap(),n,t;i&&this._img&&this._groundOverlayOptions.bounds&&this._groundOverlayOptions.visible&&(n=i.tryLocationToPixel(this._groundOverlayOptions.bounds.getNorthwest(),Microsoft.Maps.PixelReference.control),t=i.tryLocationToPixel(this._groundOverlayOptions.bounds.getSoutheast(),Microsoft.Maps.PixelReference.control),this._img.style.left=n.x+"px",this._img.style.top=n.y+"px",this._img.style.width=t.x-n.x+"px",this._img.style.width=t.x-n.x+"px",this._img.style.height=t.y-n.y+"px")},t}(ut),vt=function(n){function t(i,u){var f=n.call(this,null,null,null)||this,e;return f._changeVisibilityDisposable=null,f._registeredJsEvents={},f._options={visible:t._defaultOptions.visible,showCloseButton:t._defaultOptions.showCloseButton,showPointer:t._defaultOptions.showPointer,offset:t._defaultOptions.offset,title:t._defaultOptions.title,description:t._defaultOptions.description,actions:t._defaultOptions.actions,maxHeight:t._defaultOptions.maxHeight,maxWidth:t._defaultOptions.maxWidth,closeDelayTime:t._defaultOptions.closeDelayTime,location:i},e=Microsoft.Maps.GlobalConfig,e.isMapsAnswer||e.isMapsVertical||(f._options.zIndex=t._defaultOptions.zIndex),f.setOptions(u,!0),f.infoboxChanged=new r,f._visibleBeforeAnchorOutofBounds=!1,f}return a(t,n),t.prototype.getActions=function(){return this._options.actions},t.prototype.getDescription=function(){return this._options.description},t.prototype.getHeight=function(){return this._getInfoboxElement().get_size().height},t.prototype.getHtmlContent=function(){return this._options.htmlContent},t.prototype.getLocation=function(){return this._options.location},t.prototype.getMaxHeight=function(){return this._options.maxHeight},t.prototype.getMaxWidth=function(){return this._options.maxHeight},t.prototype.getOffset=function(){return this._options.offset},t.prototype.getOptions=function(){return this._options},t.prototype.getShowCloseButton=function(){return this._options.showCloseButton},t.prototype.getShowDescription=function(){return typeof this._options.description!="undefined"},t.prototype.getShowPointer=function(){return this._options.showPointer},t.prototype.getTitle=function(){return this._options.title},t.prototype.getVisible=function(){var n=this._map&&this._map.getOverlays();return!this._map||!n||n.indexOf(this)===-1?!1:this._options.visible},t.prototype.getWidth=function(){return this._getInfoboxElement().get_size().width},t.prototype.getZIndex=function(){return this._options.zIndex},t.prototype.getIsCustom=function(){return this._customInfobox},t.prototype.getIsDefault=function(){return!this._customInfobox},t.prototype.setHtmlContent=function(n){this.setOptions({htmlContent:n})},t.prototype.setLocation=function(n){this.setOptions({location:n})},t.prototype.setOptions=function(n,t){var r=this,i=0;n&&(typeof n.closeDelayTime=="number"&&(this._options.closeDelayTime=n.closeDelayTime),this._options.title=typeof n.title=="string"?n.title:this._options.title,this._options.description=typeof n.description=="string"?n.description:this._options.description,this._options.actions=n.actions?n.actions:this._options.actions,this._options.autoAlignment=typeof n.autoAlignment=="boolean"?n.autoAlignment:this._options.autoAlignment,this._options.showCloseButton=typeof n.showCloseButton=="boolean"?n.showCloseButton:this._options.showCloseButton,this._options.showPointer=typeof n.showPointer=="boolean"?n.showPointer:this._options.showPointer,this._options.offset=n.offset?n.offset:this._options.offset,this._options.zIndex=typeof n.zIndex=="number"?n.zIndex:this._options.zIndex,this._options.location=n.location?n.location:this._options.location,this._options.htmlContent=typeof n.htmlContent=="string"?n.htmlContent:this._options.htmlContent,this._options.maxHeight=typeof n.maxHeight=="number"?n.maxHeight:this._options.maxHeight,this._options.maxWidth=typeof n.maxWidth=="number"?n.maxWidth:this._options.maxWidth,typeof n.visible=="boolean"&&(n.visible||!this._options.visible||t||(i=this._options.closeDelayTime),this._options.visible=n.visible));n&&typeof n.description=="string"&&this._createDescription();this.setAlignment(this._options.location);n&&typeof n.htmlContent=="string"&&this._createCustomInfobox();this._options.visible&&this._timerId&&clearTimeout(this._timerId);i>0?this._timerId=Microsoft.Maps.setTimeout(function(){r._invokeSetOptionsEvents(n)},i):this._invokeSetOptionsEvents(n)},t.prototype.setMap=function(n){var t=this,i=n;n?(this._createControl(),this._mouseenterVisibilityHandlerId=p.addHandler(this,"mouseenter",function(){t._cachedVisibilitySetting=t._options.visible;t._cachedVisibilitySetting||t.setOptions({visible:!0})}),this._mouseleaveVisibilityHandlerId=p.addHandler(this,"mouseleave",function(){t._cachedVisibilitySetting||t.setOptions({visible:!1})}),n instanceof et&&(i=n.getV8Map()),this._map=i,i.getOverlayManager().then(function(){i.getOverlays().insert(t);t.changed.invoke();t._createDescription();t._createCustomInfobox();t._adjustInfoboxSize()}),i.getMapOptions().allowInfoboxOverflow&&this._listenToMapChangedEvent()):this._map&&this._control&&(i=this._map,i.getOverlayManager().then(function(){var n=i.getOverlays();n&&n.remove(t);t.changed.invoke()}),this._changeVisibilityDisposable&&this._changeVisibilityDisposable.dispose())},t.prototype.boolToDisplay=function(n){return n?"":"none"},t.prototype.optionsToClass=function(n){var t="Infobox";return n&&(n.title||(t=t+" no-title"),n.showCloseButton||(t=t+" no-close")),t},t.prototype.dispose=function(){if(this.setMap(null),this.click&&this.click.dispose(),this.infoboxChanged&&this.infoboxChanged.dispose(),this.mouseenter&&this.mouseenter.dispose(),this.mouseleave&&this.mouseleave.dispose(),this._control){for(var t in this._registeredJsEvents)i._undefineJSEventForDomEvent(this._control,t,this._registeredJsEvents[t].id),this._registeredJsEvents[t].dispose();this._control.removeFromParent();this._control.remove_event("click",this._clickHandler);this._control.remove_event("mouseenter",this._mouseenterHandler);this._control.remove_event("mouseleave",this._mouseleaveHandler);p.removeHandler(this._mouseenterVisibilityHandlerId);p.removeHandler(this._mouseleaveVisibilityHandlerId);this._control=null}n.prototype.dispose.call(this);i._nullifyClass(this)},t.prototype._getInfoboxElement=function(){return this._createControl(),this._customInfobox?this._control.select(t._customInfoboxClass):this._control.select(t._infoboxClass)},t.prototype._createControl=function(){var n=this,f,u,t;if(!this._control){for(this.click=new r,this.mouseenter=new r,this.mouseleave=new r,this._control=new ai(di,this).applyDataTemplate(this),f={stopPropagation:!0},u=["mousemove","mousedown","mouseup","mousewheel","click","dblclick","contextmenu","touchmove","touchstart","touchend"],t=0;t<u.length;t++)this._registeredJsEvents[u[t]]=i._defineJSEventForDomEvent(this._control,u[t],f);this._clickHandler=function(t){n.click&&n.click.invoke({target:n,targetType:"infobox",eventName:"click",pageX:t.pageX,pageY:t.pageY,originalEvent:t})};this._control.add_event("click",this._clickHandler);this._mouseenterHandler=function(t){n.mouseenter&&n.mouseenter.invoke({target:n,targetType:"infobox",eventName:"mouseenter",pageX:t.pageX,pageY:t.pageY,originalEvent:t})};this._control.add_event("mouseenter",this._mouseenterHandler);this._mouseleaveHandler=function(t){n.mouseleave&&n.mouseleave.invoke({target:n,targetType:"infobox",eventName:"mouseleave",pageX:t.pageX,pageY:t.pageY,originalEvent:t})};this._control.add_event("mouseleave",this._mouseleaveHandler);this.setOverlayElement(this._control)}},t.prototype._onCloseClicked=function(){this.setOptions({visible:!1},!0)},t.prototype._changeAnchor=function(){var n=null,u,e,o,s,y,l;if(this._customInfobox?(o=this._control.select(t._customInfoboxClass),o&&o[0]&&(s=o.get_size(),u=s.height,e=s.width,n=new f(o[0].offsetLeft,o[0].offsetHeight))):(this._control.set_style({display:""}),s=this._control.select(".infobox-body").get_size(),u=s.height,e=s.width,this._control.set_style({display:this.boolToDisplay(this.getVisible())}),n=this._options.showPointer?new f(e/2,u+t._pointerHeight):new f(0,u)),n=n.subtract(new f(this._options.offset.x,-this._options.offset.y)),this._options.autoAlignment&&this._map&&e&&u){var a=this._map,h=a.getViewport(),r=a.getViewportPadding(),c=this._map.getMode().tryLocationToPoint(this._options.location),i=new f(c.x-n.x,c.y-n.y),v=this._options.showPointer;i.x<r.left?i.x=r.left+t._padding:i.x+e>h.pixelWidth-r.right&&(i.x=h.pixelWidth-r.right-e-t._padding);i.y<r.top?(i.y=r.top+t._padding,v=!1):i.y+u>h.pixelHeight-r.bottom&&(i.y=h.pixelHeight-r.bottom-u-t._padding);n=new f(c.x-i.x,c.y-i.y);this._customInfobox||(y=parseInt(this._control.select(".infobox").get_style("border-radius"))||8,l=y+t._pointerWidth/2,!v||n.x<l||n.x>e-l?this._control.select(".infobox-stalk").set_style({display:"none"}):this._control.select(".infobox-stalk").set_style({display:"",left:n.x-t._pointerWidth/2+"px"}))}this.setAnchor(n)},t.prototype._adjustInfoboxSize=function(){var n,i,f,r,s;if(this._control){if(!this._customInfobox){n=this._control.select(".infobox-body");i=this._control.select(".infobox-info");n.set_style({maxWidth:this._options.maxWidth+"px",maxHeight:this._options.maxHeight+"px"});this._control.set_style({display:""});f=this._control.get_style("left");this._control.set_style({left:"0px"});n.set_style({width:""});r=n.get_size().width;n.set_style({width:r});var u=n.get_size().height,h=parseInt(getComputedStyle(i[0],null).paddingTop.replace("px",""))||0,c=parseInt(getComputedStyle(i[0],null).paddingBottom.replace("px",""))||0,e=this._control.select(".infobox-title").get_size().height,o=this._control.select(".infobox-actions").get_size().height;e+i.get_size().height+o>u&&(s=u-e-o-h-c,i.set_style({maxHeight:s+"px"}));this._control.set_style({display:this.boolToDisplay(this.getVisible()),left:f});this._control.select(".infobox-stalk").set_style({top:u-.2+"px",left:(r-t._pointerWidth)/2+"px"})}this._changeAnchor()}},t.prototype._createCustomInfobox=function(){var i=this._options&&this._options.htmlContent,n,r;i&&(n=this._control&&this._control.select(t._customInfoboxClass),n&&n.length>0&&(n.clear(),r=document.createElement("div"),r.innerHTML=i,n[0].appendChild(r),this._customInfobox=!0,this.changed.invoke(new l(this,"htmlContent",undefined,i))))},t.prototype._createDescription=function(){var n,t;this._control&&(n=this._control.select(".infobox-info")[0],n&&(n.innerHTML="",this._options.description&&(t=document.createElement("div"),t.innerHTML=this._options.description,n.appendChild(t))))},t.prototype._listenToMapChangedEvent=function(){var n=this,t=null;this._map&&(t=this._map.getMapOptions());t&&t.allowInfoboxOverflow&&(this._changeVisibilityDisposable=this._map.viewChanged.add(function(){n._visibleBeforeAnchorOutofBounds&&n._map.getBounds().contains(n.getLocation())&&(n.setOptions({visible:!0}),n._visibleBeforeAnchorOutofBounds=!1);n.getOptions().visible&&!n._map.getBounds().contains(n.getLocation())&&(n._visibleBeforeAnchorOutofBounds=!0,n.setOptions({visible:!1},!0))}))},t.prototype._invokeSetOptionsEvents=function(n){this.changed.invoke(new l(this,"options",this._options,n));this._adjustInfoboxSize();this.infoboxChanged&&this.infoboxChanged.invoke({target:this,targetType:"infobox",eventName:"infoboxChanged"})},t._pointerWidth=14,t._pointerHeight=16,t._defaultOptions={visible:!0,showCloseButton:!0,showPointer:!0,offset:new f(0,0),maxHeight:126,maxWidth:256,zIndex:1002,closeDelayTime:0},t._padding=10,t._customInfoboxClass=".InfoboxCustom",t._infoboxClass=".Infobox",t}(li),ft=function(){function t(){}return t.loadModule=function(i,r){function v(){l--;l===0&&s&&s()}var f=[],l,a,s,h,o,b,e,y,u,c,p,w;if(typeof i=="string"?f.push(i):f=i,l=f.length,s=r,typeof r=="object"&&(o=r,s=o.callback,a=o.credentials?o.credentials:n.Credentials,h=o.errorCallback),a&&(b=new at(a,Microsoft.Maps.Internal._CoreConfig().logServiceUrlFormat,new ki,!0)),t.container)for(e=0,y=f.length;e<y;e++)if(u=t._supportedModules[f[e]],u)if(u.isLoaded){for(v(),c=0,p=u.pendingCallbacks.length;c<p;c++)u.pendingCallbacks[c]();u.pendingCallbacks=[]}else w=u.dragonflyObjectName,w?t._createInstance(f[e],u,v,h):u.pendingCallbacks.push(v);else h&&h(f[e]+" is not a supported module.")},t.registerModule=function(n,i,r){var o,u,f,s,e;if(n&&i&&(t._supportedModules[n]={isLoaded:!1,pendingCallbacks:[]},o=document.getElementsByTagName("head")[0],u=document.createElement("script"),u.type="text/javascript",u.src=i,o.appendChild(u),r&&r.styleURLs))for(f=0,s=r.styleURLs.length;f<s;f++)e=document.createElement("link"),e.rel="stylesheet",e.href=r.styleURLs[f],o.appendChild(e)},t.moduleLoaded=function(n){var i,r,u;if(n){for(i=t._supportedModules[n],i.isLoaded=!0,r=0,u=i.pendingCallbacks.length;r<u;r++)i.pendingCallbacks[r]();i.pendingCallbacks=[]}},t._createInstance=function(i,r,u,f){t.container.instanceAsync(r.dragonflyObjectName,function(){t._instrumentModuleCreation(i);r.isLoaded=!0;u();for(var n=0,f=r.pendingCallbacks.length;n<f;n++)r.pendingCallbacks[n]();r.pendingCallbacks=[]},null,null,function(t,r){n.Internal._Debug.log(null,"Factory:{0}, Message: {1}",t,r);f&&f(i+" failed to load.")})},t._instrumentModuleCreation=function(n){if(Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger&&Microsoft.Maps.GlobalConfig.enableInstrumentation){var t={feature:ti.SDK,action:"ModuleLoaded",data:{moduleName:n}};Microsoft.Maps.logger.logObject(t,null,!0)}},t._supportedModules={"Microsoft.Maps.DrawingTools":{dragonflyObjectName:"DrawingToolsModule",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.WellKnownText":{dragonflyObjectName:"WellKnownText",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.GeoJson":{dragonflyObjectName:"GeoJson",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.GeoXml":{dragonflyObjectName:"GeoXml",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.SpatialDataService":{dragonflyObjectName:"GeoDataAPIManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.AutoSuggest":{dragonflyObjectName:"AutosuggestManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.HeatMap":{dragonflyObjectName:"HeatMapLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Clustering":{dragonflyObjectName:"ClusterLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.SpatialMath":{dragonflyObjectName:"SpatialMath",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Search":{dragonflyObjectName:"SearchManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Traffic":{dragonflyObjectName:"TrafficManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Directions":{dragonflyObjectName:"DirectionsManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.DataBinning":{dragonflyObjectName:"DataBinningLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Contour":{dragonflyObjectName:"ContourLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Isochrone":{dragonflyObjectName:"IsochroneLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.VenueMaps":{dragonflyObjectName:"VenueMapsModule",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.ConfigurableMap":{dragonflyObjectName:"ConfigurableMap",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.Choropleth":{dragonflyObjectName:"ChoroplethLayer",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.ItineraryDataManager":{dragonflyObjectName:"ItineraryDataManager",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.AutoCollectionGenerator":{dragonflyObjectName:"AutoCollectionGenerator",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.CloudGraphDataManager.SaveDropdownControl":{dragonflyObjectName:"SaveDropdownControl",isLoaded:!1,pendingCallbacks:[]},"Microsoft.Maps.AdvancedShapes":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]},"Microsoft.Maps.Themes.BingTheme":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]},"Microsoft.Maps.Overlays.Style":{dragonflyObjectName:"",isLoaded:!0,pendingCallbacks:[]}},t}(),h;(function(n){n[n.control=0]="control";n[n.page=1]="page";n[n.viewport=2]="viewport"})(h||(h={}));var rr=function(){function n(){}return n.encode=function(t){for(var r,e,o=0,s=0,h=[],f=0,a=t.length;f<a;f++){var c=Math.round(t[f].latitude*1e5),l=Math.round(t[f].longitude*1e5),i=c-o,u=l-s;for(o=c,s=l,i=i<<1^i>>31,u=u<<1^u>>31,r=(i+u)*(i+u+1)/2+i;r>0;)e=r&31,r=(r-e)/32,r>0&&(e+=32),h.push(n._lookUpTable[e])}return h.join("")},n.decode=function(t){for(var l=[],h=0,a=0,y=0,p=t.length,r,c,f,e,i,u,o,s;h<p;){for(r=0,c=0;;){if(h>=p||(f=n._lookUpTable.indexOf(t[h++]),f===-1))return null;if(r+=(f&31)*Math.pow(2,c),c+=5,f<32)break}e=Math.floor((Math.sqrt(8*r+5)-1)/2);r-=e*(e+1)/2;i=r;u=e-i;u=u>>1^-(u&1);i=i>>1^-(i&1);a+=u;y+=i;o=y*1e-5;s=a*1e-5;o=Math.max(-85,Math.min(85,o));s=Math.max(-180,Math.min(180,s));l.push(new v(o,s))}return l},n._lookUpTable="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",n}(),ur=function(){function n(t){var i=this;this._disposables=[];this._layerEventTracker={};this._stateTracker={};this._onPrimitiveFocus=function(t){var u=c(t.srcElement),f=u.get_attr(n._primitiveIdAttribute),r=i._findPushpin(u.get_attr(n._layerIdAttribute),f);r&&(i._stateTracker[f]=r.getState(),r.setState(3))};this._onPrimitiveBlur=function(t){var u=c(t.srcElement),r=u.get_attr(n._primitiveIdAttribute),f=i._findPushpin(u.get_attr(n._layerIdAttribute),r);f&&(f.setState(i._stateTracker[r]),delete i._stateTracker[r])};this._onPrimitiveKeyPress=function(t){if(t.keyCode===13){var u=c(t.srcElement),f=u.get_attr(n._primitiveIdAttribute),r=i._findPushpin(u.get_attr(n._layerIdAttribute),f);r&&r.click&&r.click.invoke()}};this._sdkmap=t;this._disposables.push(this._sdkmap.layers.changed.add(function(n){i._onLayersChanged(n)}));this._processAddedLayers(this._sdkmap.layers);this._sdkmap.entities?this._processAddedLayers([this._sdkmap.entities]):this._sdkmap.getV8Map().frameManagerLoaded.addOne(function(){i._processAddedLayers([i._sdkmap.entities])})}return n.prototype.dispose=function(){var e=this,r,t,u,f;if(this._sdkmap){for(r=Object.keys(this._layerEventTracker),t=0,u=r.length;t<u;t++)i._clearDisposables(this._layerEventTracker[r[t]]);f=c(this._sdkmap.getRootElement()).select("."+n._primitiveTabElementClass);f.for_each(function(n){e._removeAndUnregisterTabElement(c(n))});i._clearDisposables(this._disposables);i._nullifyClass(this)}},n.prototype._onLayersChanged=function(n){n.added&&n.added.length>0&&this._processAddedLayers(n.added);n.removed&&n.removed.length>0&&this._processRemovedLayers(n.removed)},n.prototype._processAddedLayers=function(n){var r=this,i,t,u,f;if(n)for(i=0;i<n.length;i++)t=n[i],t instanceof d&&t.getVisible()&&(u=t.getId(),f=[t.invalidated.add(function(n){r._onLayerUpdated(t,n)}),t.changed.add(function(n){r._onLayerUpdated(t,n)})],this._layerEventTracker[u]=f,this._addVisiblePrimitivesOnLayer(t))},n.prototype._processRemovedLayers=function(n){for(var r,u,t=0;t<n.length;t++)r=n[t],r instanceof d&&(u=r.getId(),this._layerEventTracker[u]&&(i._clearDisposables(this._layerEventTracker[u]),this._layerEventTracker[u]=null),this._removeElementsForLayer(r,!0))},n.prototype._addVisiblePrimitivesOnLayer=function(n){var t=this;n.getVisible()&&n.getPrimitives(null,function(i){t._addElements(n,i.primitives)})},n.prototype._addElements=function(t,i){var s,h,f,e;if(i&&i.length>0)for(s=this._sdkmap.getRootElement(),h=t.getId(),f=0;f<i.length;f++)if(i[f]instanceof o){var r=c(document.createElement("div")),u=i[f],l=u.entity.id,a="["+n._layerIdAttribute+"='"+h+"']["+n._primitiveIdAttribute+"='"+l+"']";s.querySelectorAll(a).length===0&&(r.set_attr(n._layerIdAttribute,h),r.set_attr(n._primitiveIdAttribute,l),r.set_attr("tabindex","0"),r.set_attr("class",n._primitiveTabElementClass),r.set_style({height:0,width:0}),c(r).add_event("focus",this._onPrimitiveFocus).add_event("blur",this._onPrimitiveBlur).add_event("keypress",this._onPrimitiveKeyPress),e=[],u.getTitle()&&e.push(u.getTitle()),u.getSubTitle()&&e.push(u.getSubTitle()),e.length>0&&r.set_attr("aria-label",e.join(";")),u.getAriaHaspopup()&&r.set_attr("aria-haspopup","true"),u.isTapEnabled()&&r.set_attr("role","button"),s.appendChild(r[0]))}},n.prototype._findPushpin=function(n,t){for(var e,u,i,f=[this._sdkmap.entities].concat(this._sdkmap.layers.slice()),s=null,r=0;r<f.length;r++)if(f[r].getId()===n){for(e=f[r].getPrimitives(),u=0;u<e.length;u++)if(i=e[u],i instanceof o&&i.entity&&i.entity.id===t){s=i;break}break}return s},n.prototype._removeAndUnregisterTabElement=function(n){n.remove_event("focus",this._onPrimitiveFocus).remove_event("blur",this._onPrimitiveBlur).remove_event("keypress",this._onPrimitiveKeyPress);n.removeFromParent()},n.prototype._removeElementsForLayer=function(t,i){var s=i||!t.getVisible(),h=t.getId(),l=t.getPrimitives(),f=[],r,u;l.forEach(function(n){n instanceof o&&n.getVisible()&&n.entity&&f.push(n.entity.id)});var a=this._sdkmap.getRootElement(),v="["+n._layerIdAttribute+"='"+h+"']",e=a.querySelectorAll(v);for(r=0;r<e.length;r++)u=c(e[r]),(s||f.indexOf(u.get_attr(n._primitiveIdAttribute))===-1)&&this._removeAndUnregisterTabElement(u)},n.prototype._onLayerUpdated=function(n){this._removeElementsForLayer(n,!1);this._addVisiblePrimitivesOnLayer(n)},n._layerIdAttribute="data-layerid",n._primitiveIdAttribute="data-pid",n._primitiveTabElementClass="primitiveTabs",n}(),o=function(n){function t(i,u){var e=this,f={},h,o;return u=u||{},f.icon=u.icon||t._defaultOptions.icon,f.anchor=u.anchor||t._defaultOptions.anchor,h=f.anchor?new w(f.anchor.x,f.anchor.y):null,f.title=typeof u.title=="string"?u.title:t._defaultOptions.title,f.subTitle=typeof u.subTitle=="string"?u.subTitle:t._defaultOptions.subTitle,f.text=typeof u.text=="string"?u.text:t._defaultOptions.text,o={id:"Pushpin_"+t._pushpinId++,collisionBehavior:2,title:f.title,subtitle:f.subTitle},o.iconText=f.text,e=n.call(this,i,o,null,h)||this,f.draggable=typeof u.draggable=="boolean"?u.draggable:t._defaultOptions.draggable,f.visible=typeof u.visible=="boolean"?u.visible:t._defaultOptions.visible,f.textOffset=u.textOffset||t._defaultOptions.textOffset,f.enableHoverStyle=typeof u.enableHoverStyle=="boolean"?u.enableHoverStyle:t._defaultOptions.enableHoverStyle,f.enableClickedStyle=typeof u.enableClickedStyle=="boolean"?u.enableClickedStyle:t._defaultOptions.enableClickedStyle,f.ariaHaspopup=typeof u.ariaHaspopup=="boolean"?u.ariaHaspopup:!1,e.catId=f.catId=u.catId,e.groupCatId=f.groupCatId=u.groupCatId,e.isMicroPoi=f.isMicroPoi=u.isMicroPoi,e.bucket=f.bucket=u.bucket||(u.isMicroPoi?s.microPoiBucket:t.defaultPushpinBucketId),e._options=f,e._updateDefaultStyle(),f.color=u.color||t._defaultOptions.color,f.cursor=u.cursor||t._defaultOptions.cursor,f.roundClickableArea=typeof u.roundClickableArea=="boolean"?u.roundClickableArea:t._defaultOptions.roundClickableArea,e._setImage(u.icon,u.iconSize),e.changed=new r,e.changing=new r,e._state=2,e.revision=0,e}return a(t,n),t.prototype.getAnchor=function(){return this.anchor?new f(this.anchor.x,this.anchor.y):null},t.prototype.getDraggable=function(){return this._options.draggable},t.prototype.getHoverStyleEnabled=function(){return this._options.enableHoverStyle},t.prototype.getClickedStyleEnabled=function(){return this._options.enableClickedStyle},t.prototype.getColor=function(){return this._options.color},t.prototype.getIcon=function(){return this._options.icon},t.prototype.getRoundClickableArea=function(){return this._options.roundClickableArea},t.prototype.getText=function(){return this._options.text},t.prototype.getTextOffset=function(){return this._options.textOffset},t.prototype.getTitle=function(){return this._options.title},t.prototype.getSubTitle=function(){return this._options.subTitle},t.prototype.getVisible=function(){return this._options.visible},t.prototype.getAriaHaspopup=function(){return this._options.ariaHaspopup},t.prototype.setLocation=function(t,i){var r=new l(this,"location",this.getLocation(),t);n.prototype.setLocation.call(this,t);i&&this.changing&&this.changing.hasHandlersRegistered()?this.changing.invoke(r):this.changed&&this.changed.invoke(r)},t.prototype.setOptions=function(n){var r=this._options,i={},u;i.visible=typeof n.visible=="boolean"?n.visible:r.visible;i.draggable=typeof n.draggable=="boolean"?n.draggable:r.draggable;i.icon=n.icon||r.icon;i.iconSize=n.iconSize||r.iconSize;i.anchor=n.anchor||r.anchor;this.anchor=i.anchor?new w(i.anchor.x,i.anchor.y):null;i.title=typeof n.title=="string"?n.title:r.title;this.entity.title=i.title;i.subTitle=typeof n.subTitle=="string"?n.subTitle:r.subTitle;this.entity.subtitle=i.subTitle;i.text=typeof n.text=="string"?n.text:r.text;this.entity.iconText=i.text;i.textOffset=n.textOffset||r.textOffset;i.enableHoverStyle=typeof n.enableHoverStyle=="boolean"?n.enableHoverStyle:r.enableHoverStyle;i.enableClickedStyle=typeof n.enableClickedStyle=="boolean"?n.enableClickedStyle:r.enableClickedStyle;i.ariaHaspopup=typeof n.ariaHaspopup=="boolean"?n.ariaHaspopup:r.ariaHaspopup;i.color=n.color||r.color;i.cursor=n.cursor||r.cursor;i.roundClickableArea=typeof n.roundClickableArea=="boolean"?n.roundClickableArea:r.roundClickableArea;this.bucket=i.bucket=n.bucket||r.bucket;this.catId=i.catId=typeof n.catId=="string"?n.catId:this.catId;this.groupCatId=i.groupCatId=typeof n.groupCatId=="string"?n.groupCatId:this.groupCatId;this.isMicroPoi=i.isMicroPoi=typeof n.isMicroPoi=="boolean"?n.isMicroPoi:r.isMicroPoi;u=n.bucket||r.bucket;this.isMicroPoi&&u===t.defaultPushpinBucketId?u=s.microPoiBucket:this.isMicroPoi||u!==s.microPoiBucket||(u=t.defaultPushpinBucketId);this.bucket=i.bucket=u;this._options=i;(n.icon||n.color||n.text||n.iconSize)&&this._setImage(i.icon,i.iconSize);this.revision++;this._updateDefaultStyle();this.changed&&this.changed.invoke(new l(this,"options",r,i))},t.prototype.getCursor=function(){return this._options.cursor},t.prototype.dispose=function(){i._clearDisposables([this._clickedStyleDisposable,this._hoverStartStyleDisposable,this._hoverEndStyleDisposable]);i._disposeEvents(this);n.prototype.dispose.call(this)},t.prototype._setImage=function(n,t){var r=this,u=this.getColor(),e,o,f;if(u instanceof kt&&(u=u.toRgba()),typeof n=="string"&&/<svg/i.test(n)&&!/^data:/i.test(n)&&(this.hasSvgText=n.indexOf("{text}")>=0,e=unescape(encodeURIComponent(this.getText())),o=n.replace(/{color}/g,u||"").replace(/{text}/g,e||""),n="data:image/svg+xml;base64,"+window.btoa(o)),this.image=n,this.imageSize=t,f=function(n,t){r.changed&&r.changed.invoke(new l(r,"image",n,t))},typeof this.image=="string"){var i=document.createElement("img"),s=function(n){var u,e,o,s;i.onload=null;window.clearTimeout(h);n?(i.style.visibility="hidden",u=document.createElement("div"),u.style.display="block",u.appendChild(i),document.body.appendChild(u),e=i.height,o=i.width,document.body.removeChild(u),t?(i.height=t.height||0,i.width=t.width||0):(i.height=e,i.width=o),r.anchor||r.setOptions({anchor:new w(i.width/2,i.height)}),f(null,r.image)):(s=r.image,r.image=null,f(s,r.image))},h=Microsoft.Maps.setTimeout(function(){return s(!1)},5e3);i.onload=function(){s(!0)};i.src=this.image;this.image=i}},t.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},t.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},t.prototype.isHoverEnabled=function(){return this._hasHoverEvents()||this._layerHasHoverEvents()||this.isTapEnabled()||this.isDoubleTapEnabled()||this.getDraggable()},t.prototype.isMoveEnabled=function(){return this._options.draggable},t.prototype._hasHoverEvents=function(){return this.getHoverStyleEnabled()||this.mouseover&&this.mouseover.hasHandlersRegistered()||this.mouseout&&this.mouseout.hasHandlersRegistered()},t.prototype._hasTapEvents=function(){return this.getClickedStyleEnabled()||this.click&&this.click.hasHandlersRegistered()||this.mouseup&&this.mouseup.hasHandlersRegistered()||this.mousedown&&this.mousedown.hasHandlersRegistered()},t.prototype._hasDoubleTapEvents=function(){return this.dblclick&&this.dblclick.hasHandlersRegistered()},t.prototype._layerHasHoverEvents=function(){var n=this.layer;return n&&(n.primitiveHoverStarted&&n.primitiveHoverStarted.hasHandlersRegistered()||n.primitiveHoverStopped&&n.primitiveHoverStopped.hasHandlersRegistered())},t.prototype._layerHasTapEvents=function(){var n=this.layer;return n&&(n.primitiveTapped&&n.primitiveTapped.hasHandlersRegistered()||n.primitivePointerPressed&&n.primitivePointerPressed.hasHandlersRegistered())},t.prototype._layerHasDoubleTapEvents=function(){var n=this.layer;return n&&n.primitiveDoubleTapped&&n.primitiveDoubleTapped.hasHandlersRegistered()},t.prototype.hasInternalId=function(){return this.entity&&this.entity.id&&/^Pushpin_[1-9]([0-9])*$/i.test(this.entity.id)?!0:!1},t.prototype.getState=function(){return this._state},t.prototype.setState=function(n){if(this._state!==n){var i=this._state;this._state=n;n===4&&this.bucket===t.defaultPushpinBucketId?this.bucket=t.defaultClickedPushpinBucketId:n!==4&&this.bucket===t.defaultClickedPushpinBucketId&&(this.bucket=t.defaultPushpinBucketId);this.changed&&this.changed.invoke(new l(this,"state",i,n))}},t.prototype._updateDefaultStyle=function(){var n=this;this._options.enableClickedStyle!==!0||this._clickedStyleDisposable?this._options.enableClickedStyle===!1&&(this._clickedStyleDisposable&&(this._clickedStyleDisposable.dispose(),this._clickedStyleDisposable=null),this.setState(2)):(this.click||(this.click=new r),this._clickedStyleDisposable=this.click.add(function(){n._updateClickedStyle()}));this._options.enableHoverStyle!==!0||this._hoverStartStyleDisposable||this._hoverStartStyleDisposable?this._options.enableHoverStyle===!1&&(this._hoverStartStyleDisposable&&(this._hoverStartStyleDisposable.dispose(),this._hoverStartStyleDisposable=null),this._hoverEndStyleDisposable&&(this._hoverEndStyleDisposable.dispose(),this._hoverEndStyleDisposable=null),this.setState(2)):(this.mouseover||(this.mouseover=new r),this.mouseout||(this.mouseout=new r),this._hoverStartStyleDisposable=this.mouseover.add(function(){n._updateHoverStartStyle()}),this._hoverEndStyleDisposable=this.mouseout.add(function(){n._updateHoverStoppedStyle()}))},t.prototype._updateClickedStyle=function(){this.getState()===4?(this.setState(2),this.getHoverStyleEnabled()&&this._updateHoverStartStyle()):this.setState(4)},t.prototype._updateHoverStartStyle=function(){this.getState()===2&&this.setState(3)},t.prototype._updateHoverStoppedStyle=function(){this.getState()===3&&this.setState(2)},t._pushpinId=1,t._defaultOptions={anchor:null,draggable:!1,icon:null,visible:!0,title:null,subTitle:null,enableHoverStyle:!1,enableClickedStyle:!1,text:null,textOffset:new f(0,5),color:null,cursor:"pointer",roundClickableArea:!1},t.defaultPushpinBucketId="999999",t.defaultClickedPushpinBucketId="999998",t}(bi),et=function(){function n(n,u,f,e,o,s,h){var l=this,v,b,nt,a,y,p,k,d,tt,w,g;if(this._disposables=[],this._disposables.push(this._mapLoaded=new r),this.layers=new hi(null,!1),v=[],this._disposables.push(this.layers.changed.add(function(n){l._mapHasLoaded?Microsoft.Maps.setTimeout(function(){l._onLayersChanged(n)},0):v.push(n)})),this._mapLoaded.addOne(function(){v.length>0&&Microsoft.Maps.setTimeout(function(){for(var n=0;n<v.length;n++)l._onLayersChanged(v[n])},0)}),this._rootElement=c(n),this._rootElement&&this._rootElement.length===1&&this._rootElement[0]){b=this._rootElement[0].$map;try{b&&b.dispose()}catch(it){}this._rootElement[0].$map=this}if(u=u||{credentials:null},this._options=this._options||{credentials:null},this._options.viewChangeEndDelay=typeof u.viewChangeEndDelay=="number"?u.viewChangeEndDelay:0,u.mapTypeId&&(nt=u.mapTypeId===t.birdseye?t.birdseyeV2:u.mapTypeId,u.mapType=nt),u.trafficOptions=u.trafficOptions||{},u.trafficOptions.legendVisible=!0,typeof u.showLogo!="boolean"&&(u.showLogo=!0),(typeof u.showTermsLink=="undefined"||u.showTermsLink===null)&&(u.showTermsLink=!0),(typeof u.showBreadcrumb=="undefined"||u.showBreadcrumb===null)&&(u.showBreadcrumb=!1),a=u.supportedMapTypes,a&&a.length>0){for(y=[],p=0,k=a;p<k.length;p++)d=k[p],t.isValid(d)&&y.push(d);u.supportedMapTypes=y;a=y}tt=a&&a.indexOf(t.birdseye)<0&&a.indexOf(t.birdseyeV2)<0;u.disableBirdseye=u.disableBirdseye||tt||!a&&!e.isBirdseyeV2SDKDefault;typeof u.supportedMapTypes=="undefined"||u.supportedMapTypes===null||u.supportedMapTypes.length===0?(u.supportedMapTypes=[t.road,t.aerial,t.streetside,t.ordnanceSurvey],u.disableBirdseye||(Microsoft.Maps.GlobalConfig.isMapsAnswer&&!i._isFeatureEnabled("birdseyeV2UI")?u.supportedMapTypes.splice(2,0,t.birdseye):u.supportedMapTypes.splice(2,0,t.birdseyeV2))):(w=a.indexOf(t.birdseye),w>-1&&(u.disableBirdseye?u.supportedMapTypes.splice(w,1):u.supportedMapTypes[w]=t.birdseyeV2));u.supportedMapTypes.push(t.highContrast);g=u.labelOptions=u.labelOptions||{};typeof g.labelVisibility=="undefined"&&(g.labelVisibility=u.labelOverlay);u.backgroundColor&&typeof u.backgroundColor!="string"&&(u.backgroundColor=u.backgroundColor.toHex());this._v8Map=new Microsoft.Maps.CoreMap(n,u,f,e,o,s,h);(u.bounds||u.center&&u.centerOffset)&&this.setView({bounds:u.bounds,center:u.center,centerOffset:u.centerOffset});this._disposables.push(this._v8Map);this._saveMapOptions(u);this._templateSelector=new dt(this._v8Map);this._v8Map.getOverlayManager().then(function(){l._onOverlayManagerLoaded()});this._disposables.push(this.copyrightchanged=new r);this._v8Map.copyrightControlLoaded.addOne(function(n){l._disposables.push(n.changed.add(function(n){n.name==="copyrightAttributions"&&l.copyrightchanged.invoke()}))});this._disposables.push(this.viewchangestart=new r,this.viewchange=new r,this.viewchangeend=new r,this._v8Map.mapPanStarted.add(function(n){l._raiseViewChangeStartEvent(n);l._isMapPanning=!0}),this._v8Map.mapPanStopped.add(function(n){l._raiseViewChangeEndEvent(n);l._isMapPanning=!1}),this._v8Map.targetViewChanged.add(function(n){l._v8Map.isPanning()||l._raiseViewChangeStartEvent(n)}),this._v8Map.viewChangingAfterPaint.add(function(n){l._raiseViewChangeEvent(n)}),this._v8Map.viewChanged.add(function(n){l._v8Map.isPanning()||l._raiseViewChangeEndEvent(n)}));this._v8Map.targetViewChanged.isPreviouslyInvoked&&(this._viewChangeStartInitializationTimer=Microsoft.Maps.setTimeout(function(){l._raiseViewChangeStartEvent(l._v8Map.targetViewChanged.lastInvokedArgs)},0));this._v8Map.viewChanged.isPreviouslyInvoked&&(this._viewChangeEndInitializationTimer=Microsoft.Maps.setTimeout(function(){l._raiseViewChangeEndEvent(l._v8Map.viewChanged.lastInvokedArgs)},0));this._disposables.push(this._v8Map.mapTypeChanged.add(function(n){n.oldMapTypeId!==t.birdseyeV2&&n.newMapTypeId===t.birdseyeV2?st.hideLayersForSDKMap(l):n.oldMapTypeId===t.birdseyeV2&&n.newMapTypeId!==t.birdseyeV2&&st.showLayersForSDKMap(l)}));this.entities=new bt(null,this._v8Map);this.entities.setTemplateSelector(this._templateSelector);this._v8Map.getLayers().insert(this.entities)}return n.prototype._raiseViewChangeStartEvent=function(n){this._viewChangeStartInvoked||(this._viewChangeStartInvoked=!0,this.viewchangestart.invoke(n));window.clearTimeout(this._viewChangeStartInitializationTimer);window.clearTimeout(this._viewChangeEndTimer)},n.prototype._raiseViewChangeEvent=function(n){this._viewChangeStartInvoked&&this.viewchange.invoke(n)},n.prototype._raiseViewChangeEndEvent=function(n){var t=this;this._options.viewChangeEndDelay>0?this._viewChangeEndTimer=Microsoft.Maps.setTimeout(function(){t._viewChangeStartInvoked=!1;t.viewchangeend.invoke(n)},this._options.viewChangeEndDelay):(this._viewChangeStartInvoked=!1,this.viewchangeend.invoke(n));window.clearTimeout(this._viewChangeEndInitializationTimer)},n.prototype._onLayersChanged=function(n){var o,u,h,t,f;if(this._v8Map){var s=this._v8Map.getLayers(),i=[],r=[],e=-1;if(n.added?(e===-1&&(e=n.addedIndex),i.push.apply(i,n.added)):n.removed&&r.push.apply(r,n.removed),i.length>0){for(o=[],t=0,f=i.length;t<f;t++)u=i[t],u instanceof fi&&(h=u.getTemplateSelector(),h||u.setTemplateSelector(this._templateSelector),u instanceof gt&&u.setOptions({enableCORS:this._v8Map.getMapOptions().enableCORS}),o.push(u));for(s.insertAll(o,e),t=0,f=i.length;t<f;t++){if(i[t].attachMap){i[t].attachMap(this);continue}i[t].attachMap&&i[t].attachMap(this)}}if(r.length>0)for(t=0,f=r.length;t<f;t++)r[t].detachMap?r[t].detachMap(this):s.remove(r[t])}},n.prototype._onOverlayManagerLoaded=function(){this._mapHasLoaded=!0;this._mapLoaded.invoke()},n.prototype.blur=function(){throw"Not implemented";},n.prototype.dispose=function(){var t,n;for(this._rootElement&&this._rootElement[0]&&delete this._rootElement[0].$map,t=0;t<this.layers.length;t++)n=this.layers[t],n.pause&&n.pause(),n.dispose&&n.dispose(!0);this.layers.clear();i._clearDisposables(this._disposables);this.entities.dispose(!0);this._rootElement&&this._rootElement.clear();this._rootElement=null;this._templateSelector=null;this._v8Map=null},n.prototype.focus=function(){throw"Not implemented";},n.prototype.getBounds=function(){return y.getMapBounds(this._v8Map)},n.prototype.getCenter=function(){return y.getMapCenter(this._v8Map)},n.prototype.getCopyrights=function(n){var t=this._v8Map.getCopyrightControl(),i=t&&t.copyrightProviders;n&&n(i)},n.prototype.getCredentials=function(n){at.instance.authenticateClientAndRetrieveSessionId(function(){n&&n(at.instance.getSessionId())})},n.prototype.getHeight=function(){return this._v8Map.getActualSize().height},n.prototype.getHeading=function(){return this._v8Map.getView().heading},n.prototype.getPitch=function(){return this._v8Map.getView().pitch},n.prototype.getImageryId=function(){return{r:"Road",a:"Aerial",be:"Birdseye",x:"Streetside",m:"Mercator",os:"Ordnance Survey",wd:"Canvas Dark",wl:"Canvas Light",cg:"Grayscale"}[this.getMapTypeId()]},n.prototype.getMapTypeId=function(){var n=this._v8Map.getMapType().id;return n===t.birdseyeV2&&(n=t.birdseye),n},n.prototype.getMapTypes=function(){for(var n,i=this.getV8Map().getMapTypes(),r=[],t=0;t<i.length;t++)n=i[t].id,n==="be2"&&(n="be"),r.push(n);return r},n.prototype.getMetersPerPixel=function(){return rt.toScale(y.getMapCenter(this._v8Map),y.getMercatorZoomLevel(this._v8Map),!0)},n.prototype.getMode=function(){return this._v8Map.getMode()},n.prototype.getOptions=function(){return this._options},n.prototype.getPageX=function(){return this._rootElement.get_absolute_pos().x},n.prototype.getPageY=function(){return this._rootElement.get_absolute_pos().y},n.prototype.getRootElement=function(){return this._rootElement[0]},n.prototype.getWidth=function(){return this._v8Map.getActualSize().width},n.prototype.getZoom=function(){return this._v8Map.getMercatorZoomLevel()},n.prototype.getZoomRange=function(){var n=this._v8Map.getMapType();return{min:this._options.minZoom?Math.max(n.minZoom,this._options.minZoom):n.minZoom,max:this._options.maxZoom?Math.min(n.maxZoom,this._options.maxZoom):n.maxZoom}},n.prototype.isMercator=function(){return this._v8Map.getMode().mapModeType===0&&this._v8Map.getMapType().id!==t.birdseye},n.prototype.isRotationEnabled=function(){var n=this._v8Map.getMapType().id;return n===t.birdseye||n===t.birdseyeV2},n.prototype.setMapType=function(n){var i=this,r,u;if(n===t.birdseye&&(n=t.birdseyeV2),this._mapLoaded.isPreviouslyInvoked)if(this._options.mapTypeId=n,n===t.streetside)this._v8Map.getContainer().instanceAsync("StreetsideModeBootstrapper",function(n){var t=i._options.streetsideOptions||{};t.heading=i._options.heading;t.pitch=i._options.pitch;n.show(t.panoramaInfo||v.cloneFrom(i._v8Map.getView().cameraLocation),t)});else{if(n===t.birdseye&&this._v8Map.getMapOptions().disableBirdseye)return;if(r=this._v8Map.getNavigationBar(),r?r.getAerialBirdsEyeTransitionManager().requestMapType(n):this._v8Map.navigationBarLoaded.addOne(function(){return i._v8Map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n)}),u=this._v8Map.getMapTypes()[n],u)this._v8Map.setBaseLayers(u);else throw"Invalid map type id"+n;this._v8Map.getMode().mapModeType!==0&&this._v8Map.getContainer().instanceAsync("CompositeMapMode",function(n){i._v8Map.setMode(n)})}else this._mapLoaded.addOne(function(){i.setMapType(n)})},n.prototype.setOptions=function(n){this._saveMapOptions(n);this._v8Map.setMinZoom(n.minZoom);this._v8Map.setMaxZoom(n.maxZoom);n.maxBounds&&this._v8Map.setMaxBounds(n.maxBounds);this._v8Map.mapOptionsChanged.invoke(this._options)},n.prototype.setView=function(n){var u=this,i,r;this._processViewOptions(n);i=this.getMapTypeId();r=n.animate;n.animate=this._options.animate;this._saveMapOptions(n);n.animate=typeof r=="boolean"?r:this._options.animate;n.mapTypeId&&i!==n.mapTypeId?i===t.streetside?(this._v8Map.mapModeChanged.addOne(function(){u._setViewInternal(n,i)}),this.setMapType(n.mapTypeId)):(this.setMapType(n.mapTypeId),this._setViewInternal(n,i)):this._setViewInternal(n,i)},n.prototype._setViewInternal=function(r,u){var h=this,e,f,l,s,c,o,w,a,p,b,v;if(this.getMapTypeId()!==t.streetside){if(e=this._v8Map.getView(),r.bounds){this._options.constrainBirdseyeView&&(c=this._v8Map.getMode(),o=c.getCurrentCrs(),o.reset&&o.reset());l=r.bounds;s=typeof r.padding=="number"&&r.padding>0?r.padding:0;try{s*2<=Math.min(this.getHeight(),this.getWidth())?(f=this._v8Map.getMode().getMapViewWithBounds(l,{top:s,right:s,bottom:s,left:s}),this._v8Map.setView(f,n._constructAnimator(r,e,f))):(f=y.constructView(this._v8Map,l.center,8),this._v8Map.setView(f,n._constructAnimator(r,e,f)))}catch(k){f=y.constructView(this._v8Map,l.center,8);this._v8Map.setView(f,n._constructAnimator(r,e,f))}}else(r.center||typeof r.zoom=="number"||r.center&&r.centerOffset)&&((r.center||r.centerOffset)&&this._options.constrainBirdseyeView&&(c=this._v8Map.getMode(),o=c.getCurrentCrs(),o.reset&&o.reset()),w=this._computeMapCenterAfterOffset(r)||e.cameraLocation,f=y.constructView(this._v8Map,w,Math.round(typeof r.zoom=="number"?r.zoom:this.getZoom())),this._v8Map.setView(f,n._constructAnimator(r,e,f)));typeof r.labelOverlay=="number"&&(a=r.mapTypeId||this.getMapTypeId(),p=function(){var n=r.labelOverlay===pt.visible||a===t.road&&!h._options.allowHidingLabelsOfRoad?!0:!1;h._v8Map.getLabelController().setIsLabelsEnabled(n);h._v8Map.getMapOptions().labelOptions.labelVisibility=r.labelOverlay;i._isFeatureEnabled("bE2Labels")&&(a===t.birdseyeV2||a===t.birdseye)&&h._updateBEv2LabelToggle(n)},this._v8Map.getLabelController()?p():this._v8Map.labelControllerLoaded.addOne(function(){p()}));typeof r.heading!="number"||r.mapTypeId!==t.birdseye&&r.mapTypeId!==t.birdseyeV2&&(r.mapTypeId||u!==t.birdseye&&u!==t.birdseyeV2)||(b=ii.normalizeHeading(r.heading),f=e.clone(),f.heading=b,v=r.center,v&&(f.cameraLocation.latitude=v.latitude,f.cameraLocation.longitude=v.longitude),this._v8Map.setView(f,n._constructAnimator(r,e,f)))}this._v8Map.setViewInvoked.invoke(r)},n.prototype._updateBEv2LabelToggle=function(n){var r=this,t=this._v8Map.getNavigationBar(),i=function(t){t.setLabelVisible(n);t.updateLabelToggleForBirdseyeV2()};t?i(t.getHelper()):this._v8Map.navigationBarLoaded.addOne(function(){return i(r._v8Map.getNavigationBar().getHelper())})},n._constructAnimator=function(n,t,i){var r=null;return n&&n.animate&&t&&i&&(r=new oi(t,i)),r},n.prototype.tryLocationToPixel=function(n,t){var r,i,u;if(n instanceof v)return this._trySingleLocationToPoint(n,t);if(n.length){for(r=[],i=0;i<n.length;i++)if(u=this._trySingleLocationToPoint(n[i],t),u)r.push(u);else return null;return r}},n.prototype.tryPixelToLocation=function(n,t){var r,i,u;if(n instanceof f)return this._trySinglePointToLocation(n,t);if(n.length){for(r=[],i=0;i<n.length;i++)if(u=this._trySinglePointToLocation(n[i],t),u)r.push(u);else return null;return r}},n.prototype.panTo=function(){throw"Not implemented";},n.prototype.getStreetSide=function(){throw"Not implemented";},n.prototype.setStreetSide=function(){throw"Not implemented";},n.prototype.getUserRegion=function(){return Microsoft.Maps.GlobalConfig.dynamicProperties.userRegion},n.prototype.getCulture=function(){return Microsoft.Maps.GlobalConfig.dynamicProperties.market},n.prototype.getReleaseType=function(){throw"Not implemented";},n.prototype.getImage=function(){throw"Not implemented";},n.getIsBirdseyeAvailable=function(n,t,i,r){st.getIsBirdseyeV2Available(Microsoft.Maps.Internal._CoreConfig(),n,t,i,r)},n.prototype.getMapLoadedEvent=function(){return this._mapLoaded},n.prototype.getV8Map=function(){return this._v8Map},n.prototype._trySingleLocationToPoint=function(n,t){var u=this._v8Map.getMode().tryLocationToPoint(n),i,r;if(u){t=typeof t=="number"?t:h.viewport;i=null;switch(t){case h.control:i=new f(0,0);break;case h.page:i=this._rootElement.get_absolute_pos();break;case h.viewport:default:i=this._v8Map.getMode().tryLocationToPoint(this._v8Map.getView().cameraLocation);i.x*=-1;i.y*=-1}return r=u.add(i),!isNaN(r.x)&&!isNaN(r.y)?r:null}return null},n.prototype._trySinglePointToLocation=function(n,t){var u,f,i,r;if(isNaN(n.x)||isNaN(n.y))return null;t=typeof t=="number"?t:h.viewport;n=n.clone();switch(t){case h.control:break;case h.page:u=this._rootElement.get_absolute_pos();n.x-=u.x;n.y-=u.y;break;case h.viewport:default:f=this._v8Map.getActualSize();n.x+=f.width/2;n.y+=f.height/2}try{i=this._v8Map.getMode().tryPointToLocation(n);r=i.longitude;(r<-180||r>180)&&(i.longitude=v.normalizeLongitude(r))}catch(e){return null}return i},n.prototype._saveMapOptions=function(n){this._v8Map.updateMapOptions(this._options,n);n.pushpinAccessible?this._accessibilityManager||(this._accessibilityManager=new ur(this),this._disposables.push(this._accessibilityManager)):this._accessibilityManager&&(this._accessibilityManager.dispose(),this._accessibilityManager=null)},n.prototype._computeMapCenterAfterOffset=function(n){var i=n.center,t,r;return i&&n.centerOffset&&(t=this.tryLocationToPixel(i),t&&(r=new f(typeof n.centerOffset.x=="number"?n.centerOffset.x:0,typeof n.centerOffset.y=="number"?n.centerOffset.y:0),t=t.subtract(r),i=this.tryPixelToLocation(t))),i},n.prototype._processViewOptions=function(n){if(typeof n.heading=="number"&&(n.heading=(n.heading%360+360)%360),typeof n.pitch=="number"){var t=n.pitch;n.pitch=Math.max(Math.min(t,90),-90)}},n}(),b=function(n){function t(i,u){var s=this,f={},o=t._defaultOptions,h,c;return u=u||{},f.fillColor=u.fillColor||o.fillColor,f.strokeColor=u.strokeColor||o.strokeColor,f.strokeDashArray=u.strokeDashArray||o.strokeDashArray,f.strokeThickness=typeof u.strokeThickness=="number"?u.strokeThickness:o.strokeThickness,f.secondaryStrokeColor=u.secondaryStrokeColor||o.secondaryStrokeColor,f.secondaryStrokeThickness=typeof u.secondaryStrokeThickness=="number"?u.secondaryStrokeThickness:o.secondaryStrokeThickness,f.visible=typeof u.visible=="boolean"?u.visible:o.visible,f.cursor=u.cursor||o.cursor,f.generalizable=typeof u.generalizable=="boolean"?u.generalizable:o.generalizable,f.title=typeof u.title=="string"?u.title:o.title,h={id:"Polygon_"+t._polygonId++,title:f.title},s=n.call(this,i,h,null,f.generalizable)||this,s.bucket=t._defaultBucketId,s.changed=new r,s._options=f,c=new yt({strokeStyle:e(f.strokeColor),fillStyle:e(f.fillColor),lineWidth:f.strokeThickness,secondaryStrokeStyle:e(f.secondaryStrokeColor),secondaryLineWidth:f.secondaryStrokeThickness,dashes:k(f.strokeDashArray),hitTest:1}),s.setTemplate(c),s}return a(t,n),t.prototype.getFillColor=function(){return this._options.fillColor},t.prototype.getLocations=function(){var n=this.getRings();return n.length>0?n[0]:[]},t.prototype.getStrokeColor=function(){return this._options.strokeColor},t.prototype.getStrokeDashArray=function(){return this._options.strokeDashArray},t.prototype.getStrokeThickness=function(){return this._options.strokeThickness},t.prototype.getTitle=function(){return this._options.title},t.prototype.getVisible=function(){return this._options.visible},t.prototype.setLocations=function(n){this.setRings([n])},t.prototype.setOptions=function(n){var i=this._options,t={},r=this.getTemplate().getStyle(),f,u;if(t.strokeThickness=typeof n.strokeThickness=="number"?n.strokeThickness:i.strokeThickness,typeof n.strokeThickness=="number"&&(r.lineWidth=n.strokeThickness),t.strokeColor=n.strokeColor?n.strokeColor:i.strokeColor,n.strokeColor&&(r.strokeStyle=e(n.strokeColor)),t.strokeDashArray=n.strokeDashArray?n.strokeDashArray:i.strokeDashArray,n.strokeDashArray&&(r.dashes=k(n.strokeDashArray)),t.secondaryStrokeThickness=typeof n.secondaryStrokeThickness=="number"?n.secondaryStrokeThickness:i.secondaryStrokeThickness,typeof n.secondaryStrokeThickness=="number"&&(r.secondaryLineWidth=n.secondaryStrokeThickness),t.secondaryStrokeColor=n.secondaryStrokeColor?n.secondaryStrokeColor:i.secondaryStrokeColor,n.secondaryStrokeColor&&(r.secondaryStrokeStyle=e(n.secondaryStrokeColor)),t.fillColor=n.fillColor?n.fillColor:i.fillColor,n.fillColor&&(r.fillStyle=e(n.fillColor)),t.visible=typeof n.visible=="boolean"?n.visible:i.visible,t.generalizable=typeof n.generalizable=="boolean"?n.generalizable:i.generalizable,t.generalizable!==i.generalizable)for(f=this.geometry.rings,u=0;u<f.length;u++)f[u].generalizable=t.generalizable,f[u].generalizations=null;t.cursor=n.cursor||i.cursor;t.title=n.title!==undefined?n.title:i.title;this.entity.title=t.title;this._options=t;this.changed&&this.changed.invoke(new l(this,"options",i,t))},t.prototype.setRings=function(t){var i=this.getRings();n.prototype.setRings.call(this,t,this._options.generalizable);this.changed&&this.changed.invoke(new l(this,"rings",i,t))},t.prototype.toString=function(){throw"Not implemented";},t.prototype.getCursor=function(){return this._options.cursor},t.prototype.getGeneralizable=function(){return this._options.generalizable},t.getDefaultStyle=function(){var n=t._defaultOptions;return{fillStyle:e(n.fillColor),strokeStyle:e(n.strokeColor),lineWidth:n.strokeThickness,dashes:k(n.strokeDashArray)}},t.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},t.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},t.prototype.isHoverEnabled=function(){return this._hasHoverEvents()||this._layerHasHoverEvents()||this.isTapEnabled()||this.isDoubleTapEnabled()},t.prototype.dispose=function(){n.prototype.dispose.call(this);i._disposeEvents(this)},t.prototype._hasHoverEvents=function(){return this.mouseover&&this.mouseover.hasHandlersRegistered()||this.mouseout&&this.mouseout.hasHandlersRegistered()},t.prototype._hasTapEvents=function(){return this.click&&this.click.hasHandlersRegistered()||this.mouseup&&this.mouseup.hasHandlersRegistered()||this.mousedown&&this.mousedown.hasHandlersRegistered()},t.prototype._hasDoubleTapEvents=function(){return this.dblclick&&this.dblclick.hasHandlersRegistered()},t.prototype._layerHasHoverEvents=function(){var n=this.layer;return n&&(n.primitiveHoverStarted&&n.primitiveHoverStarted.hasHandlersRegistered()||n.primitiveHoverStopped&&n.primitiveHoverStopped.hasHandlersRegistered())},t.prototype._layerHasTapEvents=function(){var n=this.layer;return n&&(n.primitiveTapped&&n.primitiveTapped.hasHandlersRegistered()||n.primitivePointerPressed&&n.primitivePointerPressed.hasHandlersRegistered())},t.prototype._layerHasDoubleTapEvents=function(){var n=this.layer;return n&&n.primitiveDoubleTapped&&n.primitiveDoubleTapped.hasHandlersRegistered()},t.prototype.hasInternalId=function(){return this.entity&&this.entity.id&&/^Polygon_[1-9]([0-9])*$/i.test(this.entity.id)?!0:!1},t._polygonId=1,t._defaultOptions={fillColor:"rgba(90, 255, 150, 0.4)",strokeColor:"rgba(0, 100, 200, 1)",strokeThickness:1,strokeDashArray:null,visible:!0,cursor:"pointer",generalizable:!0,title:null},t._stylePropertiesDict={fillColor:"fillStyle",strokeColor:"strokeStyle",strokeThickness:"lineWidth",strokeDashArray:"dashes"},t._defaultBucketId="999999",t}(pi),nt=function(n){function t(i,u){var o=this,f,s;return u?(f={},f.strokeColor=u.strokeColor||t._defaultOptions.strokeColor,f.strokeDashArray=u.strokeDashArray||t._defaultOptions.strokeDashArray,f.strokeThickness=typeof u.strokeThickness=="number"?u.strokeThickness:t._defaultOptions.strokeThickness,f.secondaryStrokeColor=u.secondaryStrokeColor||t._defaultOptions.secondaryStrokeColor,f.secondaryStrokeThickness=typeof u.secondaryStrokeThickness=="number"?u.secondaryStrokeThickness:t._defaultOptions.secondaryStrokeThickness,f.visible=typeof u.visible=="boolean"?u.visible:t._defaultOptions.visible,f.generalizable=typeof u.generalizable=="boolean"?u.generalizable:t._defaultOptions.generalizable,f.cursor=u.cursor||t._defaultOptions.cursor):f=t._defaultOptions,o=n.call(this,i,null,null,f.generalizable)||this,o.changed=new r,o._options=f,s=new yt({strokeStyle:e(f.strokeColor),lineWidth:f.strokeThickness,secondaryStrokeStyle:e(f.secondaryStrokeColor),secondaryLineWidth:f.secondaryStrokeThickness,dashes:k(f.strokeDashArray),hitTest:1}),o.setTemplate(s),o}return a(t,n),t.prototype.getStrokeColor=function(){return this._options.strokeColor},t.prototype.getStrokeDashArray=function(){return this._options.strokeDashArray},t.prototype.getStrokeThickness=function(){return this._options.strokeThickness},t.prototype.getVisible=function(){return this._options.visible},t.prototype.setLocations=function(t){var i=this.getLocations();n.prototype.setLine.call(this,t,this.getGeneralizable());this.changed&&this.changed.invoke(new l(this,"locations",i,t))},t.prototype.setOptions=function(n){var i=this._options,t={},r=this.getTemplate().getStyle();t.strokeThickness=typeof n.strokeThickness=="number"?n.strokeThickness:i.strokeThickness;typeof n.strokeThickness=="number"&&(r.lineWidth=n.strokeThickness);t.strokeColor=n.strokeColor?n.strokeColor:i.strokeColor;n.strokeColor&&(r.strokeStyle=e(n.strokeColor));t.strokeDashArray=n.strokeDashArray?n.strokeDashArray:i.strokeDashArray;n.strokeDashArray&&(r.dashes=k(n.strokeDashArray));t.secondaryStrokeThickness=typeof n.secondaryStrokeThickness=="number"?n.secondaryStrokeThickness:i.secondaryStrokeThickness;typeof n.secondaryStrokeThickness=="number"&&(r.secondaryLineWidth=n.secondaryStrokeThickness);t.secondaryStrokeColor=n.secondaryStrokeColor?n.secondaryStrokeColor:i.secondaryStrokeColor;n.secondaryStrokeColor&&(r.secondaryStrokeStyle=e(n.secondaryStrokeColor));t.visible=typeof n.visible=="boolean"?n.visible:i.visible;t.generalizable=typeof n.generalizable=="boolean"?n.generalizable:i.generalizable;t.generalizable!==i.generalizable&&(this.geometry.generalizable=t.generalizable,this.geometry.generalizations=null);t.cursor=n.cursor||i.cursor;this._options=t;this.changed&&this.changed.invoke(new l(this,"options",i,t))},t.prototype.toString=function(){throw"Not implemented";},t.prototype.getCursor=function(){return this._options.cursor},t.prototype.getGeneralizable=function(){return this._options.generalizable},t.getDefaultStyle=function(){var n=t._defaultOptions;return{strokeStyle:e(n.strokeColor),lineWidth:n.strokeThickness,dashes:k(n.strokeDashArray)}},t.prototype.isTapEnabled=function(){return this._hasTapEvents()||this._layerHasTapEvents()},t.prototype.isDoubleTapEnabled=function(){return this._hasDoubleTapEvents()||this._layerHasDoubleTapEvents()},t.prototype.isHoverEnabled=function(){return this._hasHoverEvents()||this._layerHasHoverEvents()||this.isTapEnabled()||this.isDoubleTapEnabled()},t.prototype.dispose=function(){n.prototype.dispose.call(this);i._disposeEvents(this)},t.prototype._hasHoverEvents=function(){return this.mouseover&&this.mouseover.hasHandlersRegistered()||this.mouseout&&this.mouseout.hasHandlersRegistered()},t.prototype._hasTapEvents=function(){return this.click&&this.click.hasHandlersRegistered()||this.mouseup&&this.mouseup.hasHandlersRegistered()||this.mousedown&&this.mousedown.hasHandlersRegistered()},t.prototype._hasDoubleTapEvents=function(){return this.dblclick&&this.dblclick.hasHandlersRegistered()},t.prototype._layerHasHoverEvents=function(){var n=this.layer;return n&&(n.primitiveHoverStarted&&n.primitiveHoverStarted.hasHandlersRegistered()||n.primitiveHoverStopped&&n.primitiveHoverStopped.hasHandlersRegistered())},t.prototype._layerHasTapEvents=function(){var n=this.layer;return n&&(n.primitiveTapped&&n.primitiveTapped.hasHandlersRegistered()||n.primitivePointerPressed&&n.primitivePointerPressed.hasHandlersRegistered())},t.prototype._layerHasDoubleTapEvents=function(){var n=this.layer;return n&&n.primitiveDoubleTapped&&n.primitiveDoubleTapped.hasHandlersRegistered()},t._defaultOptions={strokeColor:"rgba(0, 100, 200, 1)",strokeThickness:1,strokeDashArray:null,visible:!0,cursor:"pointer",generalizable:!0},t._stylePropertiesDict={strokeColor:"strokeStyle",strokeThickness:"lineWidth",strokeDashArray:"dashes"},t}(wi);function e(n){return n?typeof n=="string"?n:n.toRgba():null}function k(n){var t,r,i,u;if(typeof n=="string")for(r=n.split(/[, ]/),t=[],i=0;i<r.length;i++)u=parseInt(r[i]),isNaN(u)||t.push(u);else t=n;return t}var dt=function(){function n(n){var r=this,t,i;this._map=n;this._disposables=[];this._disposables.push(this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(r._resetTemplateSelector=!0)}));t=Microsoft.Maps.Internal._CoreConfig();i=ri.features.taskFramework;this._poiRefresh=t.poiRefresh;this._useClassicSdkPoi=t.useClassicSdkPoi;this._xsrMicroPoi=i&&i.xsrMicroPoi}return n.prototype.selectorReady=function(){var n=this;return!this.baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n.baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n.baseMapTemplateSelector.selectorReady()}):this.baseMapTemplateSelector.selectorReady()},n.prototype.getMarkupStyle=function(n,t,i){var r,u;return i===undefined&&(i=n.entity&&n.entity.poiType||1),n instanceof o&&(u=n.bucket===s.pricePoiBucketId,u&&(i=2),r=n.getState()),this.baseMapTemplateSelector.getMarkupStyle(n,t,r,i)},n.prototype.getTemplates=function(t){var i=[],nt,r,p,tt,b,a,k,rt,d,ut,c,v,ft;if(t instanceof o){var l=t.bucket,g=l===s.pricePoiBucketId,et=l===o.defaultPushpinBucketId||l===o.defaultClickedPushpinBucketId||l===s.microPoiBucket,u=t.getState(),e=t.entity,h=lt.getValue(t,"image");if(h)nt=t.getRoundClickableArea()?1:2,r=lt.getValue(t,"anchor"),r instanceof f?r=new w(r.x,r.y):r instanceof w||(r=new w(0,0)),lt.setValue(t,"anchor",r),this._preparePushpinImage(h,u),p=new it(h,1,r,t,u),p.setHitTestShape(nt),i.push(p),!t.hasSvgText&&t.getText()&&(tt=this._getTextAnchor(h.width,t.getTextOffset()),i=i.concat(s.getPushpinTextTemplates(null,h,tt,r)));else if(e&&e.isVenueMapPoi||!et&&!g)i=this.baseMapTemplateSelector.getSDKLandmarkImageTemplates(t,this._map.getMercatorZoomLevel(),this._map.getMapOptions().liteMode);else if(b=this._map.getMercatorZoomLevel(),a=n._pushpinColorIndex,t.taskDisplayState&&(a=t.taskDisplayState.colorIndex),t.isMicroPoi)i=this._xsrMicroPoi?this.baseMapTemplateSelector.getPoiTemplate(s.microPoiBucket,u,b,12,!1,s.getBucketForCategory(t.groupCatId)||s.getBucketForCategory(t.catId)):this._getMicroPoiTemplate(a,u);else{if(k=t.getText(),rt=!!(k&&k.length>0),d=e&&e.poiType?e.poiType:g?2:!t.catId&&this._poiRefresh&&this._useClassicSdkPoi?10:1,this._poiRefresh&&d!==10||(ut=y._getColorMapping(a)),i=this.baseMapTemplateSelector.getPoiVectorImageTemplate(t.catId,u,b,d,rt,t.groupCatId,ut),u!==4&&t.getText()){for(c=!1,v=0,ft=i.length;v<ft;v++)if(c=c||i[v].hasPlaceholderText,c)break;c||(i=i.concat(s.getPushpinTextTemplates(i[i.length-1],null,null,null)))}t.getColor()&&(i=this._applyCustomPushpinColor(i,this._convertSDKColorToColor(t.getColor())))}}else{if(t.getTemplates)return t.getTemplates();t.getTemplate&&(i=[t.getTemplate()])}return i},n.prototype.dispose=function(){this._map=null;this.baseMapTemplateSelector=null;i._clearDisposables(this._disposables)},n.prototype._getMicroPoiTemplate=function(i,r){var u=this._map.getMapType(),f=r===4?n._microPoiSelectedColors:u.id===t.aerial?n._microPoiAerialColors:n._microPoiColors,e={records:[{centerX:0,centerY:0,radiusX:n._microPoiRadius,radiusY:n._microPoiRadius,vectorType:2,style:{fillStyle:f[i-1]}}],hotspotX:0,hotspotY:0,hitTest:1},o=new wt(e);return[o]},n.prototype._getTextAnchor=function(t,i){var r=t/2+n._pushpinTextAnchorOffset.x+i.x,u=n._pushpinTextAnchorOffset.y+i.y;return new w(r,u)},n.prototype._applyCustomPushpinColor=function(t,i){for(var u,r,e=[],f=0;f<t.length;f++){var o=t[f],c=o.getVectorImage(),s=c.records,h=[];for(u=0;u<s.length;u++)r=n._cloneObject(s[u]),r.vectorType===2&&(r.style.strokeStyle&&(r.style.strokeStyle=this._getUpdatedRecordColor(ot.parse(r.style.strokeStyle),i)),r.style.fillStyle&&(r.style.fillStyle=this._getUpdatedRecordColor(ot.parse(r.style.fillStyle),i))),h.push(r);e.push(new wt({hitTest:1,records:h},o.getScale()))}return e},n.prototype._getUpdatedRecordColor=function(t,i){var r,f=t.alpha,u;return t.alpha=1,u=t.toRgba(),n._defaultPoiColorsRgba.indexOf(u)>=0?(r=i,r.alpha=f):n._defaultPoiLayerColorRgbaAlphas[u]&&(r=i,r.alpha=n._defaultPoiLayerColorRgbaAlphas[u]),t.alpha=f,r?r.toRgba():t.toRgba()},n.prototype._convertSDKColorToColor=function(n){var t=n;return n.toHex&&(t=n.toHex()),ot.parse(t)},n._cloneObject=function(n){var i,r,t,f,u;if(!n||typeof n!="object")return n;for(i={},r=Object.keys(n),t=0,f=r.length;t<f;t++)u=r[t],i[u]=this._cloneObject(n[u]);return i},n.prototype._preparePushpinImage=function(t,i){var u=this,r;t.setAttribute&&(typeof this._pushpinAccessible=="undefined"&&this._map&&(r=function(n){u._pushpinAccessible=typeof n.pushpinAccessible=="undefined"?!1:n.pushpinAccessible},r(this._map.getMapOptions()),this._disposables.push(this._map.mapOptionsChanged.add(r))),this._pushpinAccessible&&(i===3?t.setAttribute(it.shadowStyleAttribute,JSON.stringify(n._pushpinHoverShadow)):i===4?t.setAttribute(it.shadowStyleAttribute,JSON.stringify(n._pushpinSelectShadow)):t.removeAttribute(it.shadowStyleAttribute)))},n._pushpinColorIndex=1,n._pushpinTextAnchorOffset=new f(0,8),n._defaultPoiColorsRgba=["rgb(170,41,143)","rgb(211,72,191)","rgb(128,130,133)","rgb(109,110,113)",],n._defaultPoiLayerColorRgbaAlphas={"rgb(231,209,232)":.08,"rgb(107,64,103)":.3,"rgb(209,211,212)":.08},n._microPoiColors=["#cc7fbc","#78cec8","#65b765"],n._microPoiAerialColors=["#b252ae","#229499","#449158"],n._microPoiSelectedColors=["#93277f","#00afaa","#007500"],n._microPoiRadius=3,n._pushpinHoverShadow={shadowBlur:2,shadowOffset:{x:2,y:2},shadowColor:"#555"},n._pushpinSelectShadow={shadowBlur:3,shadowOffset:{x:3,y:3},shadowColor:"#333"},n}(),fr=function(){function n(){}return n.getColor=function(t){return t?"rgba("+Math.floor(n._getRandomNumber()*255)+","+Math.floor(n._getRandomNumber()*255)+","+Math.floor(n._getRandomNumber()*255)+", 0.5)":"#"+Math.floor(n._getRandomNumber()*16777215).toString(16)},n.getLocations=function(n,t){var i,r;if((!n||n<=0)&&(n=1),t=this._processLocationRect(t),!n||n<=1)return this._getRandomLocation(t);for(i=[],r=0;r<n;r++)i.push(this._getRandomLocation(t));return i},n.getPushpins=function(t,i,r){function h(t,i,r){return i&&r&&(i.title=n.getText(5)),new o(n._getRandomLocation(t),i)}var u,f,e,s;if((!t||t<=0)&&(t=1),i=this._processLocationRect(i),u=r,f=u&&u.title==="*random*",!t||t<=1)return h(i,u,f);for(e=[],s=0;s<t;s++)e.push(h(i,u,f));return e},n.getPolylines=function(t,i,r,u,f){var e,o,s,h,c;if((!t||t<=0)&&(t=1),r&&r<=1&&(r=2),(!u||u<=0)&&(u=.1),i=this._processLocationRect(i),e=Math.min(i.width/2,i.height)*u,i.width-=e*2,i.height-=e*2,e*=111e3,o=r,!t||t<=1)return r||(o=Math.ceil(n._getRandomNumber()*7+3)),s=f?f:{strokeColor:n.getColor(!0),strokeThickness:Math.ceil(n._getRandomNumber()*3+1)},new nt(this._generateSimplePolygonPoints(this._getRandomLocation(i),e,o),s);for(h=[],c=0;c<t;c++)r||(o=Math.ceil(n._getRandomNumber()*7+3)),s=f?f:{strokeColor:n.getColor(!0),strokeThickness:Math.ceil(n._getRandomNumber()*3+1)},h.push(new nt(this._generateSimplePolygonPoints(this._getRandomLocation(i),e,o),s));return h},n.getPolygons=function(t,i,r,u,f,e){var o,s,h,c,l;if((!t||t<=0)&&(t=1),r&&r<=2&&(r=3),(!u||u<=0)&&(u=.1),i=this._processLocationRect(i),o=Math.min(i.width/2,i.height)*u,i.width-=o*2,i.height-=o*2,o*=111e3,s=r,!t||t<=1)return r||(s=Math.ceil(n._getRandomNumber()*7+3)),h=f?f:{strokeColor:n.getColor(!0),fillColor:n.getColor(!0),strokeThickness:Math.ceil(n._getRandomNumber()*3+1)},e?new b(this._generateHoledPolygonPoints(this._getRandomLocation(i),o,s),h):new b(this._generateSimplePolygonPoints(this._getRandomLocation(i),o,s),h);for(c=[],l=0;l<t;l++)r||(s=Math.ceil(n._getRandomNumber()*7+3)),h=f?f:{strokeColor:n.getColor(!0),fillColor:n.getColor(!0),strokeThickness:Math.ceil(n._getRandomNumber()*3+1)},e?c.push(new b(this._generateHoledPolygonPoints(this._getRandomLocation(i),o,s),h)):c.push(new b(this._generateSimplePolygonPoints(this._getRandomLocation(i),o,s),h));return c},n.getText=function(t){var i=n._lipsum,f=i[Math.floor(n._getRandomNumber()*i.length)],r=f.split(" "),u;return t=Math.min(t,r.length),u=Math.ceil(n._getRandomNumber()*t+1),r.slice(0,u).join(" ")},n._getRandomNumber=function(){return typeof FunctionalTestHooks!="undefined"?n._fixedRandomNumber[n._randomIndexNumber++%n._fixedRandomNumber.length]:Math.random()},n._processLocationRect=function(n){return n&&n instanceof ht?n:new ht(new v(0,0),360,170)},n._getRandomLocation=function(t){var i=n._getRandomNumber()*t.height+t.getSouth(),r=v.normalizeLongitude(n._getRandomNumber()*t.width+t.getWest());return new v(i,r)},n._generateSimplePolygonPoints=function(t,i,r){for(var f=[],e=360/r,o=360*n._getRandomNumber(),u=r;u>0;u--)f.push(this._calculateCoord(t,(u*e+o)%360,i*Math.max(n._getRandomNumber(),.3)));return f},n._generateHoledPolygonPoints=function(t,i,r){for(var o=[],s=[],h=360/r,c=360*n._getRandomNumber(),u,f,e=r;e>0;e--)f=i*Math.max(n._getRandomNumber(),.3),u=(e*h+c)%360,o.push(this._calculateCoord(t,u,f)),s.push(this._calculateCoord(t,u,f*n._getRandomNumber()));return[o,s.reverse()]},n._calculateCoord=function(n,t,i){var r=n.latitude*Math.PI/180,e=n.longitude*Math.PI/180,u=i/6378100,f=Math.asin(Math.sin(r)*Math.cos(u)+Math.cos(r)*Math.sin(u)*Math.cos(t*Math.PI/180)),o=e+Math.atan2(Math.sin(t*Math.PI/180)*Math.sin(u)*Math.cos(r),Math.cos(u)-Math.sin(r)*Math.sin(f));return new v(f*180/Math.PI,o*180/Math.PI)},n._lipsum=["Lorem ipsum dolor sit amet","Tamquam invidunt praesent nam ne","Ut errem doming eos","An erat fuisset disputando sed","Sea in omittantur voluptatibus","Cibo aperiri eam ei","Qui at nemore abhorreant","Eripuit labores eu vel","Id sea hinc offendit","An liber semper reprimique vix","Te mei impetus accumsan","Solet aliquid eos no","No nec iriure argumentum","Sit an labore albucius euripidis","Nec cu ancillae accommodare","No vel quando scripta mnesarchum","Sea veritus necessitatibus ea","Ut sea modo omnes indoctum","Modus iisque voluptatibus te usu","Nulla ridens pertinacia qui ne","Ei aeque oblique electram has","Vim eu odio delicata","An fastidii suscipit vel","Ne malorum volutpat tractatos eum","Vocibus disputationi nec et","Nam cibo iudico ut","Ius ea possit eligendi","Ei civibus menandri posidonium has","Esse voluptua pri ut","At petentium interpretaris pri","Te natum iudico discere est","Enim libris id est","Ea quidam corpora reprehendunt vix","Est eu habeo nulla ullamcorper","No vel mucius labore consequuntur","Quodsi pertinax eu eam","Sensibus honestatis per ne","Est ex eruditi offendit probatus","Vix scaevola splendide assentior id","Dico iriure admodum sed ne","Munere vocent albucius est ne"],n._randomIndexNumber=0,n._fixedRandomNumber=[.7386382989127653,.2065695521004587,.7489809651835657,.7006290954692962,.04091025364671497,.9954127559729178,.4912746583039538,.33492258954447696,.00939051247581979,.9355370703076171,.6639112574906407,.6426966361780018,.3800605039195766,.6520244006764719,.4209986210406571,.6272502121915353,.5776952967358593,.047346452974710074,.7181255497508585,.3761793786749503,.14860266357998486,.800076502104903,.8501424964068189,.9455797454506294,.273840925209909,.9512738435986936,.0022886739742573603,.15367566682337164,.6459795802730335,.3362969951693593,.054336254044035304,.8588520113714642,.22937582572969895,.9740016245002041,.4607652665949822,.40322686905774097,.9171997385079895,.5880980730081158,.8724148495369748,.2239024700242871,.7676683143923331,.7926649750793715,.30415825012711917,.07293642344075457,.6753791383025063,.9679377523741153,.2038322560443715,.8129500820851909,.27077686182824223,.1684700203381848,.4993160557132863,.18293656572890726,.5757666932844097,.44912958854000773,.20395822630141502,.5219136226151808,.20601322250617948,.033178847605686235,.6959785547716033,.16399309933378792,.8595173804557417,.5437663007267504,.31875889100662835,.7186497378557282,.2914619029735994,.8841938161542489,.5348728984465658,.9076766706515857,.23562101989224282,.23108006829633676,.19450167514094852,.012137182682760983,.5625723905993567,.058086334903006076,.14774651602549294,.4986287987027942,.4361142980232129,.18451663552065267,.48824807947030413,.5964374217261839,.1416270467317997,.9406141464555404,.41207749360170154,.7663479353902358,.34355378128733816,.9459770580482947,.5008866762243267,.756600353201563,.4122854653758523,.7405594496989769,.8062874665554729,.005642643076812615,.5730359088967756,.45774660398273537,.12495085292892005,.7351135248926923,.9160158262525442,.12853493439491892,.39699927614726116,.30916913109636335],n}(),gt=function(n){function t(i){var r=n.call(this,"CustomLayer_"+t._tileId++)||this;return r._options={zIndex:t._defaultOptions.zIndex,visible:t._defaultOptions.visible,opacity:t._defaultOptions.opacity,downloadTimeout:t._defaultOptions.downloadTimeout,enableCORS:t._defaultOptions.enableCORS},r.setOptions(i),r}return a(t,n),t.prototype.getTileSource=function(){return this._options.mercator},t.prototype.setOptions=function(n){if(n&&(this._downloadTimeoutInMS=Math.min(t._maxDownloadTimeout,this._options.downloadTimeout=typeof n.downloadTimeout=="number"?n.downloadTimeout:this._options.downloadTimeout),this._options.opacity=typeof n.opacity=="number"?n.opacity:this._options.opacity,this._options.visible=typeof n.visible=="boolean"?n.visible:this._options.visible,this._options.zIndex=typeof n.zIndex=="number"?n.zIndex:this._options.zIndex,this._enableCORS=this._options.enableCORS=typeof n.enableCORS=="boolean"?n.enableCORS:this._options.enableCORS,this._useCredentialsForCORS=this._options.useCredentialsForCORS=typeof n.useCredentialsForCORS=="boolean"?n.useCredentialsForCORS:this._options.useCredentialsForCORS,this.setVisible(this._options.visible),this.setZIndex(this._options.zIndex),this.setOpacity(this._options.opacity),!this._options.mercator&&n.mercator)){this._options.mercator=n.mercator;this._options.mercator.downloadTimeOut=this._options.downloadTimeout;var i=this._options.mercator.getMinZoom(),r=this._options.mercator.getMaxZoom(),u=this._options.mercator.getBounds();this.addScene(0,this._options.mercator,0,null,rt.toScale(null,r,!0),rt.toScale(null,i,!0),u)}},t.prototype.toString=function(){throw"Not supported";},t._defaultOptions={zIndex:1e4,visible:!0,opacity:1,downloadTimeout:5e3,enableCORS:!1},t._tileId=0,t._maxDownloadTimeout=3e4,t}(vi),er=function(){function n(n,t,i){var r,o,f,e,u;this.eventName=n;this.location=i.location;r=this.point=i.point;o=this.target=this.primitive=i.primitive;this.hitTarget=i.hitTarget;this.layer=i.layer;this.exclusiveHitTest=i.exclusiveHitTest;this._setTargetType(o);f=t.getRootElement().get_absolute_pos();this.pageX=r.x+f.x;this.pageY=r.y+f.y;e=t.getActualSize();u=i.originalArgs||{};this.getX=function(){return r.x-e.width/2};this.getY=function(){return r.y-e.height/2};["mousedown","mouseup","click","dblclick","rightclick"].indexOf(n)>=0&&(this.isPrimary=u.which===1,this.isSecondary=u.which===3);n==="mousewheel"&&(this.wheelDelta=u.wheelDelta)}return n.prototype._setTargetType=function(n){switch(!0){case n instanceof o:this.targetType="pushpin";break;case n instanceof nt:this.targetType="polyline";break;case n instanceof b:this.targetType="polygon";break;default:this.targetType=null}},n}();n.AnimatedTileLayer=nr;n.Color=kt;n.CustomOverlay=ut;n.EntityCollection=bt;n.Events=p;n.GroundOverlay=ir;n.Infobox=vt;n.Layer=d;n.PixelReference=h;n.Polygon=b;n.Polyline=nt;n.Pushpin=o;n.SDKMap=et;u.SDKPrimitiveTemplateSelector=dt;n.Module=ft;n.MouseEventArgs=er;n.TestDataGenerator=fr;n.Themes={};n.Themes.BingTheme=tr;n.TileSource=gi;n.TileLayer=gt;n.MapsTilePrimer=tt;n.PointCompression=rr;n.loadModule=ft.loadModule;n.registerModule=ft.registerModule;n.moduleLoaded=ft.moduleLoaded;n.getIsBirdseyeAvailable=et.getIsBirdseyeAvailable;Microsoft.Maps.notifyMapReadyForBootstrap()}catch(ni){if(n.logger)n.logger.logCriticalError(ni);else throw ni;}}).call(window)