var Chl;(function(n){function s(n){if(typeof n.placeholder!="undefined"){n.placeholder=n.value;n.value="";return}var t=n.value;sj_be(n,"focus",function(){n.value===t&&(Lib.CssClass.add(n,"active"),n.value="")});sj_be(n,"blur",function(){n.value===""&&(Lib.CssClass.remove(n,"active"),n.value=t)})}function r(n,t){var r=Lib.CssClass.getElementByClassName(_d,n),i;if(r!=null)for(i=0;i<r.length;i++)sj_be(r[i],"click",function(){sj_evt.fire(t,this)}.bind(r[i]))}function h(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];return n.replace(/{(\d+)}/g,function(n,t){return typeof i[t]!="undefined"?i[t]:n})}function c(n,t,i,r,u,f,s,h,c,l,a){n=n||"";e[n]=new o(n,t,i,!0,r,u,f,s,h,c,l,a)}var u=8001,f=8002,i="b_hide",t=UrlLib.AddParam,e=n.changeLocLinks=[],o=function(){function n(n,i,u,f,e,o,s,h,c,l,a,v){if(this.id=n,this.autosuggestLocations=i,this.blockCookieUrl=e,this.closedPopupCookieUrl=o,this.shouldDisplayPopup=u,this.dynamicId=a,this.highlightingEnabled=f,this.shouldWriteRevIp=s,this.revIpLatitude=h,this.revIpLongitude=c,this.hasLocationLikelyChanged=l,this.clientIP=v,sj_be(_d,"mousedown",this.dismissPopupIfFocusLeaves.bind(this)),sj_be(_d,"focus",this.dismissPopupIfFocusLeaves.bind(this),!0),sj_evt.bind("ChLocLinkClick"+this.id,function(n){var t=n[1];this.loadPopupContent(t)}.bind(this),!0),sj_evt.bind("ChLocCloseClick"+this.id,function(){this.setClosedCookie();this.closePopup()}.bind(this)),sj_evt.bind("ChLocDetect"+this.id,function(){this.getGpsLocation()}.bind(this)),r("sw_detectlnk"+this.id,"ChLocLinkClick"+this.id),r("sw_detectloc"+this.id,"ChLocDetect"+this.id),sj_evt.bind("UserLocation"+this.id,function(){var n=_d.forms.geo_chlocman;n.elements.ru.value=t(location.href,"form","GEOMA3")}),u){var y=_ge(n);y&&(Log.Log("AutoPopUp","Geolocation","popup",!0),this.loadPopupContent(y,!0))}}return n.prototype.loadPopupContent=function(n,t){var u=this,r,i;this.divPopup&&this.closePopup();this.divPopup=sj_ce("div","","wpc_bubPl");n.parentNode.appendChild(this.divPopup);n.className==="sw_detectlnk"?this.divPopup.style.left=Math.max(n.offsetLeft+n.offsetWidth-89,0)+"px":this.id&&this.id!=="ChangeLocationLink"||(this.divPopup.style.left=Math.max(n.offsetLeft+n.offsetWidth-280,0)+"px");this.divPopup.style.top=n.offsetTop+n.offsetHeight+6+"px";this.divPopup.style.zIndex="3001";this.popupHtml?this.updatePopupHtml(t):(r="/geolocation/popup?id="+encodeURIComponent(this.id)+"&IID="+encodeURIComponent(n.getAttribute("data-iid"))+"&IG="+encodeURIComponent(_G.IG),this.autosuggestLocations&&(r+="&popupas=1"),this.hasLocationLikelyChanged&&(r+="&locationchange=1"),i=sj_gx(),i.open("GET",r,!0),i.onreadystatechange=function(){i.readyState===4&&i.status===200&&(u.popupHtml=i.responseText,u.updatePopupHtml(t))},i.send())},n.prototype.displayError=function(n){var t=_ge("wpc_chlocpoptxt"+this.id),r=_ge("wpc_chlocpoperr"+this.id);Lib.CssClass.add(t,i);Lib.CssClass.remove(r,i);Log.Log("Warning","Geolocation","getCurrentPosition",!1,"Code",n&&n.code?n.code:"")},n.prototype.updatePopupHtml=function(n){if(this.divPopup){this.divPopup.innerHTML=this.popupHtml;var i=_d.forms["wpc_chlocman"+this.id];i.elements.ru.value=t(location.href,"form","GEOMA1");sb_st(function(){s(i.elements.geoname)},1);this.highlightingEnabled&&n&&Lib.CssClass.add(_ge(this.id).parentElement,"active");sj_evt.fire("chloc_popupLoad"+this.id)}},n.prototype.closePopup=function(){this.divPopup.parentNode.removeChild(this.divPopup);this.divPopup=null;this.highlightingEnabled&&Lib.CssClass.remove(_ge(this.id).parentElement,"active");Log.Log("ClosePopUp","Geolocation","popup",!1)},n.prototype.dismissPopupIfFocusLeaves=function(n){this.divPopup&&!this.divPopup.contains(n.target)&&this.closePopup()},n.prototype.setBlockCookie=function(){this.shouldDisplayPopup&&this.blockCookieUrl!=null&&this.sendRequest(this.blockCookieUrl,"Block")},n.prototype.setClosedCookie=function(){this.shouldDisplayPopup&&this.closedPopupCookieUrl!=null&&this.sendRequest(this.closedPopupCookieUrl,"Closed")},n.prototype.sendRequest=function(n,t){var i=sj_gx();i.open("GET",h(n,_G.IG,this.dynamicId));i.onreadystatechange=function(){i.readyState===4&&(i.status===200&&i.responseText==="Ok"?Log.Log("Success","GeolocationCookie",t,!1):Log.Log("Failed","GeolocationCookie",t,!1))}.bind(this);i.send()},n.prototype.getGpsLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var i=sj_gx(),r="/geolocation/reversegeocode?lat="+n.coords.latitude+"&lon="+n.coords.longitude+"&acc="+n.coords.accuracy;this.shouldWriteRevIp&&(r+="&revipLat="+this.revIpLatitude+"&revipLong="+this.revIpLongitude,_lochelper.wcIP(this.clientIP));i.open("GET",r,!0);i.onreadystatechange=function(){if(i.readyState===4)if(i.status===200&&i.responseText==="Ok"){Log.Log("Success","Geolocation","Detect",!1);var n=t(location.href,"isRef","1");n=t(n,"showTw","1");n=_lochelper.rLocPar(n);location.href=t(n,"form","GEOTRI")}else this.displayError({code:u})}.bind(this);i.send()}.bind(this),function(n){this.setBlockCookie();this.displayError(n)}.bind(this),{timeout:1e4}):this.displayError({code:f})},n}();n.init=c;sj_evt.fire("ChlLoad")})(Chl||(Chl={}))