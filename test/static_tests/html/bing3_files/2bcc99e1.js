(function(){var l,ct,p;try{var u=window.$MicrosoftMaps8,n=u.Internal,oi=n._WorkDispatcher,tt=u.Anchor,k=u.BasicTemplate,si=n._BinaryObject,yt=u.BitmapImageTemplate,pt=n._CurveKey,it=n._Curve,f=n._Color,rt=n._ComponentNames,hi=n._CurveVector4,ut=n._CurveColor,a=n._CurveColorHelper,ft=n.CustomMapStyleManager,d=n._DiscreteRangeCollectionSpline,t=n._Debug,wt=n._Gimme,o=u.GlobalConfig,i=n._Helper,et=n._HslaTransformCurve,v=n._JSEvent,w=o.features.labels,bt=n._LatLonCrs,ci=u.LocationRect,g=n._LoggerConstants,y=n._LruCache,kt=u.Matrix2D,li=u.Location,ai=u.MapMath,e=u.MercatorCubeCrs,vi=n._MercatorTileUtility,s=n._Network,ot=n._Observable,yi=n._ObservableObject,dt=u.Point,pi=n.PyramidTileSpatialIndex,wi=u.Rectangle,gt=n.SheetSpatialIndex,ni=n.StaticPromise,st=n._TransformCurve,ti=n._Url,r=u.VectorImageTemplate,h=n._VectorMath,nt=u.ZoomLevel,ht=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),b=function(){function n(n,r,u,f,e,s){var c=this,h;this._requestFailedCount=0;this._maxFailureForFailover=10;this._sheetbasedSpatialIndex=new gt;this._map=n;this._workDispatcher=f;this._coreConfig=r;this._constructGeometryFromLabelHints=typeof s=="boolean"?s:!0;t.assertNotNullOrEmpty(u,"vectorTileUrlFormat");this._layersOfInterest=e;this._urlFormat=i._updateTfeUrlDomain(u).replace("{vectorgridsgenid}",o.dynamicProperties.vectorGridsGenerationId).replace("{mkt}",o.dynamicProperties.uiLanguage).replace("{odmgenid}",o.dynamicProperties.compositionHandlerGenerationId);this._urlContainsCredentialsParam=this._urlFormat.indexOf("{credentials}")>-1;h=o.dynamicProperties.userRegion;this._urlFormat=h&&o.dynamicProperties.isGeopolUserRegion?this._urlFormat.replace(/{ur}/,h):this._urlFormat.replace(/&ur={ur}/,"");this._id=this._jsonsoSuffix="basemap";this._requests={};this.invalidated=new v;n.mapTypeChangeStarted.add(function(){return c._updateCstl()});this._updateCstl()}return n.prototype.getLayerDataSource=function(n){return new at(n,this,this._sheetbasedSpatialIndex)},n.prototype.cancelPrimitivesRequest=function(t,i,r){var u=n._getDispatchKey(t,i,r||"",this._id);s.abortRequest(this._requests[u]);this._workDispatcher.cancelDispatchWithKey(u)},n.prototype.getPrimitives=function(t,r,u,f){var s=t.quadKey,l=this.getFilterKey(),a=this._cstl,h=n._getDispatchKey(t,r,f||"",this._id),e=this._urlFormat.replace(/{quadkey}/ig,s).replace(/{subdomain}/ig,i._getTileSubDomain(s)).replace(/{filter}/ig,l).replace(/{cstl}/ig,a),o,c;e.startsWith("data:")||(e=ti.fromString(e).toString(!0,!0));o=n._responsesCacheV2.getItem(e);o?(c=this._layersOfInterest.indexOf(r)>-1?o[r]:null,this._completeRequest(u,this._filterResponse(c),h)):this._downloadGrid(t,h,r,e,u)},n.prototype._filterResponse=function(n){return n},n.prototype.applyFilter=function(n){this._filter=n;this.invalidated.invoke()},n.prototype.resetFilter=function(){this._filter=null;this.invalidated.invoke()},n.prototype.getFilterKey=function(){var r="",t=this._filter,i,n;if(t&&t.value&&t.distribution)for(i=t.value,n=0;n<i.length;n++)r+=i[n]+":"+t.distribution[n],n<i.length&&(r+=",");return r},n.prototype._updateCstl=function(){var n=this._map.getMapType(),t=n&&n.cstl||"";this._cstl!==t&&(this._cstl=t,this.invalidated.invoke())},n.prototype._downloadGrid=function(r,u,f,e,o,h){var c=this,l=r.quadKey,a,v,y;t.logDebugData("BaseMapDataSource - _downloadgrid() "+l);t.time(i._formatString("Network call for quadkey - {0}",l));a=null;(!this._coreConfig.autoGenBaseMapJsonso||t.getFunctionalTestHooksEnabled())&&(a=l.toString()+"_"+this._jsonsoSuffix);v=(this._urlContainsCredentialsParam||this._requestFailedCount>this._maxFailureForFailover||h)&&this._map.getAuthKey();y=this._getUpdatedUrlWithCredentials(e,v);this._requests[u]=s.downloadJsonp(y,"grid",function(n){c._handleResponse(r,e,u,f,o,n,!0)},function(i,s){t.log(null,"ERROR: failed to get {0}",l);s===4||h?c._handleResponse(r,e,u,f,o,n._createEmptyResponse(),!1,s):(c._requestFailedCount++,c._logNetworkError(),c._downloadGrid(r,u,f,e,o,!0))},a,!1,null,0)},n.prototype._handleResponse=function(r,u,f,e,o,s,h,c){var w=this,a,l,v,y;this._map.isDisposed()||(a=r.quadKey,delete this._requests[f],t.groupCollapsed(null,"Callback for lod: {0} quadkey {1}",r.lod.toString(),a),t.timeEnd(i._formatString("Network call for quadkey - {0}",a)),t.time(i._formatString("Parsing vector response for quadkey - {0}",a)),l=n._responsesCacheV2.getItem(u),l||(s?l=this._parseResponse(s,r,u):(l=n._responsesCacheV2.getItem(u)||{},ot.mergeProperties(l,this._parseNullDataRegion(e))),h&&n._responsesCacheV2.addItem(u,l)),t.timeEnd(i._formatString("Parsing vector response for quadkey - {0}",a)),v=!(s&&s.requestFailed)&&this._layersOfInterest.indexOf(e)>-1?l[e]:{primitives:null,requestFailed:!0,requestAborted:c===4},y=v&&v.primitives,y&&y.length>0?this._map.getTemplateSelector().then(function(n){n.selectorReady().then(function(){for(var t,h,i,r=[],u=[],e=[],s=0;s<y.length;s++)t=y[s],t.entity&&t.entity.oid?e.push(t.entity.oid):t.geometryType===1?r.push(t.bucket):(h=p.getShieldIndices(t.entity),h.length>0&&u.push({bucketId:t.bucket,indexes:h}));i=[];r.length>0&&i.push(n.prefetchImages(r));u.length>0&&i.push(n.prefetchShields(u));e.length>0&&i.push(n.prefetchOrganizationImagesByOrgId(e));Promise.all(i).then(function(){w._completeRequest(o,w._filterResponse(v),f)})})}):this._completeRequest(o,this._filterResponse(v),f),t.groupEnd())},n.prototype._completeRequest=function(n,t){n(t)},n._getDispatchKey=function(n,t,i,r){var u=n.quadKey;return u+"_"+t+"_"+i+"_"+r},n._createEmptyResponse=function(){return{entities:[],layers:{},requestFailed:!0}},n.prototype._parseNullDataRegion=function(t){var r,i;return n._nullDataRegionResponse||(r={isNullDataRegionMarker:!0,crs:bt.instance,geometryType:1,geometry:{x:0,y:0,bounds:[90,180,-90,-180]}},n._nullDataRegionResponse={primitives:[r]}),i={},i[t]=n._nullDataRegionResponse,i},n.getAnchorTextSpan=function(n){var t,i,e,r,o,u,f;if(n&&n.lbl)for(i=0,e=n.lbl.length;i<e;i++){for(r=n.lbl[i],o=r.tps&&r.tps.length||0,u=0;u<o;u++)if(f=r.tps[u],t=t||f,!f.n){t=f;break}if(t&&!t.n)break}return t},n.prototype._constructGeometryFromHint=function(t,i){var f,e=n.getAnchorTextSpan(t),r,u,o;if(e){r=e.x||0;u=e.y||0;switch(i){case 1:f={x:r,y:u,bounds:[u,r,u,r]};break;case 2:f={x:[r,r],y:[u,u],bounds:[u,r,u,r]};break;case 3:o={x:[r,r],y:[u,u]};f={rings:[o],r:[o],bounds:[u,r,u,r]}}}return f},n.prototype._logResponseError=function(n,t,i){var r=u.logger,f;r&&(f={feature:rt.BaseMapData,action:g.Error,data:{layerId:i||"",response:t||"",url:n||""}},r.logCriticalError(null,f))},n.prototype._parseResponse=function(n,r,u){var rt=n.entities,ut=r.crs,p={},a=n.layers,c=n.placement,g,nt,w,ft,s,b,et,h,k,e,tt,y,o,f,ot,l,d,it;if(this._constructGeometryFromLabelHints&&c&&c.length>0)for(g={},nt=Object.keys(a),w=0,ft=nt.length;w<ft;w++)for(s=nt[w],p[s]={primitives:[]},h=a[s],b=0,et=h.length;b<et;b++)(e=h[b],o=e.entityIndex||e.ei,t.assert(o!==0,"Primitive with entityindex 0 is invalid"),g[o+","+e.gt])||(e.bucket=e.bkt,e.entityIndex=o,e.geometryType=e.gt,e.geometry=this._constructGeometryFromHint(c[o],e.geometryType),t.assert(e.geometry!==null,"Geometry should be constructed from a hint"),f=rt[o],f&&(this._coreConfig.clickBasemapPrimitives&&(f.clickable=f.clickable||!!f.clk,f.clickable&&(e.isTapEnabled||(e.isTapEnabled=e.isHoverEnabled=function(){return!0}),f.changed||(f.changed=new v))),f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.category=f.category||f.cg,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=c[o],e.entity=f),e.crs=ut,p[s].primitives.push(e),g[o+","+e.gt]=o);else for(s in a)if(a.hasOwnProperty(s))for(h=this._generateLinePrimitives(a[s]),p[s]={primitives:h},h=h,k=0;k<h.length;k++)if(e=h[k],!e.bucket){e.g||this._logResponseError(u,JSON.stringify(n),s);e.bucket=e.bkt;e.entityIndex=e.ei;e.geometry=e.g;e.geometryType=e.gt;e.geometry.bounds=e.g.b;switch(e.geometryType){case 1:tt=16384;y=e.geometry;e.geometry.bounds=[Math.min(tt,y.y),y.x,y.y,Math.min(tt,y.x)];break;case 3:l=e.geometry;l.rings=l.r}if(o=e.entityIndex,f=rt[o],f&&(f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.category=f.category||f.cg,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=c&&c[o],e.entity=f.ypid?f:f.tj?f:f),ot=e.geometry,e.geometryType===3)for(l=ot,d=0;d<l.rings.length;d++)it=l.rings[d],i._deltaDecode(it.x),i._deltaDecode(it.y);e.crs=ut}return p},n.prototype._generateLinePrimitives=function(n){for(var t,o,r,s,h,u,c,f=[],e=0;e<n.length;e++)if(t=n[e],t.gt===3){for(o=t.g.r,r=0;r<o.length;r++)s=o[r],i._deltaDecode(s.x),i._deltaDecode(s.y);for(h=this._convertPolygonToPolylineGeometry(t.g,512),u=0;u<h.length;u++)c={entityIndex:t.ei,ei:t.ei,bkt:t.bkt,gt:2,g:h[u]},f.push(c)}else f.push(t);return f},n.prototype._convertPolygonToPolylineGeometry=function(n,t){for(var r,s,h,e,u,o=[],c=0;c<n.r.length;c++){var i=n.r[c],l=!1,f=null;for(i.x.length>0&&(i.x.push(i.x[0]),i.y.push(i.y[0])),r=0;r<i.x.length;r++)s=i.x[r],h=i.y[r],s<0||s>t||h<0||h>t?(l=!0,r>0&&(e=[],u=this._lineIntersect(0,0,0,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),u=this._lineIntersect(0,0,t,0,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),u=this._lineIntersect(0,t,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),u=this._lineIntersect(t,0,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&e.push(u),e.length===1&&f?(f.x.push(e[0].x),f.y.push(e[0].y)):e.length===2&&o.push({x:[e[0].x,e[1].x],y:[e[0].y,e[1].y],bounds:null,b:[0,0,t,t]})),f&&(o.push(f),f=null)):(f||(f={x:[],y:[],bounds:null,b:[0,0,t,t]}),l&&(u=this._lineIntersect(0,0,0,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r])||this._lineIntersect(0,0,t,0,i.x[r-1],i.y[r-1],i.x[r],i.y[r])||this._lineIntersect(0,t,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r])||this._lineIntersect(t,0,t,t,i.x[r-1],i.y[r-1],i.x[r],i.y[r]),u&&(f.x.push(u.x),f.y.push(u.y))),f.x.push(s),f.y.push(h),l=!1);f&&o.push(f)}return o},n.prototype._lineIntersect=function(n,t,i,r,u,f,e,o){var h,s,c,l,a;return n===i&&t===r||u===e&&f===o?null:(h=(o-f)*(i-n)-(e-u)*(r-t),h===0)?null:(s=((e-u)*(t-f)-(o-f)*(n-u))/h,c=((i-n)*(t-f)-(r-t)*(n-u))/h,s<0||s>1||c<0||c>1)?null:(l=n+s*(i-n),a=t+s*(r-t),new dt(l,a))},n.prototype._getUpdatedUrlWithCredentials=function(n,t){return t?this._urlContainsCredentialsParam?n=n.replace("{credentials}",t):n+="&key="+t:!t&&this._urlContainsCredentialsParam&&(n=n.replace(/&?key={credentials}/ig,"")),n},n.prototype._logNetworkError=function(){var n,t;this._requestFailedCount===this._maxFailureForFailover+1&&Math.random()<=.1&&(n=u.logger,n&&(t={feature:rt.MapControl,action:g.Error,data:{errorMessage:"Basemap vector data requests failed "+this._requestFailedCount+" times. Switching over to use TFE authentication."}},n.logCriticalError(null,t)))},n._responsesCacheV2=new y(50),n}(),bi=function(){function n(){}return n}(),ii=function(n){function t(t,i,r,u,f){return n.call(this,t,i,r,u,f,!1)||this}return ht(t,n),t}(b),c=function(){function n(r,u,f,e,s,h){this._clientPerf=h;this._customStyleManager=u;this._primitiveTemplateCache=new y(100);this._categoryIconCache=new y(100);this._templateName=e;this._state=[];this._stlVersion=i._getStlVersion()||s;this._shieldToRoadIdMapping={};this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this._images={};this.ready=new v;t.enableFunctionalTestHooks&&i._getUrlParam(window.location,"teststylefailure")==="1"&&(n._retryTimeout=1);var c=o.dynamicProperties.compositionHandlerGenerationId,l=r.mapTemplateUrlBase;this._urlFormat=i._updateTfeUrlDomain(f.replace("{urlbase}",l)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",c);this._urlImageFormat=i._updateTfeUrlDomain(r.mapImageTemplateUrlFormat.replace("{urlbase}",l)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",c);this._poiRefresh=r.poiRefresh;this._poiRefresh&&(n.DefaultBucketForLocalCat=n.DefaultBucketForLocalCat_PoiRefresh,ot.mergeProperties(n._localCatIdBucketMapping,n._localCatIdBucketMapping_Delta));this._paletteFontProps=r.paletteFontProps;this._markupOrder=new y(i._lowMem()?1:4);this._shieldImages={};this._shieldScaleListForZoom={};this._initialized=!1;this._retryCount=0;this._localCatIdVectorImageTemplate={}}return n.init=function(){var i={},r={},t={},u={};["203","255","257","251","253","254","252","91754","205","204","207","206","200","264","265","263","250","202","266","261","91571","201","262","256","260","259","258","267","91621","90892"].forEach(function(u){var f=n._localCatIdBucketMapping[u];i[u]=!0;r[f]=!0;t[f]=!0});["337","338","339","340","341","342","350","351","352","1386","1387","353","1370","1371","344","1441","1442","1443"].forEach(function(n){t[n]=!0});["254","253","252","251","250","249","243","242","241","236","235","232","231","229","228","227","226"].forEach(function(n){u[n]=!0});n._transitCatIds=i;n._transitBucketIds=r;n._invertedIconBucketIds=t;n._multimodeTransitBucketIds=u},n.prototype.getName=function(){return this._templateName},n.isDarkTheme=function(n){return!!this._darkTemplates[n]},n.extractCategoryId=function(t,i){var u,r;for(t=t||"",u=t.split("."),r=u.length-1;r>=0;r--)if(n.getBucketForCategory(u[r]))return u[r];return i?n.DefaultBucketForLocalCat:null},n.getBucketForCategory=function(t){return n._localCatIdBucketMapping[t]},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t,i){n._requestTemplateData(t,i)})),this._ready},n.prototype._requestTemplateData=function(r,u){var f=this,l,o,e,h,c;!this._requested&&this._urlFormat&&(this._requested=!0,this._delayLoadTimerId&&(window.clearTimeout(this._delayLoadTimerId),this._delayLoadTimerId=null),l=!!i._getStlVersion(),t.logDebugData("BaseMapTemplateSelector - _requestTemplateData() "+this._urlFormat),o=this._clientPerf&&this._clientPerf.start(n._latencyLogKey),e=window[this._templateName],e===undefined||e!==this._templateName||l?e&&!l?(delete window[this._templateName],this._onNetworkResponse(e,o,r)):s.downloadJson(this._urlFormat.replace(/{templateName}/ig,this._templateName).replace(/{subdomain}/ig,"0"),"styles",function(n){f._onNetworkResponse(n,o,r)},function(){f._onNetworkError(f._templateName,r,u)},null,!1,null,!1):(h="XsrPrefetchCallback",c="XsrPrefetchErrorCallback",window[h]=function(n,t){delete window[t];delete window[c];delete window[h];f._onNetworkResponse(n,o,r)},window[c]=function(n){delete window[n];delete window[c];delete window[h];f._retryCount++;f._onNetworkError(n,r,u)}))},n.prototype._onNetworkError=function(i,r,u){var f=this;this._retryCount<n._maxRetries?(this._requested=!1,this._retryCount++,t.logNetworkData(i,"retry "+this._retryCount),this._delayLoadTimerId=Microsoft.Maps.setTimeout(function(){f._requestTemplateData(r,u)},n._retryTimeout*1e3)):t.logNetworkData(i,"max retries");u(null)},n.prototype._onNetworkResponse=function(n,t,i){this._isDisposed||(this._clientPerf&&this._clientPerf.end(t),this._parseTemplate(n,i))},n.prototype._loadTemplates=function(n){if(!this._initialized)throw"BaseMapTemplateSelector: trying to use this class before it has been initialized";this._populateMarkupByZoom(n)},n.prototype._IsCurveGraph=function(n){return typeof n.position!="undefined"&&typeof n.tangentType!="undefined"?!0:!1},n.prototype._IsDiscreateCollectionGraph=function(n){return typeof n.start!="undefined"&&typeof n.end!="undefined"?!0:!1},n.prototype._IsHslaTransformCurveGraph=function(n){return n.graphType===14?!0:!1},n.prototype._IsTransformCurveGraph=function(n){return n.graphType===15&&typeof n.numericTransformCurve!="undefined"?!0:!1},n.prototype._getFixedStringId=function(n){var t=this._fixedStringMap[n];return typeof t!="number"&&(t=-1),t},n.prototype._getColorformat=function(n){var i=null,t;return n.graphType===1&&(t=n.value,t&&typeof t=="string"&&t.slice(1).length===6&&!isNaN(parseInt(t.slice(1),16))?i=1:t&&typeof t=="string"&&t.indexOf("rgba")>-1?i=0:(t||t===0)&&typeof t=="number"&&(i=3)),i},n.prototype._parseTemplate=function(i,u){var w=this,ei,bt,b,oi,si,hi,ci,rt,kt,k,dt,ft,li,ot,g,ai,vi,ht,l,gt,yi,s,a,h,o,v,lt,at,nt,vt,y,pi,ti,p,wi,e,bi,tt,ii,yt,wt,ri;t.time("ParseTemplate");var ui="Smooth",fi="Step",c=i.graphs;if(this._landColor=i.landColor,this._drawOrderList=i.drawOrder,this._shieldStyleResponseData={},i&&i.shields)for(o=0,ei=i.shields.length;o<ei;o++)bt=i.shields[o],this._shieldStyleResponseData[bt.shieldBucketId]=bt.passID[0];for(this._passDefinitionList=i.passDefinitions,this._imageGroups=i.imageGroups,this._groupedImageOptions=i.groupedImageOptions,this._state=i.state||[],this._propertyValues=i.propertyValues,this._svgColor=i.svgColor,r.fontFamilies=i.fontFamilies,this._markupOrderList=i.markupOrder,this._computedSplineGraphs=new Array(c.length),this._computedSplineGraphPaletteKeys=new Array(c.length),this._mapImages=[],this._imgVariants=i.imageVariantsList,this._fixedStringList=i.fixedStrings,this._fixedStringMap={},b=0,oi=this._fixedStringList.length;b<oi;b++)this._fixedStringMap[this._fixedStringList[b]]=b;for(this._palette=this._createPalette(i.paletteDefinitions,i.paletteItems),si=this._getFixedStringId("Global.ImageFamily"),hi=this._palette.getStringPaletteValue(si),this._paletteFlavorKeyId=this._getFixedStringId(hi),ci=this._getFixedStringId("Default"),p=0,o=0;o<(this._imgVariants&&this._imgVariants.length);o++){for(kt=this._imgVariants[o],e=0;e<kt.imageReferences.length;e++)if(k=kt.imageReferences[e],k.keyId===this._paletteFlavorKeyId){rt=k.imageId;break}else k.keyId===ci&&(rt=k.imageId);this._unmappedToMappedImageIndex[rt]=p;this._mappedToUnmappedImageIndex[p++]=rt}for(this._shapeImageLookup={},dt=i.shapeImageLookup&&i.shapeImageLookup.idPair||[],ft=0,li=dt.length;ft<li;ft++)ot=dt[ft],ot&&(g=ot.second,this._shapeImageLookup[ot.first]=g,this._unmappedToMappedImageIndex[g]||(this._unmappedToMappedImageIndex[g]=p,this._mappedToUnmappedImageIndex[p++]=g));for(ai=this._palette.getBackgroundShapeIds(),vi=ai.map(function(n){return w._shapeImageLookup[n]}),this._initClassicIcons(),this._setStateIndex(),o=0;o<i.visibilityRanges.length;o++)if(ht=i.visibilityRanges[o],ht)for(e=0;e<ht.length;e++){var ct=ht[e],p=ct.visibleValueId||0,h=i.booleanValues[p];h&&(h.type===1?ct.visible=h.fValue||!1:(ct.visible=this._palette.getBooleanPaletteValue(h.pValue),ct.visiblePaletteKey=h.pValue))}for(this._styleVisibilities=this._getvisibilities(i.drawOrder.visibilityIndex,i.drawOrder.geometry,i.visibilityRanges),this._markupVisibilities=this._getvisibilities(i.markupOrder.visibilityIndex,i.markupOrder.geometry,i.visibilityRanges),o=0;o<c.length;o++)if((l=c[o],l&&!(l.length<1))&&(gt=l[0].graphType,l&&gt))switch(gt){case 1:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.colorValues[a],!h)continue;h.type===1?s.value=h.fValue||0:(s.value=this._palette.getColorPaletteValue(h.pValue,!1),s.paletteKey=h.pValue,isNaN(s.value)&&(s.value=-1))}break;case 2:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.singleValues[a],!h)continue;h.type===1?s.value=h.fValue||0:(s.value=this._palette.getSinglePaletteValue(h.pValue),s.paletteKey=h.pValue)}break;case 16:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.booleanValues[a],!h)continue;h.type===1?s.value=h.fValue||!1:(s.value=this._palette.getBooleanPaletteValue(h.pValue),s.paletteKey=h.pValue)}break;case 17:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.stringValues[a],!h)continue;h.type===1?(yi=h.fValue||0,s.value=this._fixedStringList[yi]):(s.value=this._palette.getStringPaletteValue(h.pValue),s.paletteKey=h.pValue)}break;case 18:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.enumValues[a],!h)continue;h.type===1?s.value=h.fValue||0:(s.value=this._palette.getSinglePaletteValue(h.pValue,!1,0),s.paletteKey=h.pValue)}}for(o=0;o<c.length;o++)if(c[o]&&!(c[o].length<1)){if(v=c[o][0],lt=this._getColorformat(v),lt!==null){for(at=new ut,e=0;e<c[o].length;e++)y=c[o][e],nt=new f(y.value,lt),at.addKey(y.position,nt.red,nt.green,nt.blue,nt.alpha,y.tangentType===ui?1:y.tangentType===fi?2:0),e+1<c[o].length&&(c[o][e+1].graphType=1,lt=this._getColorformat(c[o][e+1]));at.computeTangents();this._computedSplineGraphs[o]=at}else if(this._IsCurveGraph(v)){for(vt=new it,e=0;e<c[o].length;e++)y=c[o][e],pi=new pt(y.position,y.value,y.tangentType===ui?1:y.tangentType===fi?2:0),vt.addKey(pi);vt.computeTangents();this._computedSplineGraphs[o]=vt}else if(this._IsDiscreateCollectionGraph(v)){for(ti=new d,e=0;e<c[o].length;e++)ti.addRange(c[o][e].start,c[o][e].end,c[o][e].value);this._computedSplineGraphs[o]=ti}else if(this._IsTransformCurveGraph(v))p=v.numericTransformCurve,this._computedSplineGraphs[p]&&(wi=new st(this._computedSplineGraphs[p]),this._computedSplineGraphs[o]=wi);else if(this._IsHslaTransformCurveGraph(v)){var ki=this._computedSplineGraphs[v.h],di=this._computedSplineGraphs[v.s],gi=this._computedSplineGraphs[v.l],nr=this._computedSplineGraphs[v.a],tr=new et(ki,di,gi,nr);this._computedSplineGraphs[o]=tr}this._computedSplineGraphs[o]&&(this._computedSplineGraphPaletteKeys[o]=v.paletteKey)}for(e=0,bi=this._drawOrderList.bucket.length;e<bi;e++)tt=this._drawOrderList.bucket[e].toString(),ii=this._drawOrderList.passID[e],this._bucketToPassDefinitionIndex[tt]=ii,this._bucketToDrawOrderListIndex[tt]=e,yt=this._getMappedImageIndex(ii),yt>=0&&(this._bucketToMappedImageIndex[tt]=yt),wt=this._mappedToUnmappedImageIndex[yt],this._unmappedIndexToBucketIds[wt]||(this._unmappedIndexToBucketIds[wt]=[]),this._unmappedIndexToBucketIds[wt].push(tt);t.timeEnd("ParseTemplate");ri=[n._haloImageBucket,n.DefaultBucketForLocalCat,n.pricePoiBucketId,n.xsrPolygonBucketId,n.cityPolygonBucket];this._poiRefresh&&ri.push(n.itineraryPoiBucketId,n._multimodeTransitBucket);this.prefetchImages(ri,vi,!0).then(function(){w._initialized=!0;w._ready=new ni(w);u(w);w.ready&&w.ready.invoke()})},n.prototype._getImageByBucketId=function(n){if(this._images){if(!this._images[n]){var t=this._bucketToMappedImageIndex[n];this._updateCachedImages(this._mappedToUnmappedImageIndex[t])}return this._images[n]}return null},n.prototype._updateCachedImages=function(t){var e=n._mapImagesUnmapped[t],o,s,i,u,f,h;if(e&&(o=this._unmappedToMappedImageIndex[t],!this._mapImages[o]&&(this._mapImages[o]=e,s=e.vectorImage,i=this._unmappedIndexToBucketIds[t],i)))for(u=0;u<i.length;u++)f=i[u],h=this._passDefinitionList[this._bucketToPassDefinitionIndex[f]],this._images[f]={scale:h.scale,scaleTransform:h.scaleTransform,template:s?new r(s):null,visibility:this._styleVisibilities[this._bucketToDrawOrderListIndex[f]]}},n.prototype._initClassicIcons=function(){var f,r,t,u,i;this._poiRefresh&&(f="Classic",r=9999,n._mapImagesUnmapped[r]={vectorImage:{hitTest:1,overrideHotspot:!0,records:[{cX:0,cY:0,rX:10,rY:10,recordType:"FilledEllipse",color:"#FFFFFF",colorStylePaletteKey:"UIElement.HighlightFillColor",scale:1,scalePaletteKey:"UIElement.HighlightScale",shapePaletteKey:"UserPoint.Shape-Background"},{cX:0,cY:0,rX:10,rY:10,recordType:"Ellipse",scale:1,scalePaletteKey:"UIElement.HighlightScale",shapePaletteKey:"UserPoint.Shape-Background",strokeScale:1,strokeScalePaletteKey:"UserPoint.HighlightStrokeWidthScale",lineStyle:{color:"#FFFFFF",colorStylePaletteKey:"UIElement.HighlightStrokeColor",strokeWidth:1}},{cX:0,cY:0,rX:7,rY:7,recordType:"FilledEllipse",color:"#FFFFFF",colorStylePaletteKey:"UIElement.FillColor",scale:1,scalePaletteKey:"UIElement.BackgroundScale",shapePaletteKey:"UserPoint.Shape-Background"}]}},t=this._palette,u=t.addFixedString(f),this._shapeImageLookup[u]=r,i={type:0,hasValue:!0,stringId:u},t.addPaletteItem("DefaultPointStateClassic.Shape-Background",i),t.addPaletteItem("HoverPointStateClassic.Shape-Background",i),t.addPaletteItem("HoverPointStateClassic.HighlightScale",{type:2,hasValue:!0,value:1.3}),t.addPaletteItem("HoverPointStateClassic.HighlightStrokeWidthScale",{type:2,hasValue:!0,value:2}),t.addPaletteItem("SelectedPointStateClassic.Shape-Background",i),t.addPaletteItem("SelectedPointStateClassic.HighlightScale",{type:2,hasValue:!0,value:1.8}),t.addPaletteItem("SelectedPointStateClassic.HighlightStrokeWidthScale",{type:2,hasValue:!0,value:2}),t.addPaletteItem("InactivePointStateClassic.Shape-Background",i),t.addPaletteItem("InactivePointStateClassic.HighlightScale",{type:2,hasValue:!0,value:0}),t.addPaletteItem("InactiveSelectedPointStateClassic.Shape-Background",i),t.addPaletteItem("InactiveSelectedPointStateClassic.HighlightScale",{type:2,hasValue:!0,value:1.5}))},n.prototype._createPalette=function(n,t){var f,g=n.nodes,it=n.types,e,v,y,w,nt,k,d,rt,h,p,c,b,tt,o,s,l,i,r,a,u;for(ft&&ft.initialize(g,this._fixedStringList),e={},v={},i=0;i<it.length;i++)if(y=it[i],y){for(w=y.parentId,b=this._fixedStringList[y.nameId],e[i]={name:b,properties:[]},w>=0&&(o=e[w],o?e[i].parent=o:v[i]=w),nt=y.properties,k=0;k<nt.length;k++)(d=nt[k],d)&&(rt=this._fixedStringList[d.nameId],e[i].properties.push({propertyName:rt,valueType:d.valueType}));for(u in v)i===v[u]&&(s=e[u],s&&(s.parent=e[i],delete v[u]))}for(h={},p={},i=0;i<g.length;i++)if((c=g[i],c)&&(b=this._fixedStringList[c.nameId],tt=e[c.nodeTypeId],tt||!(c.parentId>=0))){h[i]={name:b,nodeType:tt};c.parentId>=0&&(o=h[c.parentId],o?(o.children||(o.children=[]),o.children.push(h[i])):p[i]=c.parentId);for(u in p)i===p[u]&&(s=h[u],s&&(s.children||(s.children=[]),s.children.push(h[i]),delete p[u]))}for(l={},i=0;i<t.length;i++)if(r=t[i],a=this._fixedStringList[r.keyId],r&&a)switch(r.type){case"StringPaletteItem":l[a]={keyId:r.keyId,type:0,stringId:r.stringPaletteItem};break;case"ColorPaletteItem":l[a]={keyId:r.keyId,type:1,value:r.colorPaletteItem.value,ignoreTransform:r.colorPaletteItem.ignoreTransform,additionalAttributes:r.colorPaletteItem.additionalAttributes};break;case"SinglePaletteItem":l[a]={keyId:r.keyId,type:2,value:r.singlePaletteItem.value,ignoreTransform:r.singlePaletteItem.ignoreTransform};break;case"EnumPaletteItem":l[a]={keyId:r.keyId,type:4,value:r.enumPaletteItem.value,ignoreTransform:r.enumPaletteItem.ignoreTransform};break;case"BooleanPaletteItem":l[a]={keyId:r.keyId,type:3,value:r.booleanPaletteItem}}f=new ei(this._templateName,this._fixedStringList,this._fixedStringMap);for(u in h)f.populate(h[u],l);return this._poiRefresh&&(this._paletteFontProps||(f.addItem("DefaultPointStateSearch.FontWeight",3),f.addItem("HoverPointStateSearch.FontWeight",4),f.addItem("SelectedPointStateSearch.FontWeight",4),f.addItem("InactiveSelectedPointStateSearch.FontWeight",4)),f.addPaletteItem("Inverted.FillColor",{type:1,hasValue:!0,value:-1,ignoreTransform:!1,additionalAttributes:{propertyReferenceId:this._getFixedStringId("IconColor")}}),f.addPaletteItem("Inverted.IconColor",{type:1,hasValue:!0,value:-1,ignoreTransform:!1,additionalAttributes:{propertyReferenceId:this._getFixedStringId("FillColor")}})),f},n.prototype._getShieldUnmappedImageIndexes=function(n){var s=[],c=this._shieldImages[n],f=this._shieldStyleResponseData[parseInt(n)],e,h,r,t,o,u,i;if(f)for(e=f.length,c=new Array(e),h=this._getFixedStringId("Default"),r=0;r<e;r++){for(t=this._computeSplineGraphObject(this._passDefinitionList[f[r]].image,1),o=this._imgVariants[t].imageReferences,u=0;u<o.length;u++)if(i=o[u],i.keyId===this._paletteFlavorKeyId){t=i.imageId;break}else i.keyId===h&&(t=i.imageId);s.push(t)}return s},n.prototype._getShieldImages=function(t,i){var u=this._shieldImages[t],h,o,f,e,s;for(u||(u=[]),h=this._getShieldUnmappedImageIndexes(t),f=0;f<h.length;f++){for(e=-1,s=0;s<i.length;s++)if(i[s]===f){e=f;break}(o=n._mapImagesUnmapped[h[f]],o&&o.vectorImage)&&(e===-1||u[e]||(u[e]=new r(o.vectorImage)))}return this._shieldImages[t]=u,u},n.prototype._getShieldScales=function(n,t){var i,u=this._shieldScaleListForZoom[n]||{},s,f,e,r,o,h;if(u&&(i=u[t],!i)){if(s=this._getStyleScale(n),f=this._shieldStyleResponseData[parseInt(t)],f)for(e=f.length,i=new Array(e),r=0;r<e;r++)o=this._passDefinitionList[f[r]],h=this._getScale(o.shieldScale,o.shieldScalingTransform,s),i[r]=h;u[t]=i;this._shieldScaleListForZoom[n]=u}return i},n.prototype._populateMarkupByZoom=function(r){var s,ct,c,y,it,rt,ut,h,l,a,f,ot,v,g,tt,u;for(t.time("ParseMarkupOrder"),s=this._markupOrderList,ct=this._passDefinitionList,s.validKeys={},s.keys=s.bucket,c={},y=[],s.templates=new Array(s.passID.length),it=this._getStyleScale(r),rt=wt.Browser.is_webkit?n._webkitFontFillLightnessFactor:0,f=0,ut=s.bucket.length;f<ut;f++)h={},l=s.passID[f],y[l]||(y[l]=this._getMarkupOrderTemplate(l,it,rt)),h.style=y[l],h.visibility=this._markupVisibilities[f],h.priority=s.priority[f],h.globalOrder=f+1,a=s.bucket[f].toString()+","+this._markupVisibilities[f].geometryType,c[a]?c[a].style.styleDynamic.secondaryFontSize=h.style.styleDynamic.fontSize:c[a]=h;var b=n._poiStyles[this._templateName],ft=b&&Object.keys(b)||[],lt=[{visible:!0,visiblePaletteKey:this._fixedStringMap["UserPoint.LabelVisible"],zoom:0}],et={drawingStyleVisibilities:{}},k=et.drawingStyleVisibilities;for(k[3]=k[2]=k[1]=lt,f=0,ot=ft.length;f<ot;f++){var p=ft[f],w=p&&p.split(","),st=w&&w[0],d=w&&parseInt(w[1]);if(st&&d&&(v=b[p],g=c[p]={style:{styleStatic:i._copyObject(v.styleStatic),styleDynamic:v.styleDynamic},priority:v.styleDynamic.priority,globalOrder:v.styleDynamic.globalOrder},d===1)){var a=(this._paletteFontProps?n.DefaultBucketForLocalCat:n._userPoiLabelStylesBucket)+","+d,at=c[a],nt=at.style,o=i._copyObject(nt.styleStatic),e=nt.styleDynamic,ht=nt.styleDynamic.fontColor;o.wrapDisplayName=!0;o.backgroundColor=n.isDarkTheme(this._templateName)?"rgba(64,64,64,0.7)":"rgba(236,234,227,0.7)";switch(st){case n.bucketIdForPoi:h&&(r<16?(o.offsetX=13,o.offsetY=13):r>=16&&r<=19?(o.offsetX=15,o.offsetY=15):(o.offsetX=17,o.offsetY=17));break;case n.bucketIdForSelectedPoi:o.offsetX=24;o.offsetY=24;ht=this._getColor("SelectedPointState"+n._labelColor,!0)}tt=g.style;u=tt.styleDynamic;tt.styleStatic=o;u.font=e.font;u.fontPaletteKey=e.fontPaletteKey;u.fontColor=ht;u.fontColorPaletteKey=e.fontColorPaletteKey;u.fontSize=e.fontSize;u.secondaryFontSize=e.secondaryFontSize;u.fontWeight=e.fontWeight;u.fontWeightPaletteKey=e.fontWeightPaletteKey;u.fontStyle=e.fontStyle;u.fontStylePaletteKey=e.fontStylePaletteKey;u.fontCaps=e.fontCaps;u.fontCapsPaletteKey=e.fontCapsPaletteKey;u.outlineColor=e.outlineColor;u.outlineColorPaletteKey=e.outlineColorPaletteKey;g.visibility=et}}this._markupOrder.addItem(""+r,c);t.time("PopulateMarkupOrder");t.timeEnd("ParseMarkupOrder")},n.prototype._getMarkupOrderTemplate=function(t,i,r){var u=this._passDefinitionList[t],l={styleStatic:{},styleDynamic:{font:"",fontSize:0,fontColor:"",outlineColor:""},markupPassDefinitionIndex:t},e=l.styleStatic,f=l.styleDynamic,a,v,k,d,o,s,h,y,p,c,b;f.font=this._computeSplineGraphObject(u.fontName,i)||"SegoeBing";f.fontPaletteKey=this._getSplineGraphPaletteKey(u.fontName);a=this._computeSplineGraphObject(u.fontColorTransform,i);f.fontColor=a?this._computeHslaTransform(u.fontColor,i,a,r):this._computeSplineGraphObject(u.fontColor,i);f.fontColorPaletteKey=this._getSplineGraphPaletteKey(u.fontColor);this._paletteFontProps?(f.fontWeight=this._computeSplineGraphObject(u.fontWeight,i)||0,f.fontWeightPaletteKey=this._getSplineGraphPaletteKey(u.fontWeight),f.fontStyle=this._computeSplineGraphObject(u.fontStyle,i)||0,f.fontStylePaletteKey=this._getSplineGraphPaletteKey(u.fontStyle),f.fontCaps=this._computeSplineGraphObject(u.fontCapitals,i)||0,f.fontCapsPaletteKey=this._getSplineGraphPaletteKey(u.fontCapitals)):(f.fontWeight=this._computeSplineGraphObject(u.fontBold,i)?4:this._computeSplineGraphObject(u.fontSemiBold,i)?3:this._computeSplineGraphObject(u.fontLight,i)?1:0,f.fontColorPaletteKey&&(v=f.fontColorPaletteKey.split("."),v.length===2&&(f.fontWeightPaletteKey=v[0]+".FontWeight")),k=this._computeSplineGraphObject(u.fontItalics,i),f.fontStyle=k?1:0,f.fontCaps=this._computeSplineGraphObject(u.fontAllCapitals,i)?1:this._computeSplineGraphObject(u.fontSmallCaps,i)?2:0);e.preferredFontSize=this._computeSplineGraphObject(u.preferedFontSize,i);e.preferredFontSizePaletteKey=this._getSplineGraphPaletteKey(u.preferedFontSize);e.fontSizeTransform=this._computeSplineGraphObject(u.preferedFontSizeTransform,i)||1;f.fontSize=e.preferredFontSize*e.fontSizeTransform;e.pointLabelPlacementPreference=this._computeSplineGraphObject(u.pointPlacement,i);e.polygonFillPreference=this._computeSplineGraphObject(u.areaFillingPreference,i);e.verticalAlignment=this._computeSplineGraphObject(u.lineVerticalAlign,i);e.fontGlow=this._computeSplineGraphObject(u.fontGlow,i);e.fontOutlined=this._computeSplineGraphObject(u.fontOutlined,i);e.fontUnderlined=this._computeSplineGraphObject(u.fontUnderlined,i);e.glowColor=this._computeSplineGraphObject(u.glowColor,i);e.glowSize=this._computeSplineGraphObject(u.glowSize,i);d=this._computeSplineGraphObject(u.heightMatch,i);switch(d){case"LabelHeightMatchXHeight":o=2;break;case"LabelHeightMatchAscent":o=1;break;default:o=0}return o!==0&&(s=0,h=this._computeSplineGraphObject(u.heightMatchPixels,i),h&&(y=this._computeSplineGraphObject(u.heightMatchPixelsTransform,i),y&&(h*=y),o===1?s=h*n._capHeightRatio:o===2&&(s=h*n._xHeightRatio),s<f.fontSize&&(f.fontSize=s))),p=this._computeSplineGraphObject(u.outlineColorTransform,i),f.outlineColor=p?this._computeHslaTransform(u.outlineColor,i,p):this._computeSplineGraphObject(u.outlineColor,i),f.outlineColorPaletteKey=this._getSplineGraphPaletteKey(u.outlineColor),e.outlineWidth=this._computeSplineGraphObject(u.outlineWidth,i),e.outlineWidth<2&&(e.outlineWidth+=n._outlineWidthDelta),w.ignoreStrata||(c={},c.alpha=this._computeSplineGraphObject(u.overrideAlpha,i),c.fontSize=this._computeSplineGraphObject(u.strataFontSize,i),e.strataStyle=c),b=this._computeSplineGraphObject(u.shieldLabelVisibility,i),e.shieldLabelVisibility=b==="Both"?2:b==="NoText"?1:0,l},n._getPaletteKeyId=function(n){var t,i;return n&&(t=n.paletteKeyId,t||(i=n.idPair&&n.idPair[0],t=i&&i.second)),t||0},n.prototype._addRecordStyleString=function(t,i,r,u){var f=t[i];if(typeof f!="undefined"){var e=u[f]||{},h=e.type!=="SvgFixedColor"&&e.svgPaletteColor,o=n._getPaletteKeyId(h),s=void 0;o&&(s=this._fixedStringList[o]);t[r]=s}},n.prototype._resolveRecord=function(t,i,r,u,f){var h=t[i],e,o,s,c;if(typeof h!="undefined")switch(u){case 1:e=f[h]||{};o=void 0;e.type==="SvgFixedColor"?o=e.color:e.type==="SvgPaletteColor"&&(s=this._palette.getColorPaletteValue(n._getPaletteKeyId(e.svgPaletteColor),!1),o=s||s===0?a.convertPackedTorgba(s):e.color||0);t[r]=o;break;case 2:c=this._palette.getSinglePaletteValue(h);t[r]=c}},n.prototype._getDefaultVectorImageTemplate=function(i){var u,r;return this._initialized?(r=n.getBucketForCategory(i),r||(r=n.DefaultBucketForLocalCat),this._images&&r?u=this._getImageByBucketId(r):t.log(null,"Not able to create vector image templates",this._images),u):(t.log(null,"TemplateSelector needs to be initialized before getImage() call",this._initialized),null)},n.prototype._getDefaultVectorImageTemplateAsync=function(i,r){var f=this,u;if(!this._initialized)return t.log(null,"TemplateSelector needs to be initialized before getImage() call",this._initialized),null;u=n.getBucketForCategory(i);u||(u=n.DefaultBucketForLocalCat);this.prefetchImages([u]).then(function(){r&&r(f._images[u])})},n.prototype._getCardVectorImageTemplateAsync=function(t,u,e,o,s,h,c){var v=this,a,l;if(e=e||f.transparent,o=o||f.black,s=s||.7,a=u+e+o+s.toString(),l=this._localCatIdVectorImageTemplate[a],l&&t){Microsoft.Maps.setAsync(function(){t({icon:l})});return}this._getDefaultVectorImageTemplateAsync(u,function(u){var w,y,d,f,g,k,p;if(u&&u.template){for(w=u.template.getVectorImage(),y={},y.hotspotX=w.hotspotX,y.hotspotY=w.hotspotY,y.records=[],d=!1,f=0,g=w.records.length;f<g;f++){y.records[f]=i._copyObject(w.records[f]);y.records[f].style={};for(k in w.records[f].style)y.records[f].style[k]=w.records[f].style[k];p=w.records[f].style.fillStylePaletteKey;p&&(d=!0,p.indexOf(n._backgroundColor)>-1||p.indexOf(n._borderColor)>-1||p.indexOf(n._fillColor)>-1||p.indexOf(n._borderStrokeColor)>-1||p.indexOf(n._strokeColor)>-1?y.records[f].style.fillStyle=e:(p.indexOf(n._colorString)>-1||p.indexOf(n._iconColor)>-1)&&(y.records[f].style.fillStyle=o))}if(l=new r(y),l.setScale(s),h){c=c||h;var nt=l.getScale(),b=l.getBounds().getSize(),tt=b.width/nt,it=b.height/nt;(b.width>h||b.height>c)&&l.setScale(Math.min(h/tt,c/it))}v._localCatIdVectorImageTemplate[a]=l}Microsoft.Maps.setAsync(function(){t&&t({icon:l})})})},n.prototype._applyStackedBackgroundShape=function(t,i,u,f){for(var l,o,it,w,b,a,v,d,g=this,h=f&&f.getVectorImage(),c=h&&h.records||[],nt,y,s="",ut=function(t){var r=g._getFixedStringId(t),u=g._shapeImageLookup[r],i=n._mapImagesUnmapped[u];return i&&i.vectorImage},tt=function(n,t){for(var i,u,f=n&&Object.keys(n)||[],r=0,e=f.length;r<e;r++)i=f[r],i.endsWith("PaletteKey")&&(u=(n[i]||"").split("."),u.length===2&&(n[i]=t+"."+u[1]))},e=0,p=c.length;e<p;e++)if(l=c[e].shapePaletteKey,l)if(s)if(l===s)y=e;else break;else l.endsWith(n.backgroundShapeRecord)&&(nt=y=e,s=l);else if(s)break;if(t===2||t===3)it=t===2?n.pricePoiBucketId:n.itineraryPoiBucketId,w=this._mapImages[this._bucketToMappedImageIndex[it]],o=w&&w.vectorImage;else{if(b=this._getStackedStringValue(u,s),!b)return f;o=ut(b)}if(o){a=JSON.parse(JSON.stringify(o.records));v=void 0;i?v=c.filter(function(n){return n.recordType==="Text"||n.vectorType===3}):(a=a.filter(function(n){return n.recordType!=="Text"&&n.vectorType!==3}),v=c.slice(y+1));var rt=o.overrideHotspot||t===2,k=[].concat(c.slice(0,nt),a,v),ft={hotspotX:rt?o.hotspotX:h.hotspotX,hotspotY:rt?o.hotspotY:h.hotspotY,hitTest:h.hitTest,records:k};for(f=new r(ft),d=s.split(".")[0],e=0,p=a.length;e<p;e++)tt(k[e],d),tt(k[e].style,d)}return f},n.prototype._applyStackedColor=function(n,t,i,r){var f=t[r],u=this._getStackedColorValue(n,f);u&&(t[i]=u)},n.prototype._getStackedColorValue=function(n,t){var u,i,r;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedColorPaletteValue(n.concat(i[0]),i[1]),u=isNaN(r)?"":isFinite(r)?a.convertPackedTorgba(r):f.black),u},n.prototype._applyStackedScale=function(n,t,i,r){var e=t[r],f=this._getStackedNumericValueItem(n,e),u=f&&f.value;typeof u=="number"&&isFinite(u)&&(t[i]*=u)},n.prototype._getStackedNumericValueItem=function(n,t){var r=null,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedSinglePaletteItem(n.concat(i[0]),i[1])),r},n.prototype._applyStackedEnum=function(n,t,i,r){var f=t[r],u=this._getStackedEnumValue(n,f);u&&(t[i]=u)},n.prototype._getStackedEnumValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedEnumPaletteValue(n.concat(i[0]),i[1])),r},n.prototype._applyStackedString=function(n,t,i,r){var f=t[r],u=this._getStackedStringValue(n,f);u&&(t[i]=u)},n.prototype._getStackedStringValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedStringPaletteValue(n.concat(i[0]),i[1])),r},n.prototype._getStackedBooleanValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedBooleanPaletteValue(n.concat(i[0]),i[1])),r},n.prototype._getPoiImageStyleValue=function(n,t,i){var r=this._getFixedStringId(i+n),u=this._palette.getSinglePaletteValue(r,!0);return isNaN(u)&&(r=this._getFixedStringId(t+n),u=this._palette.getSinglePaletteValue(r,!0)),u},n.prototype._getColor=function(n,t){var r=this._getFixedStringId(n),i=this._palette.getColorPaletteValue(r,t);return isNaN(i)?"":i||i===0?a.convertPackedTorgba(i):f.black},n.prototype._getPoiImageColor=function(t,i,r){var u=this._getColor(r+t,!0),f=!1;return u&&(f=!0),f||(u=this._getColor(i+t,!0),u||i.indexOf("Transit")!==0||(u=n._task4Color[t]),i===n._taskList[5]&&(u=n._layerPoiColors[t])),u},n.prototype._getScale=function(n,t,i,r,u){var f,e;return u===void 0&&(u=!1),f=r!==undefined?r:this._computeSplineGraphObject(n,i),u||(e=this._computeSplineGraphObject(t,i),e>0&&(f=f*e)),f},n.prototype._setStateIndex=function(){var t="en-us",n,i;for(this._currentStateIndex=0,n=0;n<this._state.length;n++)if(i=this._state[n].idPair[0],i){var f=this._propertyValues[i.second],u=this._fixedStringList[f.propVal].toLowerCase(),r=o.dynamicProperties.market.toLowerCase();if(r===t&&u===t||r.substr(0,2)!==t.substr(0,2)&&u.substr(0,2)===r.substr(0,2)){this._currentStateIndex=n;break}}},n.prototype._getMappedImageIndex=function(n){var f=this._passDefinitionList[n],t=-1,r,u,i;if(typeof f.imageGroup!="undefined"){if(t=Math.round(this._computeSplineGraphObject(f.imageGroup,1)),r=this._imageGroups[t].images,!r)return t;for(u=0;u<r.length;u++)if(i=this._groupedImageOptions[r[u]],i.stateId==this._currentStateIndex){t=i.mapImage;break}else i.stateId==0&&(t=i.mapImage)}return t},n.prototype._processVectorImage=function(n,t){var u,f,i,r;if(n&&t){for(u=0,f=n.records.length;u<f;u++)i=n.records[u],this._resolveRecord(i,"fillValueId","fill",1,t),this._addRecordStyleString(i,"fillValueId","fillStylePaletteKey",t),this._resolveRecord(i,"strokeValueId","stroke",1,t),this._addRecordStyleString(i,"strokeValueId","strokeStylePaletteKey",t),this._resolveRecord(i,"colorValueId","color",1,t),this._addRecordStyleString(i,"colorValueId","colorStylePaletteKey",t),typeof i.scalePaletteKeyId=="number"&&(this._resolveRecord(i,"scalePaletteKeyId","scale",2),i.scalePaletteKey=this._fixedStringList[i.scalePaletteKeyId]),typeof i.strokeScalePaletteKeyId=="number"&&(this._resolveRecord(i,"strokeScalePaletteKeyId","strokeScale",2),i.strokeScalePaletteKey=this._fixedStringList[i.strokeScalePaletteKeyId]),typeof i.shapePaletteKeyId=="number"&&(i.shapePaletteKey=this._fixedStringList[i.shapePaletteKeyId]),typeof i.lineStyle!="undefined"&&(this._resolveRecord(i.lineStyle,"colorValueId","color",1,t),this._addRecordStyleString(i.lineStyle,"colorValueId","colorStylePaletteKey",t)),r=i,typeof r.stringSourceType!="undefined"&&(this._resolveRecord(r.textStyle,"colorValueId","color",1,t),this._addRecordStyleString(r.textStyle,"colorValueId","colorStylePaletteKey",t),r.textStyle.fontFamily=this._fixedStringList[r.textStyle.fontFamilyId]);n.hitTest=1}},n.prototype._parseImageRecord=function(n,t){var i=n&&n.vectorImage;if(i)return this._processVectorImage(i,t),n},n.prototype.getRoutePoiVectorImageTemplate=function(t,i,u){var a=n.directionIconTypeBuckets[t],nt=n._poiStateNames[i],b="d"+a+nt+u.toString(),f=this._primitiveTemplateCache.getItem(b),v,k,y,e,s,p,o,c,d,g;if(f)return f;if(this._poiRefresh)v=7,k=n._getPointStateName(i,n._poiTypeStateGroups[v]),f=this._getTemplates_PoiRefresh(v,!1,a,null,null,1,u,[k],!0,!0,null);else{if(f=[],y=this._getStyleScale(u),i===3){switch(t){case"start":e="#1fa94a";s="rgba(227,231,204,0.5)";break;default:e="#4c97ec";s="rgba(204,230,255,0.5)";break;case"end":e="#de2525";s="rgba(248,211,211,0.5)"}(e||s)&&(p=this._getHaloImage(y,function(){return t==="turn"?1.25:1.5},function(){return e},function(){return s},function(){return e}),p&&f.push(p))}if(o=this._getImageByBucketId(a),o&&o.template){var tt=this._getScale(o.scale,o.scaleTransform,y),h=o.template.getVectorImage(),w={hitTest:1,hotspotX:undefined,hotspotY:undefined,records:[]};for(c=0,d=h.records.length;c<d;c++)w.records[c]=n._cloneObject(h.records[c]);i===5&&h.records&&h.records.length>1&&h.records[1].style&&(w.records[1].style.fillStyle="#727272");g=new r(w,tt);f.push(g)}}return f&&f.length?this._primitiveTemplateCache.addItem(b,f):f=t==="turn"?[l.directionsTurnTemplate]:[l.poiTemplates[i]],f},n.prototype._getHaloImage=function(t,u,f,e,o,s,h){var ft,p,v,d,ot,a,y,rt,g,st,ut,b,nt,tt,it,c,w,l;if(s===void 0&&(s=1),h===void 0&&(h=!0),p=this._images[s===2?n.pricePoiBucketId:n._haloImageBucket],p&&p.template){v={};v.hitTest=1;v.records=[];var ht=this._getScale(p.scale,p.scaleTransform,t),et=1,k=p.template.getVectorImage();for(v.hotspotX=k.hotspotX,v.hotspotY=k.hotspotY,d=0,ot=k.records.length;d<ot;d++)if(a=k.records[d],a.vectorType!==3||h){for(y=i._copyObject(a),v.records.push(y),a.scale>0&&(l=u&&u(),l>=0&&(y.scale=l,et=l)),y.style={},rt=Object.keys(a.style),g=0,st=rt.length;g<st;g++)ut=rt[g],y.style[ut]=a.style[ut];for(b=[],b.push(a.style.strokeStylePaletteKey),b.push(a.style.fillStylePaletteKey),nt=0;nt<b.length;nt++)tt=b[nt],tt&&(it=tt.split("."),it.length>1&&(c="."+it[it.length-1],(c===n._highlightBorderColor||c===n._borderColor)&&(w=f&&f(c)),(c===n._highlightStrokeColor||c===n._strokeColor)&&(w=o&&o(c)),(c===n._highlightFillColor||c===n._fillColor||c===n._highlightIconColor||c===n._iconColor)&&(w=e&&e(c)),w&&(tt===a.style.fillStylePaletteKey?y.style.fillStyle=w:y.style.strokeStyle=w)))}l=ht*et;l===1.0666666177777648?l=1.084:l===1.15&&(l=1.16);l&&(ft=new r(v,l))}return ft},n.prototype._addShadow_PoiRefresh=function(n,t,i){var u;if(n&&n.length&&t&&(u=this._computeSplineGraphObject(t.shadow,i),u)){var e=this._computeSplineGraphObject(t.glowColor,i),o=this._computeSplineGraphObject(t.glowSize,i),f=n[0],r=f&&f.shadowStyle;r&&(r.shadowColor=e,r.shadowBlur=o,r.shadowOffset={x:0,y:2})}},n._getPointStateName=function(t,i){var r=n._poiStateNames[t]||"";return i&&r.endsWith("PointState")&&(r=r+(i||"")),r},n.prototype.getCategoryIconTemplate=function(t,u,e,o,s){var a=this,c,l,h;if(!this._poiRefresh){this._getCardVectorImageTemplateAsync(t,u,null,e,1,o,s);return}if(c=""+u+e+o+s,l=this._categoryIconCache.getItem(c),t){if(l){Microsoft.Maps.setAsync(function(){t(l)});return}h=n.getBucketForCategory(u);h||(h=n.DefaultBucketForLocalCat);this.prefetchImages([h]).then(function(){var tt=n._transitCatIds[u],it=5,et=n._getPointStateName(2,n._poiTypeStateGroups[it]),rt=a._getTemplates_PoiRefresh(it,!1,h,null,null,1,12,[et],!0,!0,null),ut=rt&&rt[0],w=null,b="",k="",g=null,v,nt,y,ft,p;if(ut){for(v=ut.getVectorImage(),nt={hotspotX:v.hotspotX,hotspotY:v.hotspotY,records:[]},y=0,ft=v.records.length;y<ft;y++){var d=v.records[y],ot=nt.records[y]=i._copyObject(d),l=ot.style=i._copyObject(d.style);d.shapePaletteKey&&d.shapePaletteKey.endsWith(n.backgroundShapeRecord)?(!k&&l.fillStylePaletteKey&&l.fillStylePaletteKey.endsWith(n._fillColor)&&(k=l.fillStyle),l.fillStyle=l.strokeStyle=f.transparent):(b=b||l.fillStyle,l.fillStyle=e||(tt?k:b),l.strokeStyle=f.transparent)}w=new r(nt);o&&(s=s||o,p=w.getBounds().getSize(),p.width&&p.height&&w.setScale(Math.min(o/p.width,s/p.height)));g={icon:w,iconColor:tt?k:b};a._categoryIconCache.addItem(c,g)}Microsoft.Maps.setAsync(function(){t(g)})})}},n.prototype._getLandmarkVectorImageTemplate_PoiRefresh=function(t,r,u,f){var o=t.bucket,s=t.entity&&t.entity.oid||"",h=n._getPointStateName(r,n._poiTypeStateGroups[f]),c,e,l,a,v;return(n._multimodeTransitBucketIds[o]&&f===4&&(o=n._multimodeTransitBucket),l=this._getScaleFromZoom(u,o,s,[h]),c=""+f+o+s+h+l,e=this._primitiveTemplateCache.getItem(c),e)?e:(e=this._getTemplates_PoiRefresh(f,!1,o,null,s,t.geometryType,u,[h],!1,!0,l),i._renderAllPoiAndLabelsGL()&&(a=this._bucketToDrawOrderListIndex[t.bucket],v=a&&this._styleVisibilities[a],v&&(t.visibilities=v.drawingStyleVisibilities[t.geometryType])),e&&this._primitiveTemplateCache.addItem(c,e),e)},n.prototype._getBucketPaletteKey=function(t,i){var r="",e,o,s,u,c,f,h;if(!t||t===i)return r;if(e=this._getImageByBucketId(t),o=e&&e.template,o)for(s=o.getVectorImage(),u=0,c=s.records.length;u<c;u++)if(f=s.records[u],!f.shapePaletteKey||!f.shapePaletteKey.endsWith(n.backgroundShapeRecord)){r=f.style.fillStylePaletteKey;break}return r&&(h=r.split("."),h.length>1&&(r=h[0])),r},n.prototype._getPoiVectorImageTemplate_PoiRefresh=function(t,i,r,u,f,e,o){var v=n._getPointStateName(u,n._poiTypeStateGroups[r]),h,c,s,l,a;return(t||(t=n.DefaultBucketForLocalCat),h=[v],o&&h.push(o),c=this._getBucketPaletteKey(i,t),c&&h.push(c),a=this._getScaleFromZoom(f,t,null,h),l=t+","+i+","+h.join(".")+","+a+","+e,s=this._primitiveTemplateCache.getItem(l),s)?s:(s=this._getTemplates_PoiRefresh(r,e,t,i,null,1,f,h,!0,!0,a),s&&this._primitiveTemplateCache.addItem(l,s),s)},n.prototype._getTemplates_PoiRefresh=function(i,u,f,e,o,s,h,c,l,a,v){var w=null,b,k,ft,p,y,st,d,tt,g,ht,it,nt,rt,ct,ut;if(!this._initialized)return t.log(null,"TemplateSelector needs to be initialized before getTemplates() call"),null;if(e=e||f,b=this._passDefinitionList[this._bucketToPassDefinitionIndex[f]],k=this._getStyleScale(h),o&&n._orgImages_poiRefresh[o]){if(ft=this._styleVisibilities[this._bucketToDrawOrderListIndex[f]],l||this._isTemplateVisible(h,ft,s)){var lt=v===null?this._getScale(b.scale,b.scaleTransform,k):v,et=n._orgImages_poiRefresh[o],ot=et?et.vectorImage:null;ot&&(w=[new r(ot,lt)])}}else if(p=this._getImageByBucketId(f),y=p?p.template:null,i===3&&c.push("ItineraryPoint"),y&&a&&(d=JSON.parse(JSON.stringify(y.getVectorImage())),y=new r(d)),y&&(l||this._isTemplateVisible(h,p.visibility,s))){for((i===2||u)&&(st=i===2?2:3,y=this._applyStackedBackgroundShape(st,u,c,y)),y=this._applyStackedBackgroundShape(null,u,c,y),d=y.getVectorImage(),tt=d.records,(i===1||i===4)&&n._invertedIconBucketIds[e]&&c.push("Inverted"),g=0,ht=tt.length;g<ht;g++)it=tt[g],nt=it.style,this._applyStackedColor(c,nt,"fillStyle","fillStylePaletteKey"),this._applyStackedColor(c,nt,"strokeStyle","strokeStylePaletteKey"),this._applyStackedScale(c,nt,"lineWidthScale","strokeScalePaletteKey"),this._applyStackedScale(c,it,"scale","scalePaletteKey");v===null?(ct=this._getSplineGraphPaletteKey(p.scale),ut=this._getStackedNumericValueItem(c,ct)||{},rt=this._getScale(p.scale,p.scaleTransform,k,ut.value,ut.ignoreTransform)):rt=v;y.setScale(rt);w=[y]}return this._addShadow_PoiRefresh(w,b,k),w},n.prototype.getMarkupStyle=function(i,r,u,f){var e=i&&i.bucket,o,w,y,c,l,p;if(e){var a=i.entity,v=i.geometryType,s=Math.round(this._scaleToZoom(r)),h=this._markupOrder.getItem(""+s);if(a&&a.isVenueMapPoi&&a.labelStyleGeometryType&&(v=a.labelStyleGeometryType),h||(this._loadTemplates(s),h=this._markupOrder.getItem(""+s)),t.assertNotNull(h,"no markup order for zoom "+s),o=h[e+","+v],!o){if(w=e,e=this._getOriginalBucketId(e),t.assert(e!=null,"failed to map bucketId "+w),!e)return;o=h[e+","+v]}if(o)return(y=[],c=n._getPointStateName(u,n._poiTypeStateGroups[f]),c&&y.push(c),l=this._computeStyleDynamic(o,v,s,y),l)?(c&&!this._poiRefresh&&(p=this._getColor(c+n._labelColor,!0),p&&l&&(l.fontColor=p)),{styleStatic:o.style.styleStatic,styleDynamic:l}):void 0}},n.prototype.getLandmarkVectorImageTemplate=function(t,i,r,u){var e=this,y,h,c,f;u===void 0&&(u=5);var l=t.bucket,a=!!p.getTransitJson(t.entity),v=a&&t.layer&&t.layer.getHighlighted(),o=this._scaleToZoom(r);if(this._poiRefresh)return v?u=4:u===5&&n._transitBucketIds[l]&&(u=6),this._getLandmarkVectorImageTemplate_PoiRefresh(t,i,o,u);if((y=t.entity&&t.entity.oid||"",h=n._poiStateNames[i],v&&(o=20,r=nt.toScale(null,o,!0)),c=l+y.toString()+h+r.toString(),f=this._primitiveTemplateCache.getItem(c),f)||(f=this.getTemplates(t,r,!0),!f))return f;if(i===3||i==4){var s=a?"Transit":"Business",b=this._getStyleScale(o),w=this._getHaloImage(b,function(){return e._getPoiImageStyleValue(n._highlightScale,s,h)},function(n){return e._getColor(s+n,!0)},function(n){return e._getColor(s+n,!0)},function(n){return e._getColor(s+n,!0)});w&&f.unshift(w)}return this._primitiveTemplateCache.addItem(c,f),f},n.prototype.getPoiTemplate=function(t,i,r,u,f,e,o){u===void 0&&(u=1);f===void 0&&(f=!0);var h=typeof o=="number"?n._taskList[o]:undefined,s=this._getPoiVectorImageTemplate_PoiRefresh(t,e,u,i,r,f,h);return s&&s.slice()},n.prototype.getPoiVectorImageTemplate=function(t,u,e,o,s,h,c){var it=this,a,rt,ft,k,d,g,et,ot,nt,p,lt,ut,st,ht;if(o===void 0&&(o=1),s===void 0&&(s=!0),this._poiRefresh){var vt=typeof c=="number"?n._taskList[c]:undefined,yt=n.getBucketForCategory(t),pt=n.getBucketForCategory(h);a=this._getPoiVectorImageTemplate_PoiRefresh(yt,pt,o,u,e,s,vt)}if(a)return a.slice();var v=typeof c=="number"?n._taskList[c]:n._taskList[0],y=o===2?n._pricePoiStateNames[u]:n._poiStateNames[u],ct=t+y+v.toString()+e.toString()+"_PT"+o+s;if(a=this._primitiveTemplateCache.getItem(ct),a)return a.slice();if(a=[],rt=this._getStyleScale(e),ft=this._getHaloImage(rt,function(){return it._getPoiImageStyleValue(o===1?n._highlightScale:n._scale,v,y)},function(n){return it._getPoiImageColor(n,v,y)},function(n){return it._getPoiImageColor(n,v,y)},function(n){return it._getPoiImageColor(n,v,y)},o,s),ft&&a.push(ft),k={},k.hitTest=1,k.records=[],d=o!==2||!s?this._getDefaultVectorImageTemplate(t):null,d&&d.template){for(g=1,o===2?g=n._scaleForCategoryIconInPricePoi:n._transitCatIds[t]?(et=this._getImageByBucketId(n._transitBucketForScaling)||d,g=this._getScale(et.scale,et.scaleTransform,rt)):g=this._getScale(d.scale,d.scaleTransform,rt),ot=1,nt=d.template.getVectorImage(),p=0,lt=nt.records.length;p<lt;p++){k.records[p]=i._copyObject(nt.records[p]);nt.records[p].scale&&(ut=this._getPoiImageStyleValue(n._backgroundScale,v,y),ut>=0&&(k.records[p].scale=ut,ot=ut));var at=k.records[p].style=i._copyObject(nt.records[p].style),b=at.fillStylePaletteKey,w=null;b&&(b.indexOf(n._backgroundColor)>-1?w=this._getPoiImageColor(n._backgroundColor,v,y):b.indexOf(n._borderColor)>-1?w=this._getPoiImageColor(n._borderColor,v,y):b.indexOf(n._colorString)>-1?w=this._getPoiImageColor(n._colorString,v,y):b.indexOf(n._fillColor)>-1?w=o===2?f.transparent:this._getPoiImageColor(n._fillColor,v,y):b.indexOf(n._borderStrokeColor)>-1?w=this._getPoiImageColor(n._borderStrokeColor,v,y):b.indexOf(n._iconColor)>-1?w=this._getPoiImageColor(n._iconColor,v,y):b.indexOf(n._strokeColor)>-1&&(w=this._getPoiImageColor(n._strokeColor,v,y)),w&&(at.fillStyle=w))}st=new r(k,1,o===2?new tt(0,3):undefined);st.setScale(g*ot);a.push(st)}return a.length===0?(ht=l.poiTemplates[u],a=ht?[ht]:[]):this._primitiveTemplateCache.addItem(ct,a),a.slice()},n.prototype._applyPolygonDrawingPass=function(n,t,i,r){var u,e,f;t&&n&&(t.brushColor?(u=this._getStackedColorValue(i,this._fixedStringList[this._computedSplineGraphPaletteKeys[t.brushColor]]),n.fillStyle=u||this._computeSplineGraphObject(t.brushColor,r)):t.penColor&&(n.strokeStyle&&(n.secondaryLineWidth=n.lineWidth,n.secondaryStrokeStyle=n.strokeStyle),u=this._getStackedColorValue(i,this._fixedStringList[this._computedSplineGraphPaletteKeys[t.penColor]]),n.strokeStyle=u||this._computeSplineGraphObject(t.penColor,r),t.penWidth&&(e=this._getSplineGraphPaletteKey(t.penWidth),f=this._getStackedNumericValueItem(i,e)||{},n.lineWidth=this._getScale(t.penWidth,t.penWidthTransform,r,f.value,f.ignoreTransform))))},n.prototype._getAreaPolygonTemplates_PoiRefresh=function(t,r,u){var c=parseInt(n.xsrPolygonBucketId),l=this._scaleToZoom(r),a="apt_"+c+"_"+t+"_"+l+"_"+u,f=this._primitiveTemplateCache.getItem(a),e,h,s,y,p;if(f)return f;switch(t){default:case 2:e="DefaultAreaStateSearch";break;case 3:e="HoverAreaStateSearch";break;case 4:e="SelectedAreaStateSearch"}var w=e?[e]:[],b=this._getStyleScale(l),v=this._drawOrderList,d=this._passDefinitionList,o=i._allIndexesOf(v.bucket,c);if(o&&o.length){for(h={hitTest:u},s=0,y=o.length;s<y;s++)p=d[v.passID[o[s]]],this._applyPolygonDrawingPass(h,p,w,b);f=[new k(h)];this._primitiveTemplateCache.addItem(a,f)}return f},n.prototype.getCityPolygonTemplates=function(t,i,r,u,e){var a=null;if(t===n.cityPolygonBucket||t===n.xsrPolygonBucketId){if(this._poiRefresh)return this._getAreaPolygonTemplates_PoiRefresh(r,u,e);var s=n._taskList[i],h=n._poiStateNames[r],c=0,l=0,o=this._getPoiImageColor(n._highlightBorderColor,s,h);if(o||(o=this._getPoiImageColor(n._highlightStrokeColor,s,h)),r===2||r===3?(c=5,l=2):r===5&&(c=4,l=1.5,o=this._getPoiImageColor(n._borderColor,s,h),o||(o=this._getPoiImageColor(n._strokeColor,s,h))),o){var v=new k({strokeStyle:f.white,fillStyle:f.transparent,lineWidth:c,hitTest:e,lineCap:"butt"}),y=new k({strokeStyle:o,fillStyle:r===3?"rgba(90, 255, 150, 0.4)":f.transparent,lineWidth:l,lineCap:"butt"});a=[v,y]}}return a},n.getPushpinTextTemplates=function(t,i,u,f){var h=[],e={style:{fillStyle:"rgb(255,255,255)",font:"Arial, Helvetica, Sans-Serif",fontStyle:1,fontSize:11.25,horizontalAutoScaling:1},text:"{MapDisplay}",anchor:{x:0,y:0},vectorType:3,scale:1},o,l,s,a;if(i){var v=i.height,c=i.width,p=f.x,w=f.y,y={pointsList:[{x:0,y:0},{x:c,y:0},{x:c,y:v},{x:0,y:v}],vectorType:0,style:{fillStyle:"rgba(255,255,255,0)"},scale:1};e.maxWidth=c;e.style.fontSize=10;e.anchor.x=u.x;e.anchor.y=u.y;o={records:[y,e],hitTest:1};h=[new r(o,1,f)]}else l=t.getVectorImage().records,s=l[l.length-1],s&&s.vectorType===2&&(a=n._cloneObject(s),e.maxWidth=a.radiusX*2/1.414,o={records:[a,e],hitTest:1},h=[new r(o,t.getScale())]);return h},n.prototype.getTemplates=function(i,u,f){var a,d,s,e,h,l,nt,o,k,w,b;if(f===void 0&&(f=!1),a=null,!this._initialized)return t.log(null,"TemplateSelector needs to be initialized before getTemplates() call",this._initialized),null;var y=i.entity&&i.entity.oid,p=i.bucket,v=this._scaleToZoom(u);if(y&&n._orgImages[y]){if(d=this._styleVisibilities[this._bucketToDrawOrderListIndex[p]],this._isTemplateVisible(v,d,i.geometryType)){var g=this._passDefinitionList[this._bucketToPassDefinitionIndex[p]],w=this._getStyleScale(v),b=this._getScale(g.scale,g.scaleTransform,w),c=n._orgImages[y];a=[new yt(c,b,new tt((c.naturalWidth||c.width)/2,(c.naturalHeight||c.height)/2))]}}else if(s=this._getImageByBucketId(p),e=s?s.template:null,e&&f&&(h=JSON.parse(JSON.stringify(e.getVectorImage())),e=new r(h)),e&&this._isTemplateVisible(v,s.visibility,i.geometryType)){for(h=e.getVectorImage(),l=0,nt=h.records.length;l<nt;l++)o=h.records[l].style.fillStylePaletteKey,k=this._getColor(o,!1),k&&o&&(o.indexOf(n._backgroundColor)>-1||o.indexOf(n._borderColor)>-1||o.indexOf(n._colorString)||o.indexOf(n._fillColor))&&(h.records[l].style.fillStyle=k);w=this._getStyleScale(v);b=this._getScale(s.scale,s.scaleTransform,w);e.setScale(b);a=[e]}return a},n.prototype._getvisibilities=function(n,t,i){for(var u,nt,w,s,c,tt,b,f,e,r,it,k,p,a,g=[],rt=n.length,o=0;o<rt;o++){u={drawingStyleVisibilities:{}};switch(t[o]){case 0:u.geometryType=1;break;case 2:u.geometryType=2;break;case 3:u.geometryType=3}nt=n[o];for(w in nt){s=[];u.densityLodCollection=new d;switch(w){case"point":c=1;break;case"line":c=2;break;case"polygon":c=3}for(tt=n[o][w],b=i[tt],f=0;f<b.length;f++)r={visible:!1},e=b[f],r.densityDistance=e.densityDistance,r.densityImportance=e.densityImportance,r.visible=e.visible,r.zoom=Math.round(h.calculateZoomforStyleScale(e.startZoomLevel)),r.visiblePaletteKey=e.visiblePaletteKey,s.push(r);var v=h.markupVisible,y=1,l=0;if(c===u.geometryType)for(f=s.length-1;f>=0;f--){if(r=s[f],l=this._getStyleScale(r.zoom),it=r.densityDistance===0&&r.densityImportance===0,it)u.densityLodCollection.addRange(l,y,v);else{for(k=(y-l)/h.zoomDeltaBetweenLods,p=v+k,a=l;a<y;a+=h.zoomDeltaBetweenLods)u.densityLodCollection.addRange(a,a+h.zoomDeltaBetweenLods,p),p=p-1;v+=k}y=l;r.densityLodDelta=v}u.drawingStyleVisibilities[c]=s}g.push(u)}return g},n.prototype._computeHslaTransform=function(t,i,r,u){var o,e,s,f,h;return this._computedSplineGraphs&&(e=this._computedSplineGraphs[t],e&&(s=e.evaluateHsla(i),f=a.applyHslaTransform(s,r),u&&f.z<.7&&(f.z*=u),h=a.hslaTorgba(f.x,f.y,f.z,f.w*n._alphaTransformCoefficient),o=h.toRgba())),o},n.prototype._computeSplineGraphObject=function(n,t){var r=null,i;if(this._computedSplineGraphs)return i=this._computedSplineGraphs[n],i instanceof it?r=i.evaluate(t):i instanceof ut?r=i.evaluate(t).toRgba():i instanceof d?r=i.evaluate(t):i instanceof st?r=i.evaluate(t):i instanceof et&&(r=i.evaluate(t)),r},n.prototype._getSplineGraphPaletteKey=function(n){var t=this._computedSplineGraphPaletteKeys[n];return this._fixedStringList[t]},n.prototype.getLandColor=function(){return this._landColor[0].value},n.prototype._getOriginalBucketId=function(n){var t=Math.floor(parseInt(n)&65535);return t.toString()},n.prototype.getMarkupRecord=function(i,r,u,f){var i,e,a,o,c,s,v,h,y,l;if(r){if(i=Math.round(i),e=this._markupOrder.getItem(""+i),e||(this._loadTemplates(i),e=this._markupOrder.getItem(""+i)),t.assertNotNull(e,"no markup order for zoom "+i),o=e[r+","+u],!o){if(a=r,r=this._getOriginalBucketId(r),t.assert(r!=null,"failed to map bucketId "+a),!r)return;o=e[r+","+u]}if(o){if(c=[],f){s=2;switch(f){case 1:s=3;break;case 2:s=4}v=n._getPointStateName(s,n._poiTypeStateGroups[1]);c=[v]}if(h=this._computeStyleDynamic(o,u,i,c),h)return s&&!this._poiRefresh&&(y=n._poiStateNames[s],l=this._getColor(y+n._labelColor,!0),l&&h&&(h.fontColor=l)),{styleStatic:o.style.styleStatic,styleDynamic:h}}}},n.prototype._computeStyleDynamic=function(t,i,r,u){var g=t.style,f=g.styleDynamic||{},nt=g.styleStatic||{},o,s=f.visible,tt=f.densityDistance,it=f.densityImportance,rt=f.densityLodDelta,c=0,l,ut,y,h,e,p,w,b,a,k,d,v,ft;if(t.visibility){for(l=t.visibility.drawingStyleVisibilities[i],ut=l.length,h=0;h<ut;h++)e=l[h],c=c||e.visiblePaletteKey,r>=e.zoom&&(s=e.visible,tt=e.densityDistance,it=e.densityImportance,rt=e.densityLodDelta);if(i===3){for(y=!1,l=t.visibility.drawingStyleVisibilities[2],h=0;h<l.length;h++)e=l[h],c=c||e.visiblePaletteKey,r>=e.zoom&&(y=e.visible);(s||y)&&(s=!0)}c&&(p=this._getCustomStyle(c),p!==undefined?s=p:s&&this._paletteFontProps&&(w=this._getStackedBooleanValue(u,this._fixedStringList[c]),w!==undefined&&(s=w)))}if(s&&(o={visible:s,densityDistance:tt,densityImportance:it,densityLodDelta:rt,priority:t.priority,font:f.font,fontPaletteKey:f.fontPaletteKey,fontSize:f.fontSize,fontWeight:f.fontWeight,fontWeightPaletteKey:f.fontWeightPaletteKey,fontStyle:f.fontStyle,fontStylePaletteKey:f.fontStylePaletteKey,fontCaps:f.fontCaps,fontCapsPaletteKey:f.fontCapsPaletteKey,fontColor:f.fontColor,fontColorPaletteKey:f.fontColorPaletteKey,outlineColor:f.outlineColor,outlineColorPaletteKey:f.outlineColorPaletteKey,secondaryFontSize:f.secondaryFontSize,globalOrder:t.globalOrder},this._poiRefresh&&(this._applyStackedString(u,o,"font","fontPaletteKey"),b=this._getStackedNumericValueItem(u,nt.preferredFontSizePaletteKey),a=b&&b.value,typeof a=="number"&&isFinite(a)&&(o.fontSize=a*nt.fontSizeTransform),this._applyStackedEnum(u,o,"fontWeight","fontWeightPaletteKey"),this._applyStackedEnum(u,o,"fontStyle","fontStylePaletteKey"),this._applyStackedEnum(u,o,"fontCaps","fontCapsPaletteKey"),this._applyStackedColor(u,o,"fontColor","fontColorPaletteKey"),this._applyStackedColor(u,o,"outlineColor","outlineColorPaletteKey")),k=this._passDefinitionList&&this._passDefinitionList[t.style.markupPassDefinitionIndex],k&&this._customStyleManager&&this._customStyleManager.styleString))for(d=n._customStyleProperties,v=0,ft=d.length;v<ft;v++)this._applyCustomStyle(o,k,d[v]);return o},n.prototype._applyCustomStyle=function(n,t,i){var u=t[i],f=this._computedSplineGraphPaletteKeys[u],r=this._getCustomStyle(f);r!==undefined&&(n[i]=r)},n.prototype._getCustomStyle=function(n){var i=this._fixedStringList[n],t=i&&i.split("."),r;return t&&t.length===2&&(r=this._customStyleManager.getElementStyle(t[0],t[1])),r},n.prototype._getStyleScale=function(n){return Math.round(h.calculateStyleScaleForLod(n)*1e7)/1e7},n.prototype.prefetchShields=function(t,i){var r=this;return i===void 0&&(i=3),new Promise(function(u){for(var v,l,c,f,e,a=[],o={},h=0;h<t.length;h++)for(v=r._getShieldUnmappedImageIndexes(t[h].bucketId),l=t[h].indexes,c=0;c<l.length;c++)f=v[l[c]],f>=0&&(n._mapImagesUnmapped[f]?r._updateCachedImages(f):o[f]||(o[f]=!0));for(e in o)o.hasOwnProperty(e)&&a.push(new Promise(function(u){var f=parseInt(e)%2,o=r._urlImageFormat.replace(/{imageIdx}/ig,e).replace(/{orgId}/ig,"").replace(/{subdomain}/ig,(isNaN(f)?0:f)+"");s.downloadJson(o,"XsrImages",function(t,i){if(!r._isDisposed){var f=r._parseImageRecord(t[i],r._svgColor);n._mapImagesUnmapped[parseInt(i)]=f;r._mapImages[r._unmappedToMappedImageIndex[i]]=f}u()},function(){i>0&&Microsoft.Maps.setTimeout(function(){r._isDisposed||r.prefetchShields(t,--i)},200);u()},e,!1,0,!1)}));Promise.all(a).then(function(){u()})})},n.prototype.prefetchOrganizationImages_PoiRefresh=function(t,i){var r=this,f=[],u,e;if(t)for(u=0,e=t.length;u<e;u++)n._orgImages_poiRefresh[t[u]]||f.push(t[u]);return new Promise(function(t){for(var e=[],h=function(t){var u=f[t],o=parseInt(u)%2,h=r._urlImageFormat.replace(/{orgId}/ig,u).replace(/{imageIdx}/ig,"").replace(/{subdomain}/ig,(isNaN(o)?0:o)+"");e.push(new Promise(function(t){s.downloadJson(h,"XsrOrgJsImages",function(i,u){if(i&&!r._isDisposed){var f=r._parseImageRecord(i.image,i.svgColor);n._orgImages_poiRefresh[u]=f}t()},function(n){i>0&&Microsoft.Maps.setTimeout(function(){r._isDisposed||r.prefetchOrganizationImages_PoiRefresh([n],i-1)},200);t()},u,!1,0,!1)}))},u=0,o=f.length;u<o;u++)h(u,o);Promise.all(e).then(function(){t()})})},n.prototype.prefetchOrganizationImagesByOrgId=function(t,i){var f=this,u,r;if(i===void 0&&(i=3),this._poiRefresh)return this.prefetchOrganizationImages_PoiRefresh(t,i);if(u=[],t)for(r=0;r<t.length;r++)n._orgImages[t[r]]||u.push(t[r]);return new Promise(function(t){for(var o=[],r=0;r<u.length;r++){var e=u[r],h=parseInt(e)%2,c=f._urlImageFormat.replace(/{orgId}/ig,e).replace(/{imageIdx}/ig,"").replace(/{subdomain}/ig,(isNaN(h)?0:h)+"");o.push(new Promise(function(t){s.downloadGeneric(c,"XsrOrgImages",function(i,r){var u=document.createElement("img"),f=function(){window.clearTimeout(e);u.onload=null;n._orgImages[r]=u;t()},e=Microsoft.Maps.setTimeout(function(){return f()},1e3);u.onload=function(){f()};u.src="data:image/svg+xml;base64,"+window.btoa(i)},null,function(n){i>0&&Microsoft.Maps.setTimeout(function(){f._isDisposed||f.prefetchOrganizationImagesByOrgId([n],--i)},200);t()},e,0)}))}Promise.all(o).then(function(){t()})})},n.prototype.prefetchImages=function(t,i,r,u){var f=this;return u===void 0&&(u=3),i=i||[],new Promise(function(e){for(var w,l,b,v,k,y=[],a=!1,c={},p=function(t){var i,u;t>=0&&(i=f._mappedToUnmappedImageIndex[t],n._mapImagesUnmapped[i]&&f._updateCachedImages(i),u=f._mapImages[t],a=a||!u,(!u||r)&&(c[i]=!0))},o=0,h=t.length;o<h;o++)w=t[o],l=f._bucketToMappedImageIndex[w],p(l);for(o=0,h=i.length;o<h;o++)l=f._unmappedToMappedImageIndex[i[o]],p(l);if(a)for(r&&(b=Object.keys(c),c={},c[b.join(",")]=!0),v=Object.keys(c),k=function(e){var o=v[e];y.push(new Promise(function(e){var h=o.split(","),c=parseInt(h[0])%2,l=f._urlImageFormat.replace(/{imageIdx}/ig,o).replace(/{orgId}/ig,"").replace(/{subdomain}/ig,(isNaN(c)?0:c)+"");s.downloadJson(l,"XsrImages",function(t,i){var r,o,u,s;if(!f._isDisposed)for(r=0,o=i.length;r<o;r++)u=parseInt(i[r]),s=f._parseImageRecord(t[i[r]],f._svgColor),n._mapImagesUnmapped[u]=s,f._updateCachedImages(u);e()},function(){u>0&&Microsoft.Maps.setTimeout(function(){f._isDisposed||f.prefetchImages(t,i,r,--u)},200);e()},h,!1,0,!1)}))},o=0,h=v.length;o<h;o++)k(o,h);Promise.all(y).then(function(){e()})})},n.prototype.getFetchedShields=function(n,t,i){var f,e,h,u,r;if(!t||!i||!i.length)return null;var n=Math.round(n),o=this._getShieldImages(t,i),s=[];if(o)for(f=this._getShieldScales(n,t),e=0,h=i.length;e<h;e++)u=i[e],r=null,u>=0&&(r=o[u],r&&f&&f[u]&&r.setScale(f[u]),r||(r=l.DefaultShieldTemplate)),s.push(r);return s},n.prototype.getShieldsAsync=function(n,t,i,r){var u=this,f;r&&(f={bucketId:t,indexes:i},this.selectorReady().then(function(){u.prefetchShields([f]).then(function(){r(u.getFetchedShields(n,t,i))})}))},n.prototype.getSDKLandmarkImageTemplates=function(t,i){var l=t.getState&&t.getState()||2,u=this.getLandmarkVectorImageTemplate(t,l,nt.toScale(null,i,!0)),e;if(u&&t.entity.isVenueMapPoi&&(e=u.length-1,e>=0)){var f=u[e],o=n._venueMapsIconSizes,a=Math.max(o.minZoom,Math.min(o.maxZoom,Math.round(i))),s=o[a];if(!s)return null;var v=f.getBounds(),y=f.getScale(),h=v.getSize(),c=Math.max(h.width,h.height);c!==s&&(f=new r(f.getVectorImage(),y*s/c,f.getAnchor()),u=u.slice(),u[e]=f)}return u},n.prototype.dispose=function(){this._shieldStyleResponseData=null;this._computedSplineGraphs=[];this._markupOrder.clear();this._styleVisibilities=[];this._passDefinitionList=[];this._markupVisibilities=[];this._images=null;this._imgVariants=[];this._markupOrderList=null;this._palette=null;this._drawOrderList=null;this._mapImages=[];this._svgColor=[];this._imageGroups=[];this._groupedImageOptions=[];this._fixedStringList=[];this._shieldImages=null;this._shieldScaleListForZoom=null;this._state=[];this._urlFormat=null;this._propertyValues=[];this._primitiveTemplateCache.clear();this._categoryIconCache.clear();this._localCatIdVectorImageTemplate=null;this._shieldToRoadIdMapping=null;this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this.ready&&this.ready.dispose();window.clearTimeout(this._delayLoadTimerId);this._isDisposed=!0},n.prototype._scaleToZoom=function(n){return nt.fromScale(null,n,!0)},n.prototype._isTemplateVisible=function(n,t,i){for(var o,u=t.drawingStyleVisibilities[i],s=u.length||0,f=!1,e,r=0;r<s;r++)e=e||u[r].visiblePaletteKey,n>=u[r].zoom&&(f=u[r].visible);return this._customStyleManager&&this._customStyleManager.styleString&&(o=this._getCustomStyle(e),typeof o=="boolean"&&(f=o)),f},n.prototype._getScaleFromZoom=function(t,i,r,u){var e,h=this._getStyleScale(t),o,f,c,s;return r&&n._orgImages_poiRefresh[r]?(o=this._passDefinitionList[this._bucketToPassDefinitionIndex[i]],e=this._getScale(o.scale,o.scaleTransform,h)):(f=this._getImageByBucketId(i),f?(c=this._getSplineGraphPaletteKey(f.scale),s=this._getStackedNumericValueItem(u,c)||{},e=this._getScale(f.scale,f.scaleTransform,h,s.value,s.ignoreTransform)):e=null),e},n._cloneObject=function(n){var i,r,t,f,u;if(!n||typeof n!="object")return n;for(i={},r=Object.keys(n),t=0,f=r.length;t<f;t++)u=r[t],i[u]=this._cloneObject(n[u]);return i},n._mapImagesUnmapped=[],n._colorString=".Color",n._backgroundColor=".BackgroundColor",n._borderColor=".BorderColor",n._backgroundScale=".BackgroundScale",n._highlightBorderColor=".HighlightBorderColor",n._highlightFillColor=".HighlightFillColor",n._highlightIconColor=".HighlightIconColor",n._highlightScale=".HighlightScale",n._scale=".Scale",n._labelColor=".LabelColor",n._fillColor=".FillColor",n._borderStrokeColor=".BorderStrokeColor",n._iconColor=".IconColor",n._strokeColor=".StrokeColor",n._highlightStrokeColor=".HighlightStrokeColor",n.backgroundShapeRecord="Shape-Background",n._scaleForCategoryIconInPricePoi=.5,n._orgImages={},n._orgImages_poiRefresh={},n._poiStateNames=["","","DefaultPointState","HoverPointState","SelectedPointState","InactivePointState","InactiveSelectedPointState",],n._poiTypeStateGroups=["","Search","Price","Itinerary","ShowMe","Landmark","Transit","","","","Classic","","Search",],n._pricePoiStateNames=["","","DefaultPointState2","HoverPointState2","SelectedPointState2","InactivePointState2","InactiveSelectedPointState2",],n._userPoiLabelStylesBucket="357",n.DefaultBucketForLocalCat="357",n.DefaultBucketForLocalCat_PoiRefresh="334",n._taskList=["Task1","Task2","Task3","Transit","Favorite","Layer"],n._haloImageBucket="1372",n.cityPolygonBucket="879",n.microPoiBucket="1374",n._localCatIdBucketMapping={EatAndDrink:"286",WhatToDo:"280",WhereToStay:"287",WhereToStayOpalAction:"287",Attraction:"280",Campground:"1366",House:"310",MovieTheatre:"273",Parking:"275",PivotEntity:"353",Trail:"280",School:"294",University:"294","91562":"1366","91826":"280","13344":"287","91648":"288","90014":"300","91616":"257","90954":"277","90133":"278","90122":"279","90243":"284","91563":"329","90650":"1365","91533":"271","91649":"281","90948":"1366","90903":"274","90024":"303","90386":"1367","90188":"295","91485":"1368","90727":"306","90859":"325","90089":"276","91538":"296","90298":"318","90738":"67","91348":"309","91572":"287","90320":"297","90837":"313","90045":"273","90016":"304","90960":"1369","91271":"319","90925":"275","90804":"270","90331":"320","90342":"272","90287":"286","90199":"294","90771":"305","91548":"324","91549":"118","91550":"307","91493":"299","90871":"326","90034":"302","90012":"280","91510":"1381","90017":"301","90595":"311","90001":"258","90078":"330","91186":"327","91204":"308","91714":"66","90977":"331","90584":"310","91627":"68","91391":"316","91259":"321","91537":"323","91774":"70","91773":"71","91499":"312","91651":"328","90540":"315","91764":"67","91768":"69","90496":"314","91762":"113","91643":"114","90848":"322","91650":"1359","90942":"317","91621":"64","90892":"1899","91600":"1380","100000":"248","203":"248","255":"254","257":"253","251":"252","253":"251","254":"250","252":"249","91754":"65","205":"247","204":"246","207":"245","206":"244","200":"240","264":"243","265":"242","263":"241","250":"239","202":"238","266":"236","261":"235","91571":"50","201":"234","262":"232","256":"231","260":"229","259":"228","258":"227","267":"226"},n._localCatIdBucketMapping_Delta={House:"1942","90940":"329","90975":"331","90375":"1367","90628":"306"},n._transitBucketForScaling="1388",n._multimodeTransitBucket="239",n._task4Color={".BackgroundColor":"rgba(47, 163, 235, 255)",".BorderColor":"rgba(121, 186, 226, 255)",".Color":"rgba(255, 255, 255, 255)",".HighlightBorderColor":"rgba(47, 163, 235, 255)",".HighlightFillColor":"rgba(208,227,247, 180)"},n._layerPoiColors={".BackgroundColor":"rgba(32, 61, 189, 1)",".BorderColor":"rgba(32, 61, 189, 1)",".Color":"rgba(255, 255, 255, 1)",".HighlightBorderColor":"rgba(32, 61, 189, 1)",".HighlightFillColor":"rgba(32, 61, 189, .65)",".HighlightStrokeColor":"rgba(255, 255, 255, 1)",".FillColor":"rgba(32, 61, 189, 1)",".IconColor":"rgba(255, 255, 255, 1)"},n.directionIconTypeBuckets={start:"352",middle:"350",via:"1387",turn:"1386",end:"351",ferry:"339",walk:"341",bus:"342",train:"338",airline:"340",tube:"338",auto:"337"},n.poiStylePriorityGroup=999999,n.itineraryPoiBucketId="1941",n.pricePoiBucketId="1901",n.bucketIdForPoi="999999",n.bucketIdForSelectedPoi="999998",n.bucketIdForTransientLensTop="999997",n.bucketIdForTransientLensBottom="999997.5",n.bucketIdForTransientLensLeft="999997.6",n.bucketIdForTransientLensRight="999997.7",n.bucketIdForDirectionsPins="999996",n.xsrPolygonBucketId="1383",n._roadCustomStyle={"999999,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999999,3":{styleStatic:{fontOutlined:!1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"1901,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999998,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:2,visible:!0,priority:n.poiStylePriorityGroup}},"999997,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.5,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.6,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.7,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999996,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}}},n._aerialCustomStyle={"999999,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999999,3":{styleStatic:{fontOutlined:!1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"1901,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}},"999998,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:2,visible:!0,priority:n.poiStylePriorityGroup}},"999997,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.5,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.6,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999997.7,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:n.poiStylePriorityGroup}},"999996,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:n.poiStylePriorityGroup}}},n._poiStyles={"097A0D85-2585-425A-8471-60BDD3C5B7C3":n._roadCustomStyle,"7DCFF932-3B97-4B3E-9EB4-5B9AA89EFA3C":n._roadCustomStyle,"DCD31B1C-B637-4B36-8635-829DF5E46999":n._roadCustomStyle,"DC2B2930-4CA4-45EB-9EE9-3F4EFA4267E5":n._roadCustomStyle,"7443EAC9-CD76-4236-B027-22DBC504BF06":n._aerialCustomStyle,"A3A1C843-30CE-4828-984C-AD44EAF2A245":n._aerialCustomStyle,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":n._aerialCustomStyle,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":n._aerialCustomStyle},n._darkTemplates={"7443EAC9-CD76-4236-B027-22DBC504BF06":!0,"A3A1C843-30CE-4828-984C-AD44EAF2A245":!0,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":!0,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":!0},n._latencyLogKey="MC_TD_NL",n._delayLoadTimeout=60,n._maxRetries=5,n._retryTimeout=10,n._alphaTransformCoefficient=1.5,n._outlineWidthDelta=1,n._xHeightRatio=1.15385,n._capHeightRatio=.93752,n._webkitFontFillLightnessFactor=.85,n._customStyleProperties=["fontColor","outlineColor"],n._venueMapsIconSizes={minZoom:14,maxZoom:19,14:0,15:7,16:11,17:14,18:18,19:22},n}();c.init();l=function(){function n(n){this._templateName=n}return n.prototype.dispose=function(){},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){t(n)})),this._ready},n.prototype.getCategoryIconTemplate=function(n){Microsoft.Maps.setTimeout(function(){n&&n({icon:null,iconColor:""})},0)},n.prototype.getCityPolygonTemplates=function(){return null},n.prototype.getLandmarkVectorImageTemplate=function(t,i){var r=n._landmarkTemplates[i];return r?[r]:[]},n.prototype.getMarkupStyle=function(){var t=c.isDarkTheme(this._templateName)?n._darkThemeStyle:n._lightThemeStyle;return{styleStatic:t.styleStatic,styleDynamic:i._copyObject(t.styleDynamic)}},n.prototype.getMarkupRecord=function(){var t=c.isDarkTheme(this._templateName)?n._darkThemeStyle:n._lightThemeStyle;return{styleStatic:t.styleStatic,styleDynamic:i._copyObject(t.styleDynamic)}},n.prototype.getName=function(){return this._templateName},n.prototype.getPoiTemplate=function(t,i){var r=n.poiTemplates[i];return r?[r]:[]},n.prototype.getPoiVectorImageTemplate=function(t,i){var r=n.poiTemplates[i];return r?[r]:[]},n.prototype.getSDKLandmarkImageTemplates=function(){return null},n.prototype.getRoutePoiVectorImageTemplate=function(t,i){var r;return r=t==="turn"?n.directionsTurnTemplate:n.poiTemplates[i],r?[r]:[]},n.prototype.prefetchShields=function(){return new Promise(function(n){n()})},n.prototype.prefetchImages=function(){return new Promise(function(n){n()})},n.prototype.prefetchOrganizationImagesByOrgId=function(){return new Promise(function(n){n()})},n.prototype.getFetchedShields=function(t,i,r){var u,f,e;if(i&&r&&r.length){for(u=[],f=0,e=r.length;f<e;f++)u.push(n.DefaultShieldTemplate);return u}return null},n.prototype.getShieldsAsync=function(n,t,i,r){var u=this;Microsoft.Maps.setTimeout(function(){r&&r(u.getFetchedShields(n,t,i))},0)},n.prototype.getTemplates=function(){return null},n._lightThemeStyle={styleStatic:{backgroundColor:"rgba(236,234,227,0.7)"},styleDynamic:{visible:!0,font:"SegoeBing",fontSize:10,fontColor:"#000"}},n._darkThemeStyle={styleStatic:{backgroundColor:"rgba(64,64,64,0.7)"},styleDynamic:{visible:!0,font:"SegoeBing",fontSize:10,fontColor:"#fff"}},n._landmarkTemplates=[null,null,new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1})],n.poiTemplates=[null,null,new r({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:16,radiusY:16},{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:2},centerX:0,centerY:0,radiusX:14,radiusY:14},{vectorType:2,style:{fillStyle:"#000"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:8,radiusY:8}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:2},centerX:0,centerY:0,radiusX:10,radiusY:10},{vectorType:2,style:{fillStyle:"rgba(0,0,0,0.5)"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),],n.directionsTurnTemplate=new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),n.DefaultShieldTemplate=new r({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#666",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:8},{vectorType:3,style:{fillStyle:"#000",font:"SegoeBing",fontSize:7,fontStyle:1,horizontalAutoScaling:1},anchor:{x:0,y:0},maxWidth:18,text:"{MapDisplay}"}]}),n}();ct=function(){function n(n,t,i,r,u,f){this._coreConfig=n;this._basemapSelector=new c(n,t,i,r,u,f);this._selector=this._basemapSelector}return n.prototype.dispose=function(){this._basemapSelector&&this._basemapSelector!==this._selector&&this._basemapSelector.dispose();this._selector&&(this._selector.dispose(),this._selector=null);this._basemapSelector=null;this._ready=null;window.clearTimeout(this._delayLoadTimerId)},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){n._selector.selectorReady().then(function(n){t(n)},function(){n._selector=new l(n._selector.getName());n._basemapSelector&&n._basemapSelector.ready&&n._basemapSelector.ready.addOne(function(){n._selector=n._basemapSelector});t(n);var i={feature:"",action:g.Error,data:"BaseMapTemplateSelector failed to load, FallbackTemplateSelector loaded"};u.logger&&u.logger.logCriticalError(null,i)})})),this._ready},n.prototype.getCategoryIconTemplate=function(n,t,i,r,u){this._selector&&this._selector.getCategoryIconTemplate(n,t,i,r,u)},n.prototype.getCityPolygonTemplates=function(n,t,i,r,u){return this._selector&&this._selector.getCityPolygonTemplates(n,t,i,r,u)},n.prototype.getLandmarkVectorImageTemplate=function(n,t,i,r){return this._selector&&this._selector.getLandmarkVectorImageTemplate(n,t,i,r)},n.prototype.getMarkupStyle=function(n,t,i,r){return this._selector&&this._selector.getMarkupStyle(n,t,i,r)},n.prototype.getMarkupRecord=function(n,t,i,r){return this._selector&&this._selector.getMarkupRecord(n,t,i,r)},n.prototype.getName=function(){return this._selector&&this._selector.getName()},n.prototype.getPoiTemplate=function(n,t,i,r,u,f,e){return this._selector.getPoiTemplate(n,t,i,r,u,f,e)},n.prototype.getPoiVectorImageTemplate=function(n,t,i,r,u,f,e){return this._selector&&this._selector.getPoiVectorImageTemplate(n,t,i,r,u,f,e)},n.prototype.getSDKLandmarkImageTemplates=function(n,t,i){return this._selector&&this._selector.getSDKLandmarkImageTemplates(n,t,i)},n.prototype.getRoutePoiVectorImageTemplate=function(n,t,i){return this._selector&&this._selector.getRoutePoiVectorImageTemplate(n,t,i)},n.prototype.prefetchShields=function(n){return this._selector&&this._selector.prefetchShields(n)},n.prototype.prefetchImages=function(n,t,i,r){return this._selector&&this._selector.prefetchImages(n,t,i,r)},n.prototype.prefetchOrganizationImagesByOrgId=function(n,t){return t===void 0&&(t=3),this._selector&&this._selector.prefetchOrganizationImagesByOrgId(n,t)},n.prototype.getFetchedShields=function(n,t,i){return this._selector&&this._selector.getFetchedShields(n,t,i)},n.prototype.getShieldsAsync=function(n,t,i,r){this._selector&&this._selector.getShieldsAsync(n,t,i,r)},n.prototype.getTemplates=function(n,t){return this._selector&&this._selector.getTemplates(n,t)},n}(),function(n){function r(n){var t=n;return!!(t&&t.clickable)}function u(n){var i="",t=n;return t&&(t.getPrimaryLabelText?i=t.getPrimaryLabelText():t.name?i=t.name:t.getName?i=t.getName():t.title?i=t.title:t.getTitle&&(i=t.getTitle())),i}function f(n){var i="",t=n;return t.getSecondaryLabelText?i=t.getSecondaryLabelText():t.subtitle?i=t.subtitle:t.getSubtitle&&(i=t.getSubtitle()),i}function e(n){var i=!1,t=n;if(o.features.labels.independentHotRegions)typeof t.independentHotRegions!="undefined"?i=t.independentHotRegions:t.getIndependentHotRegions&&(i=t.getIndependentHotRegions());else return!1;return i}function s(n){var i="",t=n;return t&&(t.getIconText?i=t.getIconText():t.iconText&&(i=t.iconText)),i}function h(n){var t=n;return t&&t.labelImportance||0}function c(n){var t=n;return t&&t.shieldName}function l(n){var t=n;return t&&t.shieldIndex}function i(n){var t=n&&n.split(":");return t&&t.length>1?t[1].replace(/^["\s]+|["\s]+$/g,""):""}function a(n){var r=n.split(","),u="",f="";return t.assertNotNull(r,"shield attributes"),t.assert(r.length===4,"all four shield attributes should be present"),r&&r.length===4&&(u=i(r[0]),f=i(r[3])),{text:u,modifier:f}}function v(n){var t=n;return t&&(t.ypid||t.businesslistingid)}function y(n){var t=n;return t&&t.tj}function p(n){var t=n;return t&&t.representsTransitStop}function w(n){return n&&n.poiType===5}n.getClickable=r;n.getDisplayName=u;n.getSecondaryDisplayName=f;n.independentHotRegions=e;n.getIconText=s;n.getLabelImportance=h;n.getShieldNames=c;n.getShieldIndices=l;n.getShieldDisplayData=a;n.getYpid=v;n.getTransitJson=y;n.isTransitEntity=p;n.isLandmarkEntity=w}(p||(p={}));var lt=function(){function n(n){this._maxValue=16384;this.id="SpatialGrid"+n.quadKey;this._matrixCache=new y(1024);this.bounds=[0,this._maxValue,this._maxValue,0];var t=1<<n.lod,i=1<<(n.lod>0?n.lod-1:0);this._west=n.x/t*360-180;this._east=(n.x+1)/t*360-180;this._north=90-n.y/i*180;this._south=90-(n.y+1)/i*180;this._x1=e.instance.projectToX(this._north,this._west);this._width=(e.instance.projectToX(this._south,this._east)-this._x1)/this._maxValue;this._y1=e.instance.projectToY(this._north,this._west);this._height=(e.instance.projectToY(this._south,this._east)-this._y1)/this._maxValue;this._mercatorToGridCrsMatrix=null}return n.prototype.getMatrix=function(n){var i=n.id,t=this._matrixCache.getItem(i);return t||(t=this._getMatrixInternal(n),this._matrixCache.addItem(i,t)),t},n.prototype._getMatrixInternal=function(n){var i=new kt(this._width,0,0,this._height,this._x1,this._y1),t;return n===e.instance?i:(t=n.getMatrix&&n.getMatrix(e.instance),t)?t.invert().multiply(i):null},n.prototype._getMercatorToGridCrsMatrix=function(){return this._mercatorToGridCrsMatrix||(this._mercatorToGridCrsMatrix=this._getMatrixInternal(e.instance).invert()),this._mercatorToGridCrsMatrix},n.prototype.projectToX=function(n,t){return this._project(n,t,!0)},n.prototype.projectToY=function(n,t){return this._project(n,t,!1)},n.prototype._project=function(n,t,i){var r=e.instance.projectToX(n,t),u=e.instance.projectToY(n,t),f=this._getMercatorToGridCrsMatrix();switch(i){case!0:return f.projectX(r,u);case!1:return f.projectY(r,u)}},n.prototype.toLatitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return e.instance.toLatitude(i,r)},n.prototype.toLongitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return e.instance.toLongitude(i,r)},n}(),ri=function(){function n(n){var r=0,u=0,t,i;if(n===0)t=0;else{for(var e=n,o=2147483648,f=31;f&&!(e&o);)f--,o/=2;t=(f+1)/2}for(i=0;i<t;i++)r<<=1,r|=n>>(t-i-1)*2&1,i>0&&(u<<=1,u|=n>>(t-i-1)*2+1&1);for(var e=n&2147483647>>32-2*t,s="0",h=t;h--;)s+="0123".charAt(e>>h*2&3);this.quadKey=s;this.x=r;this.y=u;this.lod=t;this.crs=new lt(this);this.bounds=[0,16384,16384,0]}return n.fromLocation=function(t,i){if(i===0)return new n(1);if(i===1)return new n(t.longitude>0?3:2);var r=2<<i-2,u=Math.floor((t.longitude+180)*2*r/360),f=Math.floor((90-t.latitude)*r/180);return u=Math.min(u,r*2-1),f=Math.min(f,r-1),n.fromGridXY(u,f,i)},n.fromGridXY=function(i,r,u){var f=0,e;if(t.assertNotNull(i,"gridX"),t.assertNotNull(r,"gridY"),t.assertNotNull(u,"lod"),u===0)f=1;else{for(f=0,e=0;e<u;e++)f<<=1,f|=r>>u-e-1&1,f<<=1,f|=i>>u-e-1&1;f|=1<<u*2-1}return new n(f)},n}(),ui=function(){function n(){}return n}(),ki=function(){function n(){}return n}(),fi=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,t,i,r,u,s)||this;return c._id=o,h&&(c._jsonsoSuffix=h),c._minZoom=f,c._maxZoom=e,c._suppressDataRetrieval=!w.staticLandmarks&&!w.dynamicLandmarks,c}return ht(t,n),t.prototype.updateZoom=function(n,t){this._minZoom=n;this._minZoom=t},t.prototype.applyFilter=function(n){this._filter=n},t.prototype.resetFilter=function(){this._filter=null},t.prototype.setLayer=function(n){this._layer=n},t.prototype._filterResponse=function(n){var r={},f=w.staticLandmarks,u,i,t;if(r.primitives=[],n&&n.primitives)for(r.primitives=n.primitives,u=0;u<r.primitives.length;u++)i=r.primitives[u],f?i.isHoverEnabled=i.isTapEnabled=null:i.isHoverEnabled||(i.isHoverEnabled=i.isTapEnabled=function(){return!0}),t=i.entity,t&&(t.changed||(t.changed=new v),t.ypid&&t.ypid.indexOf("ypid:")!==0&&(t.ypid="ypid:"+t.ypid),t.poiType=5),i.layer=this._layer;return r},t.prototype.getPrimitives=function(t,i,r,f,e){var h=b._getDispatchKey(t,i,f||"",this._id),o,s;e=Math.round(e);o=u&&u.Internal&&u.Internal._VenueMapHelper;s=o&&o.isOverlappingVenueMaps(this._coreConfig,t);e<this._minZoom||e>this._maxZoom||this._suppressDataRetrieval||s||this._layer&&!this._layer.getVisible()?n.prototype._completeRequest.call(this,r,{primitives:[]},h):n.prototype.getPrimitives.call(this,t,i,r,f,e)},t}(b),at=function(){function n(n,t,i){var r=this;this._layerId=n;this._parentDataSource=t;this.spatialIndex=i;this.invalidated=new v;t.invalidated.add(function(n){return r.invalidated.invoke(n)})}return n.prototype.getParentDataSource=function(){return this._parentDataSource},n.prototype.getPrimitives=function(n,t,i,r){this._parentDataSource.getPrimitives(n,this._layerId,t,i,r)},n.prototype.applyFilter=function(n){this._parentDataSource.applyFilter(n)},n.prototype.resetFilter=function(){this._parentDataSource.resetFilter()},n.prototype.cancelPrimitivesRequest=function(n,t){this._parentDataSource.cancelPrimitivesRequest(n,this._layerId,t)},n.prototype.getDataUniquenessKey=function(n){t.assertNotNull(n,"regionId");return n.quadKey+this._parentDataSource.getFilterKey()},n}(),ei=function(){function n(n,t,i){this._guid=n;this._items={};this._fixedStringList=t;this._fixedStringMap=i}return n._clone=function(n,t){var i;switch(n.type){case 0:i={keyId:t,type:n.type,stringId:n.stringId};break;case 1:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform};break;case 3:i={keyId:t,type:n.type,value:n.value};break;case 2:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform}}return i&&(i.additionalAttributes=n.additionalAttributes),i},n.prototype._addItem=function(n){this._items[n.keyId]=n},n.prototype.getStackedColorPaletteValue=function(n,t){var r=NaN,i=this._getStackedPaletteItem(n,t);return i&&i.type===1&&(r=i.value),r},n.prototype.getStackedSinglePaletteItem=function(n,t){var r=null,i=this._getStackedPaletteItem(n,t);return i&&i.type===2&&(r=i),r},n.prototype.getStackedStringPaletteValue=function(n,t){var r,i=this._getStackedPaletteItem(n,t);return i&&i.type===0&&(r=this._fixedStringList[i.stringId]),r},n.prototype.getStackedEnumPaletteValue=function(n,t){var r,i=this._getStackedPaletteItem(n,t);return i&&i.type===4&&(r=i.value),r},n.prototype.getStackedBooleanPaletteValue=function(n,t){var r,i=this._getStackedPaletteItem(n,t);return i&&i.type===3&&(r=i.value),r},n.prototype._getStackedPaletteItem=function(n,t){var e=null,i,o,u,f;if(!n||!t)return null;for(i=0,o=n.length;i<o;i++){var s=n[i]+"."+t,h=this._getFixedStringId(s),r=this._items[h];if(r)if(u=r.additionalAttributes,f=u&&u.propertyReferenceId,f)t=this._fixedStringList[f];else{e=r;break}}return e},n.prototype.getColorPaletteValue=function(n,t){var r=NaN,i;return n=n||0,i=this._items[n],i&&(!t||i.hasValue)&&(r=i.value),r},n.prototype.getSinglePaletteValue=function(n,t,i){var u,r;return i===void 0&&(i=1),u=i,n=n||0,r=this._items[n],r&&(!t||r.hasValue)&&(u=r.value),u},n.prototype.getBooleanPaletteValue=function(n){var i=!1,t;return n=n||0,t=this._items[n],t&&(i=t.value),i},n.prototype.getStringPaletteValue=function(n){var i="",t;return n=n||0,t=this._items[n],t&&(i=this._fixedStringList[t.stringId]),i},n.prototype._getFixedStringId=function(n){var t=this._fixedStringMap[n];return typeof t!="number"&&(t=-1),t},n.prototype.populate=function(i,r,u){var a={},o,e,y,c,l,f;if(i.nodeType){for(o=i.nodeType.properties,e={name:i.nodeType.name,parent:i.nodeType.parent,properties:i.nodeType.properties};e.parent&&e.parent.properties;)o=o.concat(e.parent.properties),e=e.parent;for(f=0;f<o.length;f++){var s=o[f].propertyName,v=i.name+"."+s,h=r[v];h?(this._addItem(h),h.hasValue=!0,a[s]=h):(y=u&&u[s],y?(c=this._getFixedStringId(v),c>=0?(l=n._clone(y,c),l.hasValue=!1,this._addItem(l),a[s]=l):t.assert(!0,"KeyId not in FixedStrings "+c)):t.assert(!0,"Palette key should be present "+v))}}if(i.children)for(f=0;f<i.children.length;f++)this.populate(i.children[f],r,a)},n.prototype.getBackgroundShapeIds=function(){for(var n,e,i,r,u=Object.keys(this._items),f={},t=0,o=u.length;t<o;t++)n=this._items[u[t]],n&&n.type===0&&(e=n.keyId,i=this._fixedStringList[e],i&&i.endsWith(c.backgroundShapeRecord)&&(r=n.stringId,this._fixedStringList[r]&&(f[r]=!0)));return Object.keys(f)},n.prototype.addItem=function(n,t){var i={type:4,hasValue:!0,value:t};this.addPaletteItem(n,i)},n.prototype.addPaletteItem=function(n,t){t.keyId=this.addFixedString(n);this._addItem(t)},n.prototype.addFixedString=function(n){var t=this._getFixedStringId(n);return t===-1&&(t=this._fixedStringList.length,this._fixedStringList.push(n),this._fixedStringMap[n]=t),t},n}();n._BaseMapDataSource=b;n._BaseMapStreetsideDataSource=ii;n._EntityHelper=p;n._BaseMapTemplateSelector=c;n._BaseMapTemplateSelectorProxy=ct;n._GridId=ri;n._GridCrs=lt;n._LandmarkEntity=ui;n._LandmarksDataSource=fi;n._LayerDataSource=at}catch(vt){if(u.logger)u.logger.logCriticalError(vt);else throw vt;}}).call(window)