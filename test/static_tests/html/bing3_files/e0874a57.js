(function(){var h,c,l,a,v,y,p,w,b,k;try{var i=window.$MicrosoftMaps8,r=i.Internal,u=r.DataHandlers=r.DataHandlers||{},d=i.GlobalConfig,ot=r.BirdsEyeV2DialogViewModel,st=r.Control,rt=r.ControlTemplate,n=i.DataHandlerKeys,f=r._Gimme,t=i.GlobalDataEventHandler,e=r._Helper,ut=r._InstrumentationBase,ht=r._JSEvent,ct=r._LoggingWrapper,ft=r._Network,g=i.Location,et=i.MapTypeId,lt=i.PhotosynthMode,nt=i.GlobalConfig.features.print,s=i.GlobalConfig.features.sharing,o=i.GlobalConfig.features.streetside,at=r._StreetsideDirectionsBootstrapper,vt=r._StreetsideLocalDetailsBootstrapper,yt=r._StreetsideLoggerConstants,pt=r._StreetsideModeBootstrapper,wt=i.GlobalConfig.features.taskFramework,bt=i.TaskManager,tt=function(){function i(n){this._map=n}return i.prototype.processData=function(t){if(t===n.birdsEyeV2DialogDataHandlerKey){var i=this._map.getContainer();i.instanceAsync("BirdsEyeV2DialogViewModel",function(n){n.showBEDialog()})}},i.register=function(){try{if(i._registered)return}catch(r){return}t.registerDataHandler(n.birdsEyeV2DialogDataHandlerKey,i._BEDialogSourceKey);t.registerEventForDataAttribute("click",n.birdsEyeV2DialogDataHandlerKey,{preventDefault:!0});i._registered=!0},i._registered=!1,i._BEDialogSourceKey="BirdsEyeV2DialogDataHandler",i}();tt.register();h=function(){function i(n){this._logger=n}return i.prototype.processData=function(t,r){if(d.enableInstrumentation)if(t===n.instrumentationDataHandlerKey){if(!(r&&(r.logData||r.flush)))throw"Invalid options passed";r.logData&&this._logger.logObject(r.logData,r.impressionGuid,r.isMapsAction);r.flush&&this._logger.flush()}else t===n.callServerInstrumentationDataHandlerKey&&i.callServerInstrumentation(r.logData.data,r.logData.feature)},i.register=function(){if(i._registered)throw"Data Handler should not be registered more than once";t.registerDataHandler(n.instrumentationDataHandlerKey,i._InstrumentationSourceKey);t.registerDataHandler(n.callServerInstrumentationDataHandlerKey,i._InstrumentationSourceKey);t.registerEventForDataAttribute("click",n.instrumentationDataHandlerKey,{preventDefault:!0});i._registered=!0},i.callServerInstrumentation=function(n,t){ut.SendInstrumentationToServer(n,t)},i._instrumentationActionName="log",i._registered=!1,i._InstrumentationSourceKey="InstrumentationDataHandler",i}();h.register();c=function(){function i(n,t){this._map=n;this._taskBar=t}return i.prototype.processData=function(n,t){t&&this._activateLayerManager(t)},i.register=function(){if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.layerManagerDataHandlerKey,"LayerManagerDataHandler"),t.registerEventForDataAttribute("click",n.layerManagerDataHandlerKey,{preventDefault:!0}),i._registered=!0},i.prototype._activateLayerManager=function(n){var t=this,i=this._map.getContainer();i.instanceAsync("LayerManagerModule",function(i){if(t._isCategoryEnabled(n))switch(n.action){default:case"activateLayer":i.activate(n);break;case"removeLayer":i.remove(n.category,n.taskId);break;case"activateNearbyLayer":i.activateNearbyLayer(n.category,n.url);break;case"removeNearbyLayer":i.removeNearbyLayer(n.category);break;case"updateDisplayState":i.updateDisplayState(n.category,n.taskId,n.displayState);break;case"updateFilters":i.updateFilters(n.category,n.taskId,n.filters);break;case"updateQuery":i.updateQuery(n.category,n.taskId,n.queryText);break;case"updateRoutePoints":i.updateRoutePoints(n.category,n.taskId,n.routePoints);break;case"updateTaskEntities":i.updateTaskEntities(n.category,n.taskId,n.taskEntities);break;case"refreshData":i.refreshData(n.category,n.taskId);break;case"removeAllLayers":i.removeAll();break;case"expandcategory":i.expandOrCollapse(n,!0);break;case"collapsecategory":i.expandOrCollapse(n,!1)}})},i.prototype._isCategoryEnabled=function(n){for(var u,i=n.category,f=d.features.layerManager,r=f.enabledCategories,t=0,o=r.length;t<o;t++)if(u=r[t],i===u)return!0;return e._isHotelsCategory(i)?(n.category="hotel",!0):!1},i._registered=!1,i}();c.register();l=function(){function i(n,t){this._taskManager=n;this._layoutManager=t}return i.prototype.processData=function(n,t){var i,r,u;if(t){i=!1;switch(t.action){default:case"changeLayout":t.name&&(r=this._taskManager.getFocusedStack(),r&&(u=r.getForegroundTask(),this._taskManager.collapseStack(r,u)),this._layoutManager.activateLayout(t.name),i=!0);break;case"updateLayout":t.state&&(this._layoutManager.updateLayout(t.state),i=!0)}if(!i)throw"Invalid options passed";}else throw"Options is not passed";},i.register=function(){if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.layoutDataHandlerKey,i._layoutDataHandlerSourceKey),t.registerEventForDataAttribute("click",n.layoutDataHandlerKey,{preventDefault:!0}),i._registered=!0},i._registered=!1,i._layoutDataHandlerSourceKey="LayoutDataHandler",i}();l.register();a=function(){function i(n){this._taskManager=n}return i.prototype.processData=function(n,t,i,r){var u=this;if(this._taskManager.isDeserializingTasks)this._taskManager.deserializationCompleted.addOne(function(){return u.processData(n,t,i,r)});else if(t&&t.requestorId)this.requestPoiManager(t);else throw"Invalid options passed";},i.prototype.requestPoiManager=function(n){var i=this._taskManager.getTaskById(n.requestorId),t;i&&(t=this._taskManager.getPreviousTaskByStack(n.requestorId),t&&i.processCallback({processorType:t.type,inData:{requestorId:n.requestorId,requestState:{options:n}},outData:[{processorId:t.id,data:t.poiManager&&t.poiManager.getBestMapView()}]}))},i.register=function(){if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.mapViewDataHandlerKey,i._mapViewSourceKey),t.registerEventForDataAttribute("click",n.mapViewDataHandlerKey,{preventDefault:!0}),i._registered=!0},i._registered=!1,i._mapViewSourceKey="MapViewDataHandler",i}();a.register();v=function(){function r(n,t){this._map=n;this._container=t}return r.prototype.processData=function(n,t){if(!t||t.action!==r.startPhotosynthModeActionName)throw"Invalid options passed";this._startPhotosynthMode(t)},r.prototype._startPhotosynthMode=function(n){var t=this;n.jsonUrl||n.errorCallback&&n.errorCallback();window.location.protocol.toLowerCase()==="https:"?r.getHttpsOverrideList(function(i){t.getJsonMetadata(n,i)},n.errorCallback?function(){return n.errorCallback()}:null):this.getJsonMetadata(n)},r.prototype.getJsonMetadata=function(n,t){var i=this,r=o.photosynthProxyUrlFormat.replace("{uriEncodedUrl}",encodeURIComponent(n.jsonUrl)),u=Math.floor(Math.random()*1e6).toString();ft.downloadJsonp(r,"psmeta",function(r){var u=f.Internals.stringify(r),e=t?u:u.replace(/http:\/\/media.everyscape.com.edgesuite.net/g,"https://everyscapemedia-a.akamaihd.net");i._container.instanceAsync("PhotosynthMode",function(r){r.setPreviousMode(i._map.getMode());r.setOverrideList(t);r.setInitialMetadata(JSON.parse(e));i._map.setMode(r);n.callback&&n.callback()})},n.errorCallback?function(){return n.errorCallback()}:null,u)},r.getUriWithCors=function(n,t,r){var u=new i.Internal.originalXMLHttpRequest;"withCredentials"in u?(u.onload=function(){t(u.responseText)},u.ontimeout=u.onabort=u.onerror=function(){r()},u.open("GET",n,!0),u.send()):r()},r.getHttpsOverrideList=function(n,t){r.getUriWithCors(o.httpsOverrideListUrl,function(i){try{n(JSON.parse(i))}catch(r){t()}},t)},r.register=function(){if(r._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.photosynthDataHandlerKey,r._PhotosynthSourceKey),t.registerEventForDataAttribute("click",n.photosynthDataHandlerKey,{preventDefault:!0}),r._registered=!0},r.startPhotosynthModeActionName="startPhotosynthMode",r._registered=!1,r._PhotosynthSourceKey="PhotosynthDataHandler",r}();v.register();y=function(){function i(n){this._printManager=n}return i.prototype.processData=function(t,i){t===n.printDataHandlerKey&&i&&i.source&&this._printManager.showPrintDialog(i)},i.register=function(){try{if(!nt||!nt.isEnabled||i._registered)return}catch(r){return}t.registerDataHandler(n.printDataHandlerKey,i._PrintSourceKey);t.registerEventForDataAttribute("click",n.printDataHandlerKey,{preventDefault:!0});i._registered=!0},i._registered=!1,i._PrintSourceKey="PrintDataHandler",i}();y.register();p=function(){function i(n,t){this._map=n;this._taskBar=t}return i.prototype.processData=function(n,t){var r=t||{action:i.ShareAction};r.entryPoint=r.entryPoint||"";this.currentSharingOptions={entryPoint:r.entryPoint};switch(r.action){case i.ShareTasksAction:this.currentSharingOptions.taskIds=r.taskIds||[];default:case i.ShareAction:this._showSharingUX(r);break;case i.CloseShareTasksAction:this._closeSharingUX(r)}},i.register=function(){try{if(!s||!s.isEnabled)return}catch(r){return}if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.shareDataHandlerKey,"ShareDataHandler"),t.registerEventForDataAttribute("click",n.shareDataHandlerKey,{preventDefault:!0}),i._registered=!0},i.prototype._showSharingUX=function(i){var u,o,r;this._oldSetView=this._map.setView;this._map.setView=function(){};u=this._map.getContainer();s.enableMultipleCardSharing?(this._taskBar&&this._taskBar.setActionsState(8,2),f(".taskBar").set_style({"z-index":"998"}),f(".NavBar_Container").set_style({"z-index":"998"}),o=e._createElement("div"),o.set_attr("class","bm_allButTaskFrameworkLane"),f(".taskLayoutContainer").getParent().append(o),this._map.getMode().mapModeType===0&&this._map.getMapType().id!==et.birdseyeV2?(t.invokeHandler(n.layoutDataHandlerKey,{action:"changeLayout",name:"MultiCardLeftSelectionLayout"}),f("#sb_feedback").set_style({display:"none"})):(this.currentSharingOptions.taskIds=null,this._pseudoShareDialog=rt.createControl("SharePanel"),this._pseudoShareDialog.setInitialData({container:u}),r=e._createElement("div"),r.set_attr("class","bm_pseudoShareDialog"),f(".taskLayoutContainer").getParent().append(r),r.append(this._pseudoShareDialog.getRootElement()),this._pseudoShareDialog.refresh())):u.instanceAsync("SharingDialogViewModel",function(n){n.show(i.entryPoint)})},i.prototype._closeSharingUX=function(){this._oldSetView&&(this._map.setView=this._oldSetView,this._oldSetView=null);this._map.getMode().mapModeType===0?(t.invokeHandler(n.layoutDataHandlerKey,{action:"changeLayout",name:"MultiCardLeftLayout"}),f("#sb_feedback").set_style({display:"inline"})):this._pseudoShareDialog&&(this._pseudoShareDialog.dispose(),this._pseudoShareDialog=null);this._taskBar&&this._taskBar.setActionsState(8,1);f(".taskBar").set_style({"z-index":"1001"});f(".NavBar_Container").set_style({"z-index":"1005"});f(".bm_allButTaskFrameworkLane").removeFromParent();f(".bm_pseudoShareDialog").removeFromParent()},i.ShareAction="share",i.ShareTasksAction="shareTasks",i.CloseShareTasksAction="closeShare",i._registered=!1,i}();p.register();w=function(){function i(n,t){this._map=n;this._container=t}return i.prototype.processData=function(n,t){if(t&&t.action){!t.location||t.location instanceof g||(t.location=new g(t.location.latitude,t.location.longitude,t.location.altitude,t.location.altitudeReference));switch(t.action){case i._toggleCoverageMapActionName:this._toggleCoverageMap(t.map);break;case i._showDirectionsBubbleOverlayActionName:this._showDirectionsBubbleOverlay(t);break;case i._showBubbleImageActionName:this._showStreetsideBubbleInLocalDetails(t);break;case i._showBubbleActionName:this._showStreetsideModeForLocalDetails(t);break;default:throw"Invalid options passed";}}else throw"Invalid options passed";},i.register=function(){try{if(!o||!o.isEnabled)return}catch(r){return}if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.streetsideDataHandlerKey,i._StreetsideSourceKey),t.registerEventForDataAttribute("click",n.streetsideDataHandlerKey,{preventDefault:!0}),i._registered=!0},i.prototype._toggleCoverageMap=function(n){var r=this,t=n?n:this._map;t.getMapOptions().disableStreetside||(t!==this._map&&(this._streetsideCoverageBehavior&&this._streetsideCoverageBehavior.isAttached()&&this._streetsideCoverageBehavior.detach(),this._map=t,this._streetsideCoverageBehavior=null),this._streetsideCoverageBehavior?this._streetsideCoverageBehavior.isAttached()?this._streetsideCoverageBehavior.detach():this._streetsideCoverageBehavior.attach(t):t.getContainer().instanceAsync(i._streetsideCoverageBehaviorClassName,function(n){r._streetsideCoverageBehavior=n;r._toggleCoverageMap(t)}))},i.prototype._showDirectionsBubbleOverlay=function(n){if(n.directionsStartupOptions)this._container.instanceAsync("StreetsideDirectionsBootstrapper",function(t){t.showStreetsideIfAvailable(n.directionsStartupOptions,null,null)});else throw"Directions startup options are needed for generating the Bubble Overlay.";},i.prototype._showStreetsideBubbleInLocalDetails=function(n){n.location&&n.localDetailsStartupOptions?this._container.instanceAsync("StreetsideLocalDetailsBootstrapper",function(t){t.showStreetsideIfAvailable(n.location,n.localDetailsStartupOptions,n.callback,n.errorCallback,n.perfState)}):n.errorCallback&&n.errorCallback()},i.prototype._showStreetsideModeForLocalDetails=function(n){var t=n.localDetailsStartupOptions;t?this._container.instanceAsync("StreetsideLocalDetailsBootstrapper",function(t){t.showStreetsideModeForLocalDetails(n.location,n.localDetailsStartupOptions,n.callback,n.errorCallback)}):n.errorCallback&&n.errorCallback()},i._streetsideCoverageBehaviorClassName="StreetsideCoverageBehavior",i._toggleCoverageMapActionName="toggleCoverageMap",i._showDirectionsBubbleOverlayActionName="showDirectionsBubbleOverlay",i._showBubbleImageActionName="showBubbleImage",i._showBubbleActionName="showBubble",i._registered=!1,i._StreetsideSourceKey="StreetsideDataHandler",i}();w.register();b=function(){function i(n,t){this._container=n;this._taskManager=t}return i.prototype.processData=function(n,t){var f=this,i,r,u;if(t){i=!1;switch(t.action){default:case"activate":t.type&&(r=e._overrideTasktypeBasedOnCategory(t.type,t.state),this._container.instanceAsync(r?r:t.type,function(n){f._taskManager.activateTask(n,t.state,t.activateOptions)}),i=!0);break;case"activateHidden":t.id&&(u=this._taskManager.getHiddenTaskById(t.id),this._taskManager.activateTask(u,t.state,t.activateOptions,!0),i=!0);break;case"focus":t.id&&(this._taskManager.focusTask(t.id,t.state),i=!0);break;case"remove":t.id&&(this._taskManager.removeTask(t.id),i=!0);break;case"removeTaskOrStackIfNotForeground":t.id&&(this._taskManager.removeTaskOrStackIfNotForeground(t.id),i=!0);break;case"removeStack":t.id&&(this._taskManager.removeTaskStack(t.id),i=!0);break;case"removeStackForTask":t.id&&(this._taskManager.removeStackForTask(t.id),i=!0);break;case"removeTaskAndReseatChild":t.id&&(this._taskManager.removeTaskAndReseatChild(t.id),i=!0);break;case"removeAllStacks":this._taskManager.removeAllStacks(t.clearHistoryState);this._taskManager.removeHiddenTasks();i=!0}if(!i)throw"Invalid options passed";}else throw"Options is not passed";},i.register=function(){if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.taskDataHandlerKey,i._taskActivatorSourceKey),t.registerEventForDataAttribute("click",n.taskDataHandlerKey,{preventDefault:!0}),i._registered=!0},i._registered=!1,i._taskActivatorSourceKey="TaskActivator",i}();b.register();k=function(){function i(n,t){this._container=n;this._taskManager=t}return i.prototype.processData=function(n,t,i,r){var u=this;if(this._taskManager.isDeserializingTasks)this._taskManager.deserializationCompleted.addOne(function(){return u.processData(n,t,i,r)});else if(t&&t.type&&t.requestState)this.requestTaskProcess(t);else throw"Invalid options passed";},i.prototype.requestTaskProcess=function(n){var u=this,t={requestorId:n.requestorId,requestorState:n.requestorState,requestState:n.requestState},i,r,f,s,e,o;if(n.taskId)this._processSpecificTask(n.taskId,t,n);else if(n.useActiveTasks)if(n.hiddenTask){if(i=this._taskManager.getHiddenTaskByType(n.type),i&&i.length){if(!i[0].process)throw"Process is not implemented by task: "+n.type;i[0].process(t,function(r){r.processorId=i[0].id;u._invokeRequestorTask(n,t,[r])})}}else if(r=this._taskManager.getTaskByType(n.type),f=[],r&&r.length>0)for(s=0,e=0;e<r.length;e++){if(o=r[e],!o.process)throw"Process is not implemented by task: "+n.type;o.process(t,function(i){i.processorId=o.id;f.push(i);s++;s===r.length&&u._invokeRequestorTask(n,t,f)})}else this._invokeRequestorTask(n,t,f);else this._container.instanceAsync(n.type,function(i){if(!i.process)throw"Process is not implemented by task: "+n.type;n.hiddenTask&&u._taskManager.manageHiddenTask(i);i.process(t,function(i){u._invokeRequestorTask(n,t,[i])});n.hiddenTask&&u._taskManager.addHiddenTask(i)},null)},i.register=function(){if(i._registered)throw"Data Handler should not be registered more than once";else t.registerDataHandler(n.taskProcessDataHandlerKey,i._taskProcessSourceKey),t.registerEventForDataAttribute("click",n.taskProcessDataHandlerKey,{preventDefault:!0}),i._registered=!0},i.prototype._processSpecificTask=function(n,t,i){var u=this,r=this._taskManager.getTaskById(i.taskId);r&&r.process&&r.process(t,function(n){var f=[n];n.processorId=r.id;u._invokeRequestorTask(i,t,f)})},i.prototype._invokeRequestorTask=function(n,t,i){var u={processorType:n.type,inData:t,outData:i},r=n.requestorId&&this._taskManager.getTaskById(n.requestorId),f;!r&&i&&i.length&&i[0].originalProcessInputData&&(f=i[0].originalProcessInputData,r=f.requestorId&&this._taskManager.getTaskById(f.requestorId),r&&u.inData&&(u.inData.requestorId=f.requestorId,u.inData.requestorState=f.requestorState));r&&r.processCallback?r.processCallback(u):n.requestorType&&this._container.instanceAsync(n.requestorType,function(n){n&&n.processCallback&&n.processCallback(u)})},i._registered=!1,i._taskProcessSourceKey="TaskProcessDataHandler",i}();k.register();u._TaskActivator=b;u._TaskProcessDataHandler=k;u._StreetsideDataHandler=w;u._InstrumentationDataHandler=h;u._PrintDataHandler=y;u._PhotosynthDataHandler=v;u._ShareDataHandler=p;u._LayerManagerDataHandler=c;u._LayoutDataHandler=l;u._MapViewDataHandler=a;u._BirdsEyeV2DialogDataHandler=tt}catch(it){if(i.logger)i.logger.logCriticalError(it);else throw it;}}).call(window)